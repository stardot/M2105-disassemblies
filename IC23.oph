.include "MOS.oph"

; 0767: cursor x position
; 0768: cursor y position

; $3030:               35
; $3060: 60
; $3130:       32
; $3300: 00
; $3350:             54
; $3360:                   66 67
; $3400:                                           0e
; $3410:       12 13 14         18 19
; $3420: 20 21                     29


; Note: Uses these addresses in page &FD:
;
; $fd00: 00 01 02 03 04 05   07
; $fd10:                                           1e
; $fd50:          53                         5c 5d
; $fde0:                               ea eb ec

.org $8000

ic23_start:
_8000:
    nop
    nop

; This routine is called from RAM. Its entry point is the address defined by
; the high byte at bf01 and the low byte at bf80, plus one. The offset is due
; to the use of an RTS instruction to enter the routine.

; 8002
entry_from_ram:     ; RAM entry point 0 ($93 global)
    ldx #$02
    stx $2d
    lda #$ef
    ldy #$8a
    ldx #$1d
    jsr $3300
    ldx #$03
    stx $2d
    lda #$28
    ldy #$8a
    ldx #$28
    jsr $3300
    ldx #$04
    stx $2d
    lda #$44
    ldy #$8b
    ldx #$28
    jsr $3300
    ldx #$05
    stx $2d
    lda #$a1
    ldy #$8b
    ldx #$28
    jsr $3300
    jsr _8a88
    lda #$80
    sta $3418
    jsr _807d
    lda #$ff
    sta $3929
    lda #$00
    sta $3b39
    lda #$00
    sta $3b3a
    lda #$ff
    sta $362f
    lda #$2f
    sta $14
    lda #$36
    sta $15
    jsr _98b7
    lda #$00
    sta $362f
    ldx $3b3a
    beq _8072
    lda $3419
    ora #$01
    sta $3419
_8072:
    txa
    jsr _81f5
    jmp _80f0

_8079:              ; Unused?
    ldx $3412
    rts

_807d:              ; RAM entry point 7
    lda #$19
    jsr $3354
    php
    sei
    ldx #$07
    stx $2d
    ldx #$1b
    jsr $3300
    lda #$1b
    ldx #$10
    jsr $3354
    plp
    rts

_8096:
    jsr _80a8
    bcs _809e
    jsr _80e1
_809e:
    rts

_809f:
    jsr _80a8
    bcc _80a7
    jsr _80f0
_80a7:
    rts

_80a8:
    lda $362b
    eor #$ff
    cmp #$00
    beq _80bd
    lda $362b
    eor #$00
    cmp #$01
    bcc _80bd
brk
_80bb:
.byte 82 00
_80bd:
    rts

_80be:              ; RAM entry point 2
    ldx #$08
    lda #$15        ; Flush speech buffer (X=8)
    jsr OSBYTE
    lda $362b
    cmp #$00
    bne _80cf
    jmp _80e1
_80cf:
    jsr _80f0
    ldx #$0d
    jsr _8106
    ldx #$0c
    jsr _8106
    ldx #$06
    jmp _8106

_80e1:              ; RAM entry point 3
    lda #$ff
    sta $362b
    lda #$00
    sta $3b03
    ldx #$76
    jmp _80ff

_80f0:
    lda #$00
    sta $362b
    lda #$1e
    sta $3b03
    ldx #$77
    jmp _80ff

_80ff:
    stx $2d
    ldx #$01        ; a4c9 in ROM 1 (IC22)
    jmp $3300

_8106:
    stx $2d
    lda #$40
    ldx #$27        ; 8533 in ROM 1 (IC22)
    jmp $3300

_810f:
    lda #$04
    bne _8119
_8113:
    lda #$05
    bne _8119
_8117:
    lda #$03
_8119:
    sta $2d
    ldx #$02        ; a5c1 in ROM 1 (IC22)
    jmp $3300

_8120:
    ldx #$12
    stx $2d
    ldx #$04        ; a48f in ROM 1 (IC22)
    jmp $3300

_8129: a2 00     ldx #$00
$812b  d0 07     bne _8134

_812d:
    txa
    pha
    jsr _8117
    pla
    tax
_8134:
    stx $2d
    ldx #$01
    jmp $3300

_813b: a2 01     ldx #$01
$813d  20 34 81  jsr _8134
$8140  4c 13 81  jmp _8113

_8143: a2 03     ldx #$03
$8145  4c 34 81  jmp _8134
_8148: a2 05     ldx #$05
$814a  4c 34 81  jmp _8134
_814d: a2 06     ldx #$06
$814f  4c 2d 81  jmp _812d
$8152  a2 07     ldx #$07
$8154  4c 2d 81  jmp _812d
_8157: a2 08     ldx #$08
$8159  4c 2d 81  jmp _812d
_815c: a2 09     ldx #$09
$815e  4c 2d 81  jmp _812d
_8161: a2 0a     ldx #$0a
$8163  4c 34 81  jmp _8134
_8166: a2 0b     ldx #$0b
$8168  4c 2d 81  jmp _812d
_816b: a2 0c     ldx #$0c
$816d  4c 2d 81  jmp _812d
_8170: 20 17 81  jsr _8117
$8173  a2 0d     ldx #$0d
$8175  4c 2d 81  jmp _812d
_8178: a2 0e     ldx #$0e
$817a  4c 2d 81  jmp _812d
_817d: a2 10     ldx #$10
$817f  4c 2d 81  jmp _812d
_8182: a2 11     ldx #$11
$8184  4c 34 81  jmp _8134
_8187: a2 12     ldx #$12
$8189  4c 34 81  jmp _8134
_818c: a2 14     ldx #$14
$818e  4c 34 81  jmp _8134
$8191  a2 15     ldx #$15
$8193  4c 2d 81  jmp _812d
_8196: a2 16     ldx #$16
$8198  4c 2d 81  jmp _812d
$819b  a2 17     ldx #$17
$819d  4c 2d 81  jmp _812d
_81a0: a2 18     ldx #$18
$81a2  4c 34 81  jmp _8134
_81a5: a2 19     ldx #$19
$81a7  4c 2d 81  jmp _812d
_81aa: a2 1a     ldx #$1a
$81ac  4c 2d 81  jmp _812d
$81af  a2 1b     ldx #$1b
$81b1  4c 2d 81  jmp _812d
_81b4: a2 1c     ldx #$1c
$81b6  4c 2d 81  jmp _812d
_81b9: a2 1d     ldx #$1d
$81bb  4c 2d 81  jmp _812d
_81be: a2 1f     ldx #$1f
$81c0  4c 2d 81  jmp _812d
_81c3: a2 20     ldx #$20
$81c5  4c 2d 81  jmp _812d
_81c8: a2 21     ldx #$21
$81ca  4c 2d 81  jmp _812d

_81cd:
    ldx #$22
    jmp _812d

_81d2: a2 1e     ldx #$1e
$81d4  4c 2d 81  jmp _812d
$81d7  a2 0f     ldx #$0f
$81d9  4c 2d 81  jmp _812d
$81dc  ad 19 34  lda $3419
$81df  09 01     ora #$01
$81e1  8d 19 34  sta $3419
$81e4  ee ea fd  inc $fdea
$81e7  4c f8 81  jmp _81f8
_81ea: ce ea fd  dec $fdea
$81ed  2c ea fd  bit $fdea
$81f0  10 06     bpl _81f8
$81f2  00        brk
$81f3  85 00     sta $00

_81f5:
    sta $fdea      ; *
_81f8:
    lda $fdea
    ldy #$00
    ldx #$1b
    stx $2d
    ldx #$ff
    stx $3606
    ldx #$0c
    jmp $3300

_820b: 20 22 82  jsr _8222
$820e  ad eb fd  lda $fdeb
$8211  ac ec fd  ldy $fdec
$8214  a2 1a     ldx #$1a
$8216  86 2d     stx $2d
$8218  a2 ff     ldx #$ff
$821a  8e 06 36  stx $3606
$821d  a2 0c     ldx #$0c
$821f  4c 00 33  jmp $3300

_8222:       ; RAM entry point 8
    ldy $fdec
    ldx $fdeb
    inx
    bne +
    iny
*
    cpx #$e8
    tya
    sbc #$03
    bcc _8237
    ldx #$01
    ldy #$00
_8237:
    sty $fdec
    stx $fdeb
    rts

_823e:
    pha
    stx $3749
    ldy $374a
    sty $3b09
    ldy #$ff
    sty $374a
    lda $3749
    jsr _9848
    lda #$ff
    tay
    jsr _9856
    lda $3749
    cmp #$10
    beq _826d
    jsr _80a8
    bcs _826d
    lda #$c0
    sta $374a
    jmp _8288
_826d:
    lda $3749
    cmp #$90
    bne _8283
    pla
    lda #$0d
    sta $3412
    lda #$6a
    ldy #$37
    ldx #$a8
    jmp $3300
_8283:
    ldx #$bf
    jsr $3300
_8288:
    ldy #$fe
    lda $374a
    jsr _9856
    pla
    eor $374a
    cmp #$01
    lda $374a
    rts

_829a:
    lda #$30
    ldx #$10
    jmp _823e

_82a1: a2 15     ldx #$15
_82a3: bd 07 fd  lda $fd07,x
$82a6  9d 54 37  sta $3754,x
$82a9  ca        dex
$82aa  10 f7     bpl _82a3
$82ac  60        rts
_82ad: a2 00     ldx #$00
$82af  a0 00     ldy #$00
_82b1: 98        tya
$82b2  30 06     bmi _82ba
$82b4  b1 14     lda ($14),y
$82b6  c9 3b     cmp #$3b
$82b8  d0 04     bne _82be
_82ba: a0 80     ldy #$80
$82bc  a9 20     lda #$20
_82be: 9d 6a 37  sta $376a,x
$82c1  e8        inx
$82c2  c8        iny
$82c3  e0 16     cpx #$16
$82c5  90 ea     bcc _82b1
$82c7  60        rts

_82c8: ad 00 fd  lda $fd00
$82cb  8d 99 37  sta $3799
$82ce  ad ff 82  lda _82ff
$82d1  29 0f     and #$0f
$82d3  8d 98 37  sta $3798
$82d6  ad 01 83  lda _8301
$82d9  29 0f     and #$0f
$82db  0a        asl
$82dc  0a        asl
$82dd  0a        asl
$82de  0a        asl
$82df  0d 98 37  ora $3798
$82e2  8d 98 37  sta $3798
$82e5  a9 03     lda #$03
$82e7  8d 97 37  sta $3797
$82ea  a9 0f     lda #$0f
$82ec  8d 96 37  sta $3796
$82ef  ad 02 83  lda _8302
$82f2  29 0f     and #$0f
$82f4  0a        asl
$82f5  0a        asl
$82f6  0a        asl
$82f7  0a        asl
$82f8  0d 96 37  ora $3796
$82fb  8d 96 37  sta $3796
$82fe  60        rts
_82ff:
.byte 33 2e
_8301: .byte 35
_8302: .byte 30

_8303: a9 00     lda #$00
$8305  8d 9d 37  sta $379d
$8308  8d 9c 37  sta $379c
$830b  8d 9b 37  sta $379b
$830e  8d 9a 37  sta $379a
$8311  60        rts
$8312  ae cb 39  ldx $39cb
$8315  8e 4c 37  stx $374c
$8318  f0 09     beq _8323
_831a: bd ca 39  lda $39ca,x
$831d  9d 01 0b  sta $0b01,x
$8320  ca        dex
$8321  d0 f7     bne _831a
_8323: 60        rts
_8324: ae 02 0b  ldx $0b02
$8327  8e cb 39  stx $39cb
$832a  f0 09     beq _8335
_832c: bd 01 0b  lda $0b01,x
$832f  9d ca 39  sta $39ca,x
$8332  ca        dex
$8333  d0 f7     bne _832c
_8335: 60        rts
_8336: a9 00     lda #$00
$8338  8d e7 3a  sta $3ae7
$833b  8d e8 3a  sta $3ae8
$833e  8d 52 37  sta $3752
$8341  8d 4f 37  sta $374f
$8344  20 c8 82  jsr _82c8
$8347  20 03 83  jsr _8303
$834a  20 a1 82  jsr _82a1
$834d  20 ad 82  jsr _82ad
$8350  20 0e 88  jsr _880e
$8353  ad 59 39  lda $3959
$8356  8d 53 37  sta $3753
$8359  a9 40     lda #$40
$835b  a2 20     ldx #$20
$835d  4c 3e 82  jmp _823e
_8360: 20 a1 82  jsr _82a1
$8363  a9 70     lda #$70
$8365  a2 30     ldx #$30
$8367  4c 3e 82  jmp _823e
_836a: a2 00     ldx #$00
$836c  ad 9e 37  lda $379e
$836f  f0 08     beq _8379
$8371  a2 9f     ldx #$9f
$8373  20 00 33  jsr $3300
$8376  4c 88 83  jmp _8388
_8379: bd 5b 39  lda $395b,x
$837c  9d 02 0b  sta $0b02,x
$837f  e8        inx
$8380  ec 5b 39  cpx $395b
$8383  90 f4     bcc _8379
$8385  8e 4c 37  stx $374c
_8388: a9 00     lda #$00
$838a  8d e7 3a  sta $3ae7
$838d  8d e8 3a  sta $3ae8
$8390  4c e7 83  jmp _83e7
_8393: a9 00     lda #$00
$8395  8d 02 0b  sta $0b02
$8398  8d 04 0b  sta $0b04
$839b  a9 01     lda #$01
$839d  8d 03 0b  sta $0b03
$83a0  a9 03     lda #$03
$83a2  8d 4c 37  sta $374c
$83a5  a9 00     lda #$00
$83a7  8d e7 3a  sta $3ae7
$83aa  8d e8 3a  sta $3ae8
$83ad  4c e7 83  jmp _83e7
_83b0: ad 9e 37  lda $379e
$83b3  f0 06     beq _83bb
$83b5  ad 4d 37  lda $374d
$83b8  4c be 83  jmp _83be
_83bb: ad cb 39  lda $39cb
_83be: a8        tay
$83bf  c0 fd     cpy #$fd
$83c1  90 05     bcc _83c8
$83c3  f0 03     beq _83c8
$83c5  00        brk
$83c6  80        ???
$83c7  00        brk
_83c8: ae e8 3a  ldx $3ae8
$83cb  e0 ff     cpx #$ff
$83cd  f0 0d     beq _83dc
$83cf  18        clc
$83d0  6d e7 3a  adc $3ae7
$83d3  b0 07     bcs _83dc
$83d5  aa        tax
$83d6  e0 fd     cpx #$fd
$83d8  90 24     bcc _83fe
$83da  f0 22     beq _83fe
_83dc: ad e7 3a  lda $3ae7
$83df  8d 4c 37  sta $374c
$83e2  d0 03     bne _83e7
$83e4  00        brk
$83e5  81 00     sta ($00,x)
_83e7: a9 60     lda #$60
$83e9  a2 40     ldx #$40
$83eb  20 3e 82  jsr _823e
$83ee  ae e7 3a  ldx $3ae7
$83f1  f0 0a     beq _83fd
$83f3  a9 00     lda #$00
$83f5  8d e7 3a  sta $3ae7
$83f8  8d e8 3a  sta $3ae8
$83fb  90 b3     bcc _83b0
_83fd: 60        rts
_83fe: 8e e7 3a  stx $3ae7
$8401  ee e8 3a  inc $3ae8
_8404: b9 ca 39  lda $39ca,y
$8407  9d 01 0b  sta $0b01,x
$840a  ca        dex
$840b  88        dey
$840c  d0 f6     bne _8404
$840e  a9 60     lda #$60
$8410  18        clc
$8411  60        rts
_8412: 8e 4f 37  stx $374f
$8415  a2 ff     ldx #$ff
$8417  8e 50 37  stx $3750
$841a  a9 d0     lda #$d0
$841c  a2 60     ldx #$60
$841e  4c 3e 82  jmp _823e
_8421: a9 80     lda #$80
$8423  a2 70     ldx #$70
$8425  4c 3e 82  jmp _823e
_8428: a9 a0     lda #$a0
$842a  a2 80     ldx #$80
$842c  4c 3e 82  jmp _823e
_842f: 20 ad 82  jsr _82ad

_8432:
    lda #$e0
    ldx #$90
    jmp _823e

_8439: a9 00     lda #$00
$843b  8d e7 3a  sta $3ae7
$843e  8d e8 3a  sta $3ae8
$8441  8d 52 37  sta $3752
$8444  8d 4f 37  sta $374f
$8447  20 03 83  jsr _8303
$844a  a9 50     lda #$50
$844c  a2 a0     ldx #$a0
$844e  4c 3e 82  jmp _823e
_8451: a9 20     lda #$20
$8453  a2 b0     ldx #$b0
$8455  4c 3e 82  jmp _823e
_8458: a9 fa     lda #$fa
$845a  a2 c0     ldx #$c0
$845c  4c 3e 82  jmp _823e
_845f: a9 fe     lda #$fe
$8461  a2 c0     ldx #$c0
$8463  4c 3e 82  jmp _823e
_8466: a9 fb     lda #$fb
$8468  a2 e0     ldx #$e0
$846a  4c 3e 82  jmp _823e
_846d: a9 fc     lda #$fc
$846f  a2 d0     ldx #$d0
$8471  4c 3e 82  jmp _823e
_8474: a0 00     ldy #$00
$8476  b9 cb 39  lda $39cb,y
$8479  8d 4d 37  sta $374d
$847c  c9 01     cmp #$01
$847e  f0 18     beq _8498
$8480  aa        tax
$8481  ca        dex
_8482: b9 cc 39  lda $39cc,y
$8485  c9 23     cmp #$23
$8487  d0 02     bne _848b
$8489  a9 ca     lda #$ca
_848b: c9 60     cmp #$60
$848d  d0 02     bne _8491
$848f  a9 23     lda #$23
_8491: 99 cb 39  sta $39cb,y
$8494  c8        iny
$8495  ca        dex
$8496  d0 ea     bne _8482
_8498: ee 4d 37  inc $374d
$849b  a9 20     lda #$20
$849d  99 cb 39  sta $39cb,y
$84a0  c8        iny
$84a1  a9 0d     lda #$0d
$84a3  99 cb 39  sta $39cb,y
$84a6  60        rts
_84a7: 20 f9 88  jsr _88f9
$84aa  a9 00     lda #$00
$84ac  8d bc 37  sta $37bc
$84af  8d bd 37  sta $37bd
$84b2  a2 9f     ldx #$9f
$84b4  20 00 33  jsr $3300
_84b7: 20 0d 89  jsr _890d
$84ba  b0 21     bcs _84dd
$84bc  a9 00     lda #$00
$84be  20 c8 8a  jsr _8ac8
$84c1  20 74 84  jsr _8474
$84c4  ad 4d 37  lda $374d
$84c7  18        clc
$84c8  6d bd 37  adc $37bd
$84cb  8d bd 37  sta $37bd
$84ce  90 e7     bcc _84b7
$84d0  ad bc 37  lda $37bc
$84d3  69 00     adc #$00
$84d5  8d bc 37  sta $37bc
$84d8  90 dd     bcc _84b7
$84da  00        brk
$84db  c1 00     cmp ($00,x)
_84dd: 60        rts
_84de: a2 15     ldx #$15
_84e0: a9 20     lda #$20
$84e2  9d 80 37  sta $3780,x
$84e5  ca        dex
$84e6  10 f8     bpl _84e0
$84e8  60        rts
_84e9: a9 00     lda #$00
$84eb  a8        tay
_84ec: 99 c5 37  sta $37c5,y
$84ef  c8        iny
$84f0  c0 0c     cpy #$0c
$84f2  90 f8     bcc _84ec
$84f4  8d 2d 34  sta $342d
$84f7  8d 2e 34  sta $342e
$84fa  8d d2 37  sta $37d2
$84fd  a8        tay
_84fe: 99 a9 37  sta $37a9,y
$8501  c8        iny
$8502  c0 09     cpy #$09
$8504  90 f8     bcc _84fe
$8506  f0 f6     beq _84fe
$8508  60        rts
_8509: ae cb 39  ldx $39cb
$850c  ca        dex
$850d  ad 5d 39  lda $395d
$8510  29 0f     and #$0f
$8512  c9 0a     cmp #$0a
$8514  f0 07     beq _851d
$8516  e8        inx
$8517  e0 4c     cpx #$4c
$8519  90 0e     bcc _8529
$851b  a2 4a     ldx #$4a
_851d: bd cb 39  lda $39cb,x
$8520  c9 7e     cmp #$7e
$8522  d0 05     bne _8529
$8524  a9 20     lda #$20
$8526  9d cb 39  sta $39cb,x
_8529: ca        dex
$852a  d0 f1     bne _851d
$852c  60        rts
_852d: ae cb 39  ldx $39cb
$8530  e0 4c     cpx #$4c
$8532  b0 17     bcs _854b
_8534: ca        dex
$8535  f0 13     beq _854a
$8537  bd cb 39  lda $39cb,x
$853a  c9 7f     cmp #$7f
$853c  b0 04     bcs _8542
$853e  c9 20     cmp #$20
$8540  b0 f2     bcs _8534
_8542: a9 20     lda #$20
$8544  9d cb 39  sta $39cb,x
$8547  4c 34 85  jmp _8534
_854a: 18        clc
_854b: 60        rts
_854c: ae 35 3b  ldx $3b35
$854f  d0 3d     bne _858e
$8551  ad 25 3b  lda $3b25
$8554  f0 05     beq _855b
_8556: 8d 26 3b  sta $3b26
$8559  18        clc
_855a: 60        rts
_855b: a9 00     lda #$00
$855d  8d e7 3a  sta $3ae7
$8560  8d 34 3b  sta $3b34
$8563  a9 70     lda #$70
$8565  a2 50     ldx #$50
$8567  20 3e 82  jsr _823e
$856a  b0 ee     bcs _855a
$856c  20 e0 99  jsr _99e0
$856f  b0 e9     bcs _855a
$8571  a2 a2     ldx #$a2
$8573  20 00 33  jsr $3300
$8576  ad c2 37  lda $37c2
$8579  c9 ff     cmp #$ff
$857b  d0 02     bne _857f
$857d  38        sec
$857e  60        rts
_857f: ad 32 3b  lda $3b32
$8582  f0 03     beq _8587
$8584  4c ad 86  jmp _86ad
_8587: ad 02 0b  lda $0b02
$858a  c9 ff     cmp #$ff
$858c  f0 c8     beq _8556
_858e: a9 00     lda #$00
$8590  8d 20 34  sta $3420
$8593  ae e7 3a  ldx $3ae7
$8596  ac 23 3b  ldy $3b23
$8599  f0 03     beq _859e
$859b  ac 24 3b  ldy $3b24
_859e: ad 34 3b  lda $3b34
$85a1  d0 36     bne _85d9
$85a3  bd 02 0b  lda $0b02,x
$85a6  c9 ff     cmp #$ff
$85a8  f0 71     beq _861b
$85aa  c9 51     cmp #$51
$85ac  90 0e     bcc _85bc
$85ae  38        sec
$85af  e9 4f     sbc #$4f
$85b1  8d 20 34  sta $3420
_85b4: a9 50     lda #$50
$85b6  9d 02 0b  sta $0b02,x
$85b9  8d c3 37  sta $37c3
_85bc: 8d 33 3b  sta $3b33
_85bf: bd 02 0b  lda $0b02,x
$85c2  99 cb 39  sta $39cb,y
$85c5  e8        inx
$85c6  f0 09     beq _85d1
$85c8  c8        iny
$85c9  ce 33 3b  dec $3b33
$85cc  d0 f1     bne _85bf
$85ce  4c f0 85  jmp _85f0
_85d1: a9 ff     lda #$ff
$85d3  8d 34 3b  sta $3b34
$85d6  4c ea 85  jmp _85ea
_85d9: bd 02 0c  lda $0c02,x
$85dc  c9 ff     cmp #$ff
$85de  f0 3b     beq _861b
$85e0  8d 33 3b  sta $3b33
_85e3: bd 02 0c  lda $0c02,x
$85e6  99 cb 39  sta $39cb,y
$85e9  e8        inx
_85ea: c8        iny
$85eb  ce 33 3b  dec $3b33
$85ee  d0 f3     bne _85e3
_85f0: ad 20 34  lda $3420
$85f3  f0 1e     beq _8613
$85f5  ca        dex
$85f6  ac 34 3b  ldy $3b34
$85f9  d0 06     bne _8601
_85fb: 9d 02 0b  sta $0b02,x
$85fe  4c 16 86  jmp _8616
_8601: e0 ff     cpx #$ff
$8603  d0 08     bne _860d
$8605  a0 00     ldy #$00
$8607  8c 34 3b  sty $3b34
$860a  4c fb 85  jmp _85fb
_860d: 9d 02 0c  sta $0c02,x
$8610  4c 16 86  jmp _8616
_8613: ce 35 3b  dec $3b35
_8616: 8e e7 3a  stx $3ae7
$8619  18        clc
$861a  60        rts
_861b: ac c2 37  ldy $37c2
$861e  c0 4e     cpy #$4e
$8620  90 44     bcc _8666
$8622  f0 42     beq _8666
$8624  c0 4f     cpy #$4f
$8626  f0 17     beq _863f
$8628  98        tya
$8629  38        sec
$862a  e9 4f     sbc #$4f
$862c  8d c2 37  sta $37c2
$862f  ac 23 3b  ldy $3b23
$8632  f0 03     beq _8637
$8634  ac 24 3b  ldy $3b24
_8637: a9 ff     lda #$ff
$8639  8d 20 34  sta $3420
$863c  4c b4 85  jmp _85b4
_863f: 8c 33 3b  sty $3b33
$8642  c8        iny
$8643  8c b4 0b  sty $0bb4
$8646  ac 23 3b  ldy $3b23
$8649  f0 03     beq _864e
$864b  ac 24 3b  ldy $3b24
_864e: a2 00     ldx #$00
_8650: bd b4 0b  lda $0bb4,x
$8653  99 cb 39  sta $39cb,y
$8656  e8        inx
$8657  c8        iny
$8658  ce 33 3b  dec $3b33
$865b  d0 f3     bne _8650
$865d  ad be 37  lda $37be
$8660  99 cb 39  sta $39cb,y
$8663  4c 13 86  jmp _8613
_8666: c8        iny
$8667  8c c9 3a  sty $3ac9
$866a  c0 02     cpy #$02
$866c  d0 05     bne _8673
$866e  a0 fd     ldy #$fd
$8670  4c 9c 86  jmp _869c
_8673: a0 fe     ldy #$fe
$8675  ad 34 3b  lda $3b34
$8678  f0 09     beq _8683
$867a  4c 95 86  jmp _8695
_867d: bd 02 0b  lda $0b02,x
$8680  99 cb 39  sta $39cb,y
_8683: e8        inx
$8684  f0 10     beq _8696
$8686  88        dey
$8687  ce c2 37  dec $37c2
$868a  d0 f1     bne _867d
$868c  4c 9c 86  jmp _869c
_868f: bd 02 0c  lda $0c02,x
$8692  99 cb 39  sta $39cb,y
_8695: e8        inx
_8696: 88        dey
$8697  ce c2 37  dec $37c2
$869a  d0 f3     bne _868f
_869c: ad be 37  lda $37be
$869f  99 cb 39  sta $39cb,y
$86a2  ce 35 3b  dec $3b35
$86a5  a9 ff     lda #$ff
$86a7  8d 32 3b  sta $3b32
$86aa  4c 5b 85  jmp _855b
_86ad: a9 00     lda #$00
$86af  8d 32 3b  sta $3b32
$86b2  ad 02 0b  lda $0b02
$86b5  c9 01     cmp #$01
$86b7  f0 6a     beq _8723
$86b9  c9 ff     cmp #$ff
$86bb  f0 66     beq _8723
$86bd  ae 23 3b  ldx $3b23
$86c0  f0 03     beq _86c5
$86c2  ae 24 3b  ldx $3b24
_86c5: a0 fe     ldy #$fe
$86c7  b9 cb 39  lda $39cb,y
$86ca  8d 33 3b  sta $3b33
$86cd  ad 02 0b  lda $0b02
$86d0  18        clc
$86d1  6d 33 3b  adc $3b33
$86d4  b0 07     bcs _86dd
$86d6  c9 53     cmp #$53
$86d8  b0 03     bcs _86dd
$86da  4c 5b 87  jmp _875b
_86dd: a9 50     lda #$50
$86df  9d cb 39  sta $39cb,x
$86e2  8d c3 37  sta $37c3
$86e5  e8        inx
$86e6  88        dey
$86e7  38        sec
$86e8  ed 33 3b  sbc $3b33
$86eb  8d 20 34  sta $3420
$86ee  ce 33 3b  dec $3b33
_86f1: b9 cb 39  lda $39cb,y
$86f4  9d cb 39  sta $39cb,x
$86f7  e8        inx
$86f8  88        dey
$86f9  ce 33 3b  dec $3b33
$86fc  d0 f3     bne _86f1
$86fe  ad 20 34  lda $3420
$8701  8d 33 3b  sta $3b33
$8704  a0 01     ldy #$01
_8706: b9 02 0b  lda $0b02,y
$8709  9d cb 39  sta $39cb,x
$870c  c8        iny
$870d  e8        inx
$870e  ce 33 3b  dec $3b33
$8711  d0 f3     bne _8706
$8713  ad 02 0b  lda $0b02
$8716  38        sec
$8717  ed 20 34  sbc $3420
$871a  88        dey
$871b  99 02 0b  sta $0b02,y
$871e  8c e7 3a  sty $3ae7
$8721  18        clc
$8722  60        rts
_8723: a0 fe     ldy #$fe
$8725  b9 cb 39  lda $39cb,y
$8728  8d 20 34  sta $3420
$872b  98        tya
$872c  38        sec
$872d  ed 20 34  sbc $3420
$8730  a8        tay
$8731  b9 cc 39  lda $39cc,y
$8734  a0 fe     ldy #$fe
$8736  c9 20     cmp #$20
$8738  d0 03     bne _873d
$873a  ce c9 3a  dec $3ac9
_873d: ae 23 3b  ldx $3b23
$8740  f0 03     beq _8745
$8742  ae 24 3b  ldx $3b24
_8745: b9 cb 39  lda $39cb,y
$8748  8d 33 3b  sta $3b33
_874b: b9 cb 39  lda $39cb,y
$874e  9d cb 39  sta $39cb,x
$8751  e8        inx
$8752  88        dey
$8753  ce 33 3b  dec $3b33
$8756  d0 f3     bne _874b
$8758  4c 88 87  jmp _8788
_875b: a8        tay
$875c  88        dey
$875d  98        tya
$875e  a0 fe     ldy #$fe
$8760  4c 66 87  jmp _8766
_8763: b9 cb 39  lda $39cb,y
_8766: 9d cb 39  sta $39cb,x
$8769  88        dey
$876a  e8        inx
$876b  ce 33 3b  dec $3b33
$876e  d0 f3     bne _8763
$8770  ad 02 0b  lda $0b02
$8773  8d 33 3b  sta $3b33
$8776  ce 33 3b  dec $3b33
$8779  a0 01     ldy #$01
_877b: b9 02 0b  lda $0b02,y
$877e  9d cb 39  sta $39cb,x
$8781  c8        iny
$8782  e8        inx
$8783  ce 33 3b  dec $3b33
$8786  d0 f3     bne _877b
_8788: ae 02 0b  ldx $0b02
$878b  e0 ff     cpx #$ff
$878d  f0 06     beq _8795
$878f  8e e7 3a  stx $3ae7
$8792  ce 35 3b  dec $3b35
_8795: 18        clc
$8796  60        rts
_8797: ae e7 3a  ldx $3ae7
$879a  d0 10     bne _87ac
$879c  a9 70     lda #$70
$879e  a2 50     ldx #$50
$87a0  20 3e 82  jsr _823e
$87a3  b0 06     bcs _87ab
$87a5  ae 02 0b  ldx $0b02
$87a8  8e e7 3a  stx $3ae7
_87ab: 60        rts
_87ac: ec 4c 37  cpx $374c
$87af  90 0b     bcc _87bc
$87b1  a9 00     lda #$00
$87b3  8d e7 3a  sta $3ae7
$87b6  8d e8 3a  sta $3ae8
$87b9  4c 97 87  jmp _8797
_87bc: bd 02 0b  lda $0b02,x
$87bf  a8        tay
$87c0  f0 0d     beq _87cf
$87c2  18        clc
$87c3  6d e7 3a  adc $3ae7
$87c6  b0 07     bcs _87cf
$87c8  cd 4c 37  cmp $374c
$87cb  90 06     bcc _87d3
$87cd  f0 04     beq _87d3
_87cf: a9 00     lda #$00
$87d1  38        sec
$87d2  60        rts
_87d3: 8d e7 3a  sta $3ae7
$87d6  e8        inx
$87d7  8c 02 0b  sty $0b02
$87da  a0 01     ldy #$01
_87dc: cc 02 0b  cpy $0b02
$87df  b0 0b     bcs _87ec
$87e1  bd 02 0b  lda $0b02,x
$87e4  99 02 0b  sta $0b02,y
$87e7  e8        inx
$87e8  c8        iny
$87e9  4c dc 87  jmp _87dc
_87ec: ad 4a 37  lda $374a
$87ef  18        clc
$87f0  60        rts
_87f1: ae cb 39  ldx $39cb
$87f4  e8        inx
$87f5  e8        inx
$87f6  8a        txa
$87f7  18        clc
$87f8  6d bd 37  adc $37bd
$87fb  8d bd 37  sta $37bd
$87fe  90 0a     bcc _880a
$8800  a9 00     lda #$00
$8802  6d bc 37  adc $37bc
$8805  b0 04     bcs _880b
$8807  8d bc 37  sta $37bc
_880a: 60        rts
_880b: 00        brk
$880c  cb        ???
$880d  00        brk
_880e: a0 00     ldy #$00
_8810: b9 5d fd  lda $fd5d,y
$8813  0a        asl
$8814  90 02     bcc _8818
$8816  09 01     ora #$01
_8818: 49 ff     eor #$ff
$881a  99 33 34  sta $3433,y
$881d  c8        iny
$881e  c0 07     cpy #$07
$8820  d0 ee     bne _8810
$8822  60        rts
_8823: a0 07     ldy #$07
_8825: b9 5c fd  lda $fd5c,y
$8828  8d 20 34  sta $3420
$882b  b9 70 88  lda _8870,y
$882e  cd 20 34  cmp $3420
$8831  d0 06     bne _8839
$8833  88        dey
$8834  d0 ef     bne _8825
$8836  4c 55 88  jmp _8855
_8839: a0 00     ldy #$00
_883b: b9 5d fd  lda $fd5d,y
$883e  0a        asl
$883f  90 02     bcc _8843
$8841  09 01     ora #$01
_8843: 49 ff     eor #$ff
$8845  8d 20 34  sta $3420
$8848  b9 33 34  lda $3433,y
$884b  cd 20 34  cmp $3420
$884e  d0 0d     bne _885d
$8850  c8        iny
$8851  c0 07     cpy #$07
$8853  d0 e6     bne _883b
_8855: a9 00     lda #$00
$8857  8d 32 34  sta $3432
$885a  4c 65 88  jmp _8865
_885d: a9 ff     lda #$ff
$885f  8d 32 34  sta $3432
$8862  4c 65 88  jmp _8865
_8865: a2 00     ldx #$00
$8867  8a        txa
_8868: 9d 33 34  sta $3433,x
$886b  e8        inx
$886c  e0 07     cpx #$07
$886e  d0 f8     bne _8868
_8870: 60        rts

.byte 30 30 30 30 30 30 00

_8878: a9 70     lda #$70
$887a  a2 50     ldx #$50
$887c  4c 3e 82  jmp _823e
_887f: a2 4c     ldx #$4c
$8881  20 74 89  jsr _8974
$8884  a9 00     lda #$00
$8886  8d 40 39  sta $3940
$8889  60        rts

_888a:
    ldy #$17
    lda ($14),y
    sta $3940
_8891:
    ldx #$4b       ; *
    jsr _8974
    lda #$00
    sta $3940
    rts

_889c: a0 17     ldy #$17
$889e  b1 14     lda ($14),y
$88a0  8d 40 39  sta $3940
_88a3:
    lda #$01       ; *
_88a5:
    sta $3941
    sta $3942
    ldx #$4f
    jsr _8974
    lda #$5b
    sta $3943
    lda #$39
    sta $3944
    ldx #$55
    jsr _8974
    jmp _9b5c

_88c2: a9 5b     lda #$5b
$88c4  8d 43 39  sta $3943
$88c7  a9 39     lda #$39
$88c9  8d 44 39  sta $3944
$88cc  a2 52     ldx #$52
$88ce  4c 71 89  jmp _8971
_88d1: a9 cb     lda #$cb
$88d3  8d 43 39  sta $3943
$88d6  a9 39     lda #$39
$88d8  8d 44 39  sta $3944
$88db  a2 52     ldx #$52
$88dd  4c 71 89  jmp _8971
_88e0: 20 f9 88  jsr _88f9
$88e3  a0 17     ldy #$17
$88e5  b1 14     lda ($14),y
$88e7  8d 40 39  sta $3940
_88ea: a9 5b     lda #$5b
$88ec  8d 43 39  sta $3943
$88ef  a9 39     lda #$39
$88f1  8d 44 39  sta $3944
$88f4  a2 54     ldx #$54
$88f6  4c 74 89  jmp _8974

_88f9: a0 17     ldy #$17       ; *
$88fb  b1 14     lda ($14),y
$88fd  8d 40 39  sta $3940
_8900: a9 01     lda #$01
$8902  8d 41 39  sta $3941
$8905  8d 42 39  sta $3942
$8908  a2 4f     ldx #$4f
$890a  4c 74 89  jmp _8974
_890d: a0 17     ldy #$17
$890f  b1 14     lda ($14),y
$8911  8d 40 39  sta $3940
$8914  a9 00     lda #$00
$8916  8d 41 39  sta $3941
$8919  a9 01     lda #$01
$891b  8d 42 39  sta $3942
$891e  a2 50     ldx #$50
$8920  20 74 89  jsr _8974
$8923  ad 41 39  lda $3941
$8926  0d 42 39  ora $3942
$8929  38        sec
$892a  f0 24     beq _8950
$892c  a0 17     ldy #$17
$892e  b1 14     lda ($14),y
$8930  8d 40 39  sta $3940
$8933  a9 cb     lda #$cb
$8935  8d 43 39  sta $3943
$8938  a9 39     lda #$39
$893a  8d 44 39  sta $3944
$893d  a2 55     ldx #$55
$893f  20 74 89  jsr _8974
$8942  a0 18     ldy #$18
$8944  ad 41 39  lda $3941
$8947  91 14     sta ($14),y
$8949  c8        iny
$894a  ad 42 39  lda $3942
$894d  91 14     sta ($14),y
$894f  18        clc
_8950: 60        rts
$8951  a9 00     lda #$00
$8953  8d 41 39  sta $3941
$8956  a9 01     lda #$01
$8958  8d 42 39  sta $3942
$895b  a2 50     ldx #$50
$895d  20 74 89  jsr _8974
$8960  60        rts
$8961  a9 00     lda #$00
$8963  8d 41 39  sta $3941
$8966  a9 ff     lda #$ff
$8968  8d 42 39  sta $3942
$896b  a2 50     ldx #$50
$896d  20 74 89  jsr _8974
$8970  60        rts

_8971:
    sec            ; *
    bcs _8975
_8974:
    clc            ; *
_8975:
    stx $393e
    lda #$aa
    sta $3945
    lda #$3f
    ldy #$39
    php
    jsr $3300
    plp
    lda $3949
    beq _8990
    bcs _8990
    brk
_898e:
.byte 83 00
_8990:
    cmp #$01
    rts

_8993: a9 00     lda #$00
$8995  8d 4f 39  sta $394f
$8998  a9 41     lda #$41
$899a  8d 50 39  sta $3950
$899d  a9 39     lda #$39
$899f  8d 51 39  sta $3951
$89a2  a2 42     ldx #$42
$89a4  4c f8 89  jmp _89f8
_89a7: a9 02     lda #$02
$89a9  8d 4f 39  sta $394f
$89ac  4c b4 89  jmp _89b4
_89af: a9 00     lda #$00
$89b1  8d 4f 39  sta $394f
_89b4: a9 5b     lda #$5b
$89b6  8d 50 39  sta $3950
$89b9  a9 39     lda #$39
$89bb  8d 51 39  sta $3951
$89be  a2 41     ldx #$41
$89c0  4c f8 89  jmp _89f8
_89c3: a9 02     lda #$02
$89c5  8d 4f 39  sta $394f
$89c8  4c d0 89  jmp _89d0
_89cb: a9 00     lda #$00
$89cd  8d 4f 39  sta $394f
_89d0: a2 43     ldx #$43
$89d2  4c f8 89  jmp _89f8
_89d5: ad 1e fd  lda $fd1e
$89d8  8d 4f 39  sta $394f
$89db  4c e3 89  jmp _89e3

_89de:
    lda #$03
    sta $394f
_89e3:
    ldx #$40
    jmp _89f8

_89e8: ad 1e fd  lda $fd1e
$89eb  8d 4f 39  sta $394f
$89ee  4c f6 89  jmp _89f6
_89f1: a9 03     lda #$03
$89f3  8d 4f 39  sta $394f
_89f6: a2 44     ldx #$44
_89f8:
    stx $394d
    txa
    pha
    ldy #$ee
    jsr _9848
    ldy #$ff
    tya
    jsr _9856
    pla
    tax
    lda #$1b
    sta $394e
    lda #$4e
    ldy #$39
    jsr $3300
    pha
    ldy #$ee
    jsr _9856
    pla
    cmp #$01
    rts

_8a20: a2 03     ldx #$03
$8a22  86 2d     stx $2d
$8a24  a2 20     ldx #$20
$8a26  20 00 33  jsr $3300
$8a29  ee 58 39  inc $3958
$8a2c  ad 03 3b  lda $3b03
$8a2f  f0 03     beq _8a34
$8a31  ce 03 3b  dec $3b03
_8a34: 20 6c 8a  jsr _8a6c
$8a37  a9 02     lda #$02
$8a39  8d 2a 39  sta $392a
_8a3c: ac 2a 39  ldy $392a
$8a3f  b9 b2 8a  lda _8ab2,y
$8a42  85 10     sta $10
$8a44  b9 b3 8a  lda _8ab3,y
$8a47  85 11     sta $11
$8a49  f0 d5     beq _8a20
$8a4b  c8        iny
$8a4c  c8        iny
$8a4d  8c 2a 39  sty $392a
$8a50  a0 1b     ldy #$1b
$8a52  b1 10     lda ($10),y
$8a54  f0 e6     beq _8a3c
$8a56  c9 ff     cmp #$ff
$8a58  f0 e2     beq _8a3c
$8a5a  38        sec
$8a5b  e9 01     sbc #$01
$8a5d  91 10     sta ($10),y
$8a5f  d0 db     bne _8a3c
$8a61  ad 19 34  lda $3419
$8a64  09 01     ora #$01
$8a66  8d 19 34  sta $3419
$8a69  4c 3c 8a  jmp _8a3c

_8a6c:
    lda #$e8
    sta $392e
    lda #$03
    sta $392f
    lda #$00
    sta $3930
    ldx #$03
    stx $2d
    lda #$2e
    ldy #$39
    ldx #$24
    jmp $3300

_8a88:
    jsr _8a6c
    lda #$00
    sta $392a
_8a90:
    ldy $392a
    lda _8ab2,y
    sta $10
    lda _8ab3,y
    sta $11
    beq _8ab1
    lda #$00
    ldy #$1b
_8aa3:
    sta ($10),y
    dey
    bpl _8aa3
    inc $392a
    inc $392a
    jmp _8a90
_8ab1:
    rts

_8ab2: .byte 2f
_8ab3: .byte    36
.byte        4b 36
.byte        67 36
.byte        83 36
.byte        9f 36
.byte        bb 36
.byte        d7 36
.byte        f3 36
.byte        0f 37
.byte        2b 37
.byte        00 00

_8ac8: 29 01     and #$01
$8aca  4d 2c 39  eor $392c
$8acd  d0 0d     bne _8adc
_8acf: a9 01     lda #$01
$8ad1  a2 cb     ldx #$cb
$8ad3  86 2d     stx $2d
$8ad5  a0 39     ldy #$39
$8ad7  a2 8e     ldx #$8e
$8ad9  20 00 33  jsr $3300
_8adc: 60        rts
_8add: ad 2c 39  lda $392c
$8ae0  d0 0d     bne _8aef
_8ae2: a9 00     lda #$00
$8ae4  a2 cb     ldx #$cb
$8ae6  86 2d     stx $2d
$8ae8  a0 39     ldy #$39
$8aea  a2 8e     ldx #$8e
$8aec  20 00 33  jsr $3300
_8aef: 60        rts
$8af0  20 3f 8c  jsr _8c3f
$8af3  b0 17     bcs _8b0c
$8af5  6a        ror a
$8af6  90 02     bcc _8afa
$8af8  50 16     bvc _8b10
_8afa: 6a        ror a
$8afb  b0 29     bcs _8b26
$8afd  50 0d     bvc _8b0c
$8aff  ad ea fd  lda $fdea
$8b02  d0 22     bne _8b26
$8b04  ad 18 34  lda $3418
$8b07  29 df     and #$df
$8b09  8d 18 34  sta $3418
_8b0c: a9 00     lda #$00
$8b0e  18        clc
$8b0f  60        rts
_8b10: 20 8e 8c  jsr _8c8e
$8b13  09 10     ora #$10
$8b15  8d 18 34  sta $3418
$8b18  a2 04     ldx #$04
$8b1a  86 2d     stx $2d
$8b1c  a9 01     lda #$01
$8b1e  a2 27     ldx #$27
$8b20  20 00 33  jsr $3300
$8b23  a9 01     lda #$01
$8b25  60        rts
_8b26: ad 19 34  lda $3419
$8b29  29 20     and #$20
$8b2b  f0 17     beq _8b44
$8b2d  ad 18 34  lda $3418
$8b30  29 7f     and #$7f
$8b32  09 08     ora #$08
$8b34  8d 18 34  sta $3418
$8b37  a2 05     ldx #$05
$8b39  86 2d     stx $2d
$8b3b  a9 01     lda #$01
$8b3d  a2 27     ldx #$27
$8b3f  20 00 33  jsr $3300
$8b42  a9 02     lda #$02
_8b44: 60        rts
_8b45: aa        tax
$8b46  20 8e 8c  jsr _8c8e
$8b49  29 10     and #$10
$8b4b  d0 03     bne _8b50
_8b4d: 00        brk
$8b4e  90 00     bcc _8b50
_8b50: e0 01     cpx #$01
$8b52  d0 0e     bne _8b62
$8b54  a9 ff     lda #$ff
$8b56  8d 51 37  sta $3751
$8b59  20 9c 8b  jsr _8b9c
$8b5c  20 97 8c  jsr _8c97
$8b5f  4c 7e 8b  jmp _8b7e
_8b62: e0 02     cpx #$02
$8b64  f0 04     beq _8b6a
$8b66  e0 03     cpx #$03
$8b68  d0 e3     bne _8b4d
_8b6a: ad 2b 36  lda $362b
$8b6d  8d 51 37  sta $3751
$8b70  20 94 8b  jsr _8b94
$8b73  20 43 8d  jsr _8d43
$8b76  ad 52 37  lda $3752
$8b79  d0 03     bne _8b7e
$8b7b  20 9f 80  jsr _809f
_8b7e: ad 18 34  lda $3418
$8b81  29 ee     and #$ee
$8b83  09 80     ora #$80
$8b85  8d 18 34  sta $3418
$8b88  a2 04     ldx #$04
$8b8a  86 2d     stx $2d
$8b8c  a2 20     ldx #$20
$8b8e  20 00 33  jsr $3300
$8b91  4c 45 8b  jmp _8b45
_8b94: a9 00     lda #$00
$8b96  8d 59 39  sta $3959
$8b99  4c 96 80  jmp _8096
_8b9c: a9 ff     lda #$ff
$8b9e  8d 59 39  sta $3959
$8ba1  60        rts
_8ba2: a2 00     ldx #$00
$8ba4  8e 4a 37  stx $374a
$8ba7  aa        tax
$8ba8  20 8e 8c  jsr _8c8e
$8bab  29 08     and #$08
$8bad  d0 03     bne _8bb2
$8baf  00        brk
$8bb0  86 00     stx $00
_8bb2: e0 01     cpx #$01
$8bb4  d0 09     bne _8bbf
$8bb6  20 9c 8b  jsr _8b9c
$8bb9  20 65 91  jsr _9165
$8bbc  4c e7 8b  jmp _8be7
_8bbf: e0 02     cpx #$02
$8bc1  d0 09     bne _8bcc
$8bc3  20 94 8b  jsr _8b94
$8bc6  20 ef 91  jsr _91ef
$8bc9  4c df 8b  jmp _8bdf
_8bcc: e0 04     cpx #$04
$8bce  d0 0c     bne _8bdc
$8bd0  20 94 8b  jsr _8b94
$8bd3  20 20 81  jsr _8120
$8bd6  20 7c 92  jsr _927c
$8bd9  4c df 8b  jmp _8bdf
_8bdc: 00        brk
$8bdd  87        ???
$8bde  00        brk
_8bdf: a9 00     lda #$00
$8be1  8d 2f 36  sta $362f
$8be4  20 9f 80  jsr _809f
_8be7: ad 18 34  lda $3418
$8bea  29 f7     and #$f7
$8bec  09 80     ora #$80
$8bee  8d 18 34  sta $3418
$8bf1  a2 05     ldx #$05
$8bf3  86 2d     stx $2d
$8bf5  a2 20     ldx #$20
$8bf7  20 00 33  jsr $3300
$8bfa  4c a2 8b  jmp _8ba2
_8bfd: ad 19 34  lda $3419
$8c00  29 fe     and #$fe
$8c02  8d 19 34  sta $3419
$8c05  a9 00     lda #$00
$8c07  48        pha
$8c08  4c 14 8c  jmp _8c14

_8c0b:
    lda #$02
    pha
    jmp _8c14
_8c11:
    lda #$01
    pha
_8c14:
    jsr _807d
    lda $3418
    and #$e7
    ldx $3b06
    bne _8c23
    and #$fe
_8c23:
    ora #$80
    sta $3418
    ldx #$00
    stx $3b06
    jsr _807d
    ldx #$07
    stx $2d
    lda #$01
    ldx #$27
    jsr $3300
    pla
    cmp #$01
    rts

_8c3f: ad 19 34  lda $3419
$8c42  29 18     and #$18
$8c44  d0 44     bne _8c8a
$8c46  a2 00     ldx #$00
$8c48  a9 01     lda #$01
$8c4a  2c 18 34  bit $3418
$8c4d  f0 13     beq _8c62
$8c4f  e8        inx
$8c50  ad 06 3b  lda $3b06
$8c53  f0 0d     beq _8c62
$8c55  a2 06     ldx #$06
$8c57  86 2d     stx $2d
$8c59  a9 01     lda #$01
$8c5b  a2 27     ldx #$27
$8c5d  20 00 33  jsr $3300
$8c60  a2 01     ldx #$01
_8c62: a9 80     lda #$80
$8c64  2c 18 34  bit $3418
$8c67  f0 21     beq _8c8a
$8c69  ad ea fd  lda $fdea
$8c6c  f0 0e     beq _8c7c
$8c6e  ad 03 3b  lda $3b03
$8c71  d0 09     bne _8c7c
$8c73  ad 19 34  lda $3419
$8c76  29 01     and #$01
$8c78  f0 02     beq _8c7c
$8c7a  e8        inx
$8c7b  e8        inx
_8c7c: a9 20     lda #$20
$8c7e  2c 18 34  bit $3418
$8c81  b8        clv
$8c82  f0 03     beq _8c87
$8c84  2c 29 39  bit $3929
_8c87: 8a        txa
$8c88  18        clc
$8c89  60        rts
_8c8a: a9 00     lda #$00
$8c8c  38        sec
$8c8d  60        rts
_8c8e: ad 18 34  lda $3418
$8c91  29 7f     and #$7f
$8c93  8d 18 34  sta $3418
$8c96  60        rts
_8c97: 20 82 81  jsr _8182
$8c9a  a2 fa     ldx #$fa
$8c9c  a9 96     lda #$96
$8c9e  a0 00     ldy #$00
$8ca0  20 dd 8c  jsr _8cdd
$8ca3  b0 2c     bcs _8cd1
$8ca5  ad 2b 36  lda $362b
$8ca8  c9 00     cmp #$00
$8caa  d0 16     bne _8cc2
$8cac  a9 0e     lda #$0e
$8cae  a0 06     ldy #$06
$8cb0  a2 cd     ldx #$cd
$8cb2  20 dd 8c  jsr _8cdd
$8cb5  b0 1a     bcs _8cd1
$8cb7  a2 fa     ldx #$fa
$8cb9  a9 f4     lda #$f4
$8cbb  a0 01     ldy #$01
$8cbd  20 dd 8c  jsr _8cdd
$8cc0  b0 0f     bcs _8cd1
_8cc2: ad 2b 36  lda $362b
$8cc5  c9 00     cmp #$00
$8cc7  d0 05     bne _8cce
$8cc9  a2 96     ldx #$96
$8ccb  20 00 33  jsr $3300
_8cce: 4c 43 8d  jmp _8d43
_8cd1: a2 12     ldx #$12
$8cd3  86 2d     stx $2d
$8cd5  a2 04     ldx #$04
$8cd7  20 00 33  jsr $3300
$8cda  4c 11 8c  jmp _8c11
_8cdd: 48        pha
$8cde  a9 ff     lda #$ff
$8ce0  8d 07 3b  sta $3b07
$8ce3  68        pla
$8ce4  8d 0f 3b  sta $3b0f
$8ce7  8c 10 3b  sty $3b10
$8cea  a9 00     lda #$00
$8cec  8d 11 3b  sta $3b11
$8cef  8e 1c 3b  stx $3b1c
$8cf2  a9 ff     lda #$ff
$8cf4  a8        tay
$8cf5  a2 1d     ldx #$1d
$8cf7  20 31 8d  jsr _8d31
$8cfa  a2 0d     ldx #$0d
$8cfc  86 2d     stx $2d
$8cfe  a2 26     ldx #$26
$8d00  20 00 33  jsr $3300
$8d03  a9 0f     lda #$0f
$8d05  a0 3b     ldy #$3b
$8d07  a2 0d     ldx #$0d
$8d09  86 2d     stx $2d
$8d0b  a2 22     ldx #$22
$8d0d  20 00 33  jsr $3300
$8d10  08        php
$8d11  a9 0f     lda #$0f
$8d13  a0 3b     ldy #$3b
$8d15  a2 25     ldx #$25
$8d17  20 00 33  jsr $3300
$8d1a  28        plp
$8d1b  b0 0e     bcs _8d2b
$8d1d  38        sec
$8d1e  10 0b     bpl _8d2b
$8d20  a2 1e     ldx #$1e
$8d22  20 31 8d  jsr _8d31
$8d25  ad 18 3b  lda $3b18
$8d28  cd 1c 3b  cmp $3b1c
_8d2b: a9 00     lda #$00
$8d2d  8d 07 3b  sta $3b07
$8d30  60        rts
_8d31: 8e 17 3b  stx $3b17
$8d34  8d 1a 3b  sta $3b1a
$8d37  8c 1b 3b  sty $3b1b
$8d3a  a9 81     lda #$81
$8d3c  a2 15     ldx #$15
$8d3e  a0 3b     ldy #$3b
$8d40  4c f1 ff  jmp OSWORD
_8d43: ad 08 3b  lda $3b08
$8d46  8d 0a 3b  sta $3b0a
$8d49  20 87 81  jsr _8187
$8d4c  a9 00     lda #$00
$8d4e  8d eb 3a  sta $3aeb
$8d51  8d 9e 37  sta $379e
$8d54  20 96 80  jsr _8096
$8d57  a9 ff     lda #$ff
$8d59  8d 32 34  sta $3432
$8d5c  ad 0c 3b  lda $3b0c
$8d5f  d0 06     bne _8d67
$8d61  20 e9 84  jsr _84e9
$8d64  20 39 84  jsr _8439
_8d67: a9 00     lda #$00
$8d69  8d 0c 3b  sta $3b0c
$8d6c  ad 4a 37  lda $374a
$8d6f  c9 50     cmp #$50
$8d71  f0 08     beq _8d7b
$8d73  20 8c 81  jsr _818c
$8d76  a9 0a     lda #$0a
$8d78  4c e8 90  jmp _90e8
_8d7b: 20 bb 99  jsr _99bb
$8d7e  b0 47     bcs _8dc7
$8d80  20 c8 82  jsr _82c8
$8d83  ad 2d 39  lda $392d
$8d86  f0 0a     beq _8d92
$8d88  20 de 89  jsr _89de
$8d8b  90 05     bcc _8d92
$8d8d  a9 00     lda #$00
$8d8f  8d 2d 39  sta $392d
_8d92: ad 1e fd  lda $fd1e
$8d95  f0 0f     beq _8da6
$8d97  20 d5 89  jsr _89d5
$8d9a  90 0a     bcc _8da6
$8d9c  20 b4 81  jsr _81b4
$8d9f  a9 0b     lda #$0b
$8da1  a2 06     ldx #$06
$8da3  4c e3 90  jmp _90e3
_8da6: a9 03     lda #$03
$8da8  0d 0a 3b  ora $3b0a
$8dab  8d 97 37  sta $3797
$8dae  ad 2d 39  lda $392d
$8db1  09 0d     ora #$0d
$8db3  8d 96 37  sta $3796
$8db6  20 60 83  jsr _8360
$8db9  90 14     bcc _8dcf
$8dbb  ad 9e 37  lda $379e
$8dbe  f0 07     beq _8dc7
$8dc0  ad 4a 37  lda $374a
$8dc3  c9 fe     cmp #$fe
$8dc5  f0 08     beq _8dcf
_8dc7: 20 96 81  jsr _8196
$8dca  a9 0c     lda #$0c
$8dcc  4c e8 90  jmp _90e8
_8dcf: ad 9e 37  lda $379e
$8dd2  f0 21     beq _8df5
$8dd4  a2 a4     ldx #$a4
$8dd6  20 00 33  jsr $3300
_8dd9: 20 3f 9b  jsr _9b3f
$8ddc  90 0d     bcc _8deb
$8dde  a9 01     lda #$01
$8de0  8d a2 37  sta $37a2
$8de3  20 5f 84  jsr _845f
$8de6  90 f1     bcc _8dd9
_8de8: 4c c7 8d  jmp _8dc7
_8deb: a9 00     lda #$00
$8ded  8d a2 37  sta $37a2
$8df0  20 58 84  jsr _8458
$8df3  b0 f3     bcs _8de8
_8df5: a9 03     lda #$03
$8df7  2c 38 3b  bit $3b38
$8dfa  30 02     bmi _8dfe
$8dfc  a9 04     lda #$04
_8dfe: 8d 3f 39  sta $393f
$8e01  a2 47     ldx #$47
$8e03  20 71 89  jsr _8971
$8e06  a9 00     lda #$00
$8e08  6a        ror a
$8e09  49 80     eor #$80
$8e0b  8d eb 3a  sta $3aeb
$8e0e  ad 9e 37  lda $379e
$8e11  d0 24     bne _8e37
$8e13  ad 4c 37  lda $374c
$8e16  c9 66     cmp #$66
$8e18  f0 0a     beq _8e24
_8e1a: 20 96 81  jsr _8196
$8e1d  a9 0d     lda #$0d
$8e1f  a2 02     ldx #$02
$8e21  4c e3 90  jmp _90e3
_8e24: ae 02 0b  ldx $0b02
$8e27  e0 66     cpx #$66
$8e29  d0 ef     bne _8e1a
_8e2b: bd 01 0b  lda $0b01,x
$8e2e  9d 5a 39  sta $395a,x
$8e31  ca        dex
$8e32  d0 f7     bne _8e2b
$8e34  4c 5f 8e  jmp _8e5f
_8e37: 20 e0 99  jsr _99e0
$8e3a  b0 de     bcs _8e1a
$8e3c  a2 9e     ldx #$9e
$8e3e  20 00 33  jsr $3300
$8e41  ad 1d 3b  lda $3b1d
$8e44  c9 ff     cmp #$ff
$8e46  f0 d2     beq _8e1a
$8e48  ad c1 37  lda $37c1
$8e4b  d0 0a     bne _8e57
$8e4d  ad 1d 3b  lda $3b1d
$8e50  c9 f8     cmp #$f8
$8e52  f0 0b     beq _8e5f
$8e54  4c 1a 8e  jmp _8e1a

_8e57: 20 78 88  jsr _8878
$8e5a  90 db     bcc _8e37
$8e5c  4c 08 90  jmp _9008
_8e5f: 20 5c 9b  jsr _9b5c
$8e62  b0 b6     bcs _8e1a
$8e64  ad 32 34  lda $3432
$8e67  f0 1c     beq _8e85
$8e69  a9 70     lda #$70
$8e6b  2c 5d 39  bit $395d
$8e6e  f0 03     beq _8e73
$8e70  4c 7a 8e  jmp _8e7a
_8e73: a9 03     lda #$03
$8e75  2c 5c 39  bit $395c
$8e78  f0 0b     beq _8e85
_8e7a: 20 d2 81  jsr _81d2
$8e7d  38        sec
$8e7e  a9 16     lda #$16
$8e80  a2 08     ldx #$08
$8e82  4c e3 90  jmp _90e3
_8e85: ad 5c 39  lda $395c
$8e88  09 40     ora #$40
$8e8a  8d 5c 39  sta $395c
$8e8d  ad 2d 39  lda $392d
$8e90  0d 1e fd  ora $fd1e
$8e93  d0 18     bne _8ead
$8e95  ad 5d 39  lda $395d
$8e98  29 0f     and #$0f
$8e9a  c9 0a     cmp #$0a
$8e9c  f0 05     beq _8ea3
$8e9e  ad eb 3a  lda $3aeb
$8ea1  d0 29     bne _8ecc
_8ea3: 20 b9 81  jsr _81b9
$8ea6  a9 0e     lda #$0e
$8ea8  a2 07     ldx #$07
$8eaa  4c e3 90  jmp _90e3
_8ead: a9 01     lda #$01
$8eaf  8d 4b 39  sta $394b
$8eb2  8d 4c 39  sta $394c
$8eb5  20 c8 90  jsr _90c8
$8eb8  20 af 89  jsr _89af
$8ebb  90 0a     bcc _8ec7
$8ebd  20 b9 81  jsr _81b9
$8ec0  a9 0f     lda #$0f
$8ec2  a2 07     ldx #$07
$8ec4  4c e3 90  jmp _90e3
_8ec7: ad eb 3a  lda $3aeb
$8eca  f0 33     beq _8eff
_8ecc: ad 9e 37  lda $379e
$8ecf  d0 0b     bne _8edc
$8ed1  ae 65 39  ldx $3965
$8ed4  bd 5b 39  lda $395b,x
$8ed7  09 10     ora #$10
$8ed9  9d 5b 39  sta $395b,x
_8edc: ad 5d 39  lda $395d
$8edf  29 0f     and #$0f
$8ee1  c9 0a     cmp #$0a
$8ee3  d0 08     bne _8eed
$8ee5  ad 2c 39  lda $392c
$8ee8  f0 08     beq _8ef2
$8eea  4c a3 8e  jmp _8ea3
_8eed: 20 c2 88  jsr _88c2
$8ef0  90 0d     bcc _8eff
_8ef2: 20 7f 88  jsr _887f
$8ef5  a9 00     lda #$00
$8ef7  8d eb 3a  sta $3aeb
$8efa  2c 38 3b  bit $3b38
$8efd  30 a4     bmi _8ea3
_8eff: 20 a0 81  jsr _81a0
_8f02: ad 9e 37  lda $379e
$8f05  d0 03     bne _8f0a
$8f07  4c 59 8f  jmp _8f59
_8f0a: ad 21 3b  lda $3b21
$8f0d  f0 0d     beq _8f1c
$8f0f  a2 a0     ldx #$a0
$8f11  20 00 33  jsr $3300
$8f14  ad 21 3b  lda $3b21
$8f17  f0 03     beq _8f1c
$8f19  4c b2 8f  jmp _8fb2
_8f1c: ad 23 3b  lda $3b23
$8f1f  c9 10     cmp #$10
$8f21  f0 11     beq _8f34
$8f23  c9 30     cmp #$30
$8f25  f0 0d     beq _8f34
$8f27  20 4c 85  jsr _854c
$8f2a  90 03     bcc _8f2f
$8f2c  4c 08 90  jmp _9008
_8f2f: ad 26 3b  lda $3b26
$8f32  d0 0f     bne _8f43
_8f34: a2 9d     ldx #$9d
$8f36  20 00 33  jsr $3300
$8f39  ad 23 3b  lda $3b23
$8f3c  c9 20     cmp #$20
$8f3e  f0 dc     beq _8f1c
$8f40  4c b2 8f  jmp _8fb2
_8f43: ad 23 3b  lda $3b23
$8f46  d0 03     bne _8f4b
$8f48  4c 17 90  jmp _9017
_8f4b: ad 24 3b  lda $3b24
$8f4e  8d cb 39  sta $39cb
$8f51  a9 00     lda #$00
$8f53  8d 23 3b  sta $3b23
$8f56  4c b2 8f  jmp _8fb2
_8f59: 20 97 87  jsr _8797
$8f5c  90 05     bcc _8f63
$8f5e  a9 10     lda #$10
$8f60  4c e8 90  jmp _90e8
_8f63: ad 02 0b  lda $0b02
$8f66  d0 03     bne _8f6b
$8f68  4c 01 90  jmp _9001
_8f6b: 20 24 83  jsr _8324
$8f6e  a9 10     lda #$10
$8f70  2c 5c 39  bit $395c
$8f73  f0 07     beq _8f7c
$8f75  a9 02     lda #$02
$8f77  2c 5c 39  bit $395c
$8f7a  d0 3f     bne _8fbb
_8f7c: ad 5d 39  lda $395d
$8f7f  29 0f     and #$0f
$8f81  c9 0a     cmp #$0a
$8f83  d0 1c     bne _8fa1
$8f85  ae cb 39  ldx $39cb
$8f88  e0 86     cpx #$86
$8f8a  b0 7c     bcs _9008
$8f8c  20 34 85  jsr _8534
$8f8f  b0 77     bcs _9008
$8f91  20 09 85  jsr _8509
$8f94  a9 cb     lda #$cb
$8f96  8d 43 39  sta $3943
$8f99  a9 39     lda #$39
$8f9b  8d 44 39  sta $3944
$8f9e  4c d8 8f  jmp _8fd8
_8fa1: a9 01     lda #$01
$8fa3  20 c8 8a  jsr _8ac8
$8fa6  a9 10     lda #$10
$8fa8  2c 5c 39  bit $395c
$8fab  d0 05     bne _8fb2
$8fad  20 2d 85  jsr _852d
$8fb0  b0 56     bcs _9008
_8fb2: 20 09 85  jsr _8509
$8fb5  20 e2 8a  jsr _8ae2
$8fb8  4c be 8f  jmp _8fbe
_8fbb: 20 dd 8a  jsr _8add
_8fbe: ad 9e 37  lda $379e
$8fc1  f0 03     beq _8fc6
$8fc3  20 f1 87  jsr _87f1
_8fc6: ad eb 3a  lda $3aeb
$8fc9  f0 0d     beq _8fd8
$8fcb  20 d1 88  jsr _88d1
$8fce  90 08     bcc _8fd8
$8fd0  20 7f 88  jsr _887f
$8fd3  a9 00     lda #$00
$8fd5  8d eb 3a  sta $3aeb
_8fd8: ad 2d 39  lda $392d
$8fdb  0d 1e fd  ora $fd1e
$8fde  f0 1e     beq _8ffe
$8fe0  ad 5d 39  lda $395d
$8fe3  29 0f     and #$0f
$8fe5  c9 0a     cmp #$0a
$8fe7  f0 03     beq _8fec
$8fe9  20 cf 8a  jsr _8acf
_8fec: 20 b6 90  jsr _90b6
$8fef  20 93 89  jsr _8993
$8ff2  90 0a     bcc _8ffe
$8ff4  20 b9 81  jsr _81b9
$8ff7  a9 12     lda #$12
$8ff9  a2 07     ldx #$07
$8ffb  4c e3 90  jmp _90e3
_8ffe: 4c 02 8f  jmp _8f02
_9001: ad 03 0b  lda $0b03
$9004  c9 01     cmp #$01
$9006  f0 0a     beq _9012
_9008: 20 aa 81  jsr _81aa
$900b  a9 15     lda #$15
$900d  a2 01     ldx #$01
$900f  4c e3 90  jmp _90e3
_9012: ad 04 0b  lda $0b04
$9015  d0 f1     bne _9008
_9017: ad 2d 39  lda $392d
$901a  0d 1e fd  ora $fd1e
$901d  f0 0f     beq _902e
$901f  20 cb 89  jsr _89cb
$9022  90 0a     bcc _902e
$9024  20 b9 81  jsr _81b9
$9027  a9 11     lda #$11
$9029  a2 07     ldx #$07
$902b  4c e3 90  jmp _90e3
_902e: ad 9e 37  lda $379e
$9031  f0 32     beq _9065
$9033  ad eb 3a  lda $3aeb
$9036  f0 12     beq _904a
$9038  ad bd 37  lda $37bd
$903b  8d be 39  sta $39be
$903e  ad bc 37  lda $37bc
$9041  8d bf 39  sta $39bf
$9044  20 00 89  jsr _8900
$9047  20 ea 88  jsr _88ea
_904a: a9 fd     lda #$fd
$904c  a2 50     ldx #$50
$904e  20 3e 82  jsr _823e
$9051  90 03     bcc _9056
$9053  4c 74 90  jmp _9074
_9056: 20 d5 90  jsr _90d5
$9059  20 6d 84  jsr _846d
$905c  90 28     bcc _9086
$905e  c9 fe     cmp #$fe
$9060  d0 12     bne _9074
$9062  4c cf 8d  jmp _8dcf
_9065: 20 97 87  jsr _8797
$9068  b0 06     bcs _9070
$906a  20 d5 90  jsr _90d5
$906d  4c f5 8d  jmp _8df5
_9070: c9 90     cmp #$90
$9072  f0 12     beq _9086
_9074: 20 aa 81  jsr _81aa
$9077  a9 13     lda #$13
$9079  ae 9e 37  ldx $379e
$907c  f0 05     beq _9083
$907e  a2 00     ldx #$00
$9080  4c e3 90  jmp _90e3
_9083: 4c e8 90  jmp _90e8
_9086: 20 be 81  jsr _81be
$9089  20 65 88  jsr _8865
$908c  20 27 91  jsr _9127
$908f  20 21 84  jsr _8421
$9092  90 03     bcc _9097
$9094  20 9a 82  jsr _829a
_9097: ad 9e 37  lda $379e
$909a  d0 17     bne _90b3
$909c  20 d5 90  jsr _90d5
$909f  ad 0a 3b  lda $3b0a
$90a2  f0 0f     beq _90b3
$90a4  20 cd 81  jsr _81cd
$90a7  20 0f 81  jsr _810f
$90aa  20 18 94  jsr _9418
$90ad  20 20 81  jsr _8120
$90b0  20 9f 80  jsr _809f
_90b3: 4c 11 8c  jmp _8c11
_90b6: ad 4c 39  lda $394c
$90b9  c9 34     cmp #$34
$90bb  90 08     bcc _90c5
$90bd  ee 4b 39  inc $394b
$90c0  a9 00     lda #$00
$90c2  8d 4c 39  sta $394c
_90c5: ee 4c 39  inc $394c
_90c8: ad 4b 39  lda $394b
$90cb  8d 41 39  sta $3941
$90ce  ad 4c 39  lda $394c
$90d1  8d 42 39  sta $3942
$90d4  60        rts
_90d5: ad eb 3a  lda $3aeb
$90d8  f0 08     beq _90e2
$90da  20 91 88  jsr _8891
$90dd  a9 00     lda #$00
$90df  8d eb 3a  sta $3aeb
_90e2: 60        rts
_90e3: 48        pha
$90e4  20 12 84  jsr _8412
$90e7  68        pla
_90e8: 8d 04 3b  sta $3b04
$90eb  ad 4a 37  lda $374a
$90ee  c9 b0     cmp #$b0
$90f0  d0 0a     bne _90fc
$90f2  ad 04 3b  lda $3b04
$90f5  c9 0a     cmp #$0a
$90f7  f0 03     beq _90fc
$90f9  20 a5 81  jsr _81a5
_90fc: ad eb 3a  lda $3aeb
$90ff  f0 10     beq _9111
$9101  ad 04 3b  lda $3b04
$9104  c9 13     cmp #$13
$9106  f0 06     beq _910e
$9108  20 7f 88  jsr _887f
$910b  4c 11 91  jmp _9111
_910e: 20 91 88  jsr _8891
_9111: 20 27 91  jsr _9127
$9114  ad 4a 37  lda $374a
$9117  c9 c0     cmp #$c0
$9119  d0 03     bne _911e
$911b  20 43 81  jsr _8143
_911e: 20 38 91  jsr _9138
$9121  20 9a 82  jsr _829a
$9124  4c 0b 8c  jmp _8c0b
_9127: ad 2d 39  lda $392d
$912a  f0 03     beq _912f
$912c  20 f1 89  jsr _89f1
_912f: ad 1e fd  lda $fd1e
$9132  f0 03     beq _9137
$9134  20 e8 89  jsr _89e8
_9137: 60        rts
_9138: ad 4a 37  lda $374a
$913b  c9 80     cmp #$80
$913d  d0 1e     bne _915d
$913f  ad 9e 37  lda $379e
$9142  f0 05     beq _9149
$9144  a2 00     ldx #$00
$9146  4c 56 91  jmp _9156
_9149: ad 29 34  lda $3429
$914c  aa        tax
$914d  f0 0e     beq _915d
$914f  ca        dex
$9150  e0 08     cpx #$08
$9152  90 02     bcc _9156
$9154  a2 00     ldx #$00
_9156: bd 5e 91  lda _915e,x
$9159  aa        tax
$915a  4c 2d 81  jmp _812d
_915d: 60        rts
_915e: 1a        ???
$915f  16 15     asl $15,x
$9161  17        ???
$9162  1b        ???
$9163  1a        ???
$9164  1a        ???
_9165: 20 64 98  jsr _9864
$9168  90 03     bcc _916d
$916a  4c eb 91  jmp _91eb
_916d: c0 00     cpy #$00
$916f  f0 03     beq _9174
$9171  4c 78 91  jmp _9178
_9174: 4c fd 8b  jmp _8bfd
$9177  60        rts
_9178: 85 14     sta $14
$917a  84 15     sty $15
$917c  20 b7 98  jsr _98b7
$917f  90 03     bcc _9184
$9181  4c fd 8b  jmp _8bfd
_9184: a2 00     ldx #$00
$9186  a0 00     ldy #$00
$9188  b8        clv
_9189: e0 1f     cpx #$1f
$918b  b0 2b     bcs _91b8
$918d  bd c8 3a  lda $3ac8,x
$9190  c9 3b     cmp #$3b
$9192  f0 27     beq _91bb
$9194  c9 20     cmp #$20
$9196  f0 1c     beq _91b4
$9198  c9 30     cmp #$30
$919a  90 04     bcc _91a0
$919c  c9 3a     cmp #$3a
$919e  90 0d     bcc _91ad
_91a0: c9 58     cmp #$58
$91a2  f0 04     beq _91a8
$91a4  c9 78     cmp #$78
$91a6  d0 0c     bne _91b4
_91a8: 70 0e     bvs _91b8
$91aa  2c 29 39  bit $3929
_91ad: c0 16     cpy #$16
$91af  b0 07     bcs _91b8
$91b1  91 14     sta ($14),y
$91b3  c8        iny
_91b4: e8        inx
$91b5  4c 89 91  jmp _9189
_91b8: 00        brk
$91b9  88        dey
$91ba  00        brk
_91bb: a9 20     lda #$20
_91bd: c0 16     cpy #$16
$91bf  b0 06     bcs _91c7
$91c1  91 14     sta ($14),y
$91c3  c8        iny
$91c4  4c bd 91  jmp _91bd
_91c7: a0 17     ldy #$17
$91c9  ad 40 39  lda $3940
$91cc  91 14     sta ($14),y
$91ce  a0 1a     ldy #$1a
$91d0  a9 00     lda #$00
$91d2  91 14     sta ($14),y
$91d4  20 9c 96  jsr _969c
$91d7  ad c8 3a  lda $3ac8
$91da  49 2d     eor #$2d
$91dc  c9 01     cmp #$01
$91de  a0 16     ldy #$16
$91e0  b1 14     lda ($14),y
$91e2  29 7f     and #$7f
$91e4  90 02     bcc _91e8
$91e6  49 80     eor #$80
_91e8: 91 14     sta ($14),y
$91ea  60        rts
_91eb: 85 14     sta $14
$91ed  84 15     sty $15
_91ef: 20 de 89  jsr _89de
$91f2  90 06     bcc _91fa
$91f4  20 29 81  jsr _8129
$91f7  4c 11 8c  jmp _8c11
_91fa: 20 9c 88  jsr _889c
$91fd  90 03     bcc _9202
$91ff  00        brk
$9200  89        ???
$9201  00        brk
_9202: 20 db 98  jsr _98db
$9205  90 03     bcc _920a
$9207  00        brk
$9208  8a        txa
$9209  00        brk
_920a: bd 94 39  lda $3994,x
$920d  10 03     bpl _9212
$920f  00        brk
$9210  8b        ???
$9211  00        brk
_9212: ad 18 34  lda $3418
$9215  29 20     and #$20
$9217  f0 0d     beq _9226
$9219  ad 18 34  lda $3418
$921c  29 bf     and #$bf
$921e  49 00     eor #$00
$9220  8d 18 34  sta $3418
$9223  4c 62 92  jmp _9262
_9226: a0 1b     ldy #$1b
$9228  b1 14     lda ($14),y
$922a  c9 ff     cmp #$ff
$922c  d0 10     bne _923e
$922e  ad 18 34  lda $3418
$9231  29 bf     and #$bf
$9233  49 00     eor #$00
$9235  8d 18 34  sta $3418
$9238  4c 62 92  jmp _9262
_923b:
.byte 00 8c 00

_923e: a0 1b     ldy #$1b
$9240  b1 14     lda ($14),y
$9242  d0 f7     bne _923b
$9244  ad 18 34  lda $3418
$9247  29 bf     and #$bf
$9249  49 40     eor #$40
$924b  8d 18 34  sta $3418
$924e  ad 5c 39  lda $395c
$9251  29 10     and #$10
$9253  f0 05     beq _925a
$9255  a9 00     lda #$00
$9257  4c 5c 92  jmp _925c
_925a: a9 ff     lda #$ff
_925c: 8d 9e 37  sta $379e
$925f  8d d1 37  sta $37d1
_9262: 20 ea 88  jsr _88ea
$9265  20 6b 92  jsr _926b
$9268  4c 7c 92  jmp _927c
_926b: 20 db 98  jsr _98db
$926e  8a        txa
$926f  18        clc
$9270  69 39     adc #$39
$9272  8d 65 39  sta $3965
$9275  ad 5a 39  lda $395a
$9278  8d 66 39  sta $3966
$927b  60        rts
_927c: ad 18 34  lda $3418
$927f  29 08     and #$08
$9281  d0 03     bne _9286
$9283  00        brk
$9284  8e 00
_9286: a9 00     lda #$00
$9288  8d 2c 39  sta $392c
$928b  20 a7 84  jsr _84a7
$928e  20 de 84  jsr _84de
$9291  20 e9 84  jsr _84e9
$9294  20 8c 95  jsr _958c
$9297  90 0b     bcc _92a4
$9299  20 96 95  jsr _9596
$929c  b0 03     bcs _92a1
$929e  20 20 81  jsr _8120
_92a1: 4c 3e 93  jmp _933e
_92a4: ad 59 39  lda $3959
$92a7  f0 22     beq _92cb
$92a9  20 3b 81  jsr _813b
$92ac  20 96 80  jsr _8096
$92af  a9 ff     lda #$ff
$92b1  8d 06 3b  sta $3b06
$92b4  20 18 94  jsr _9418
$92b7  b0 0a     bcs _92c3
$92b9  a9 00     lda #$00
$92bb  8d 06 3b  sta $3b06
$92be  20 a8 80  jsr _80a8
$92c1  b0 08     bcs _92cb
_92c3: 20 20 81  jsr _8120
$92c6  a9 ff     lda #$ff
$92c8  4c db 95  jmp _95db
_92cb: 20 20 81  jsr _8120
$92ce  ad 59 39  lda $3959
$92d1  f0 0a     beq _92dd
$92d3  20 2f 84  jsr _842f
$92d6  90 05     bcc _92dd
$92d8  a9 32     lda #$32
$92da  4c db 95  jmp _95db
_92dd: 20 48 81  jsr _8148
$92e0  20 36 83  jsr _8336
$92e3  90 10     bcc _92f5
$92e5  20 65 88  jsr _8865
$92e8  20 4d 81  jsr _814d
$92eb  a9 00     lda #$00
$92ed  8d 9e 37  sta $379e
$92f0  a9 34     lda #$34
$92f2  4c db 95  jmp _95db
_92f5: 20 65 88  jsr _8865
$92f8  a2 a3     ldx #$a3
$92fa  20 00 33  jsr $3300
$92fd  ad 9e 37  lda $379e
$9300  d0 0f     bne _9311
$9302  20 3d 9a  jsr _9a3d
$9305  90 0d     bcc _9314
$9307  20 5c 81  jsr _815c
$930a  a9 3b     lda #$3b
$930c  a2 03     ldx #$03
$930e  4c d6 95  jmp _95d6
_9311: 20 de 84  jsr _84de
_9314: 20 0e 9a  jsr _9a0e
$9317  90 0a     bcc _9323
$9319  20 57 81  jsr _8157
_931c: a9 33     lda #$33
$931e  a2 04     ldx #$04
$9320  4c d6 95  jmp _95d6
_9323: ad 9e 37  lda $379e
$9326  f0 16     beq _933e
$9328  20 51 84  jsr _8451
$932b  90 0c     bcc _9339
$932d  20 6b 81  jsr _816b
$9330  4c 1c 93  jmp _931c
_9333: 20 70 81  jsr _8170
$9336  4c 1c 93  jmp _931c
_9339: 20 36 9b  jsr _9b36
$933c  b0 f5     bcs _9333
_933e: ac 65 39  ldy $3965
$9341  b9 5b 39  lda $395b,y
$9344  29 9f     and #$9f
$9346  99 5b 39  sta $395b,y
$9349  ad 18 34  lda $3418
$934c  29 60     and #$60
$934e  19 5b 39  ora $395b,y
$9351  99 5b 39  sta $395b,y
$9354  ad b9 39  lda $39b9
$9357  c9 54     cmp #$54
$9359  d0 0c     bne _9367
$935b  ad 5c 39  lda $395c
$935e  29 10     and #$10
$9360  d0 05     bne _9367
$9362  a9 2d     lda #$2d
$9364  8d b9 39  sta $39b9
_9367: 20 c0 9b  jsr _9bc0
$936a  20 8c 95  jsr _958c
$936d  90 17     bcc _9386
$936f  20 a7 89  jsr _89a7
$9372  90 05     bcc _9379
_9374: a9 39     lda #$39
$9376  4c db 95  jmp _95db
_9379: 20 c3 89  jsr _89c3
$937c  b0 f6     bcs _9374
$937e  20 af 89  jsr _89af
$9381  b0 f1     bcs _9374
$9383  4c a7 93  jmp _93a7
_9386: 20 61 81  jsr _8161
$9389  20 6a 83  jsr _836a
$938c  90 08     bcc _9396
$938e  20 6b 81  jsr _816b
$9391  a9 36     lda #$36
$9393  4c db 95  jmp _95db
_9396: ac 65 39  ldy $3965
$9399  b9 5b 39  lda $395b,y
$939c  8d e9 3a  sta $3ae9
$939f  09 10     ora #$10
$93a1  99 5b 39  sta $395b,y
$93a4  20 e0 88  jsr _88e0
_93a7: 20 f9 88  jsr _88f9
_93aa: 20 0d 89  jsr _890d
$93ad  90 03     bcc _93b2
$93af  4c e3 93  jmp _93e3
_93b2: a9 00     lda #$00
$93b4  20 c8 8a  jsr _8ac8
$93b7  20 8c 95  jsr _958c
$93ba  90 12     bcc _93ce
$93bc  a9 ff     lda #$ff
$93be  20 c8 8a  jsr _8ac8
$93c1  20 93 89  jsr _8993
$93c4  90 05     bcc _93cb
_93c6: a9 35     lda #$35
$93c8  4c db 95  jmp _95db
_93cb: 4c aa 93  jmp _93aa
_93ce: ad 9e 37  lda $379e
$93d1  f0 03     beq _93d6
$93d3  20 74 84  jsr _8474
_93d6: 20 b0 83  jsr _83b0
$93d9  90 cf     bcc _93aa
_93db: 20 6b 81  jsr _816b
$93de  a9 37     lda #$37
$93e0  4c db 95  jmp _95db
_93e3: 20 8c 95  jsr _958c
$93e6  90 08     bcc _93f0
$93e8  20 cb 89  jsr _89cb
$93eb  b0 d9     bcs _93c6
$93ed  4c 5e 94  jmp _945e
_93f0: ad 9e 37  lda $379e
$93f3  f0 0f     beq _9404
$93f5  a9 ff     lda #$ff
$93f7  8d cb 39  sta $39cb
$93fa  a9 01     lda #$01
$93fc  8d 4d 37  sta $374d
$93ff  20 b0 83  jsr _83b0
$9402  b0 0f     bcs _9413
_9404: 20 dc 83  jsr _83dc
$9407  b0 d2     bcs _93db
$9409  ad 9e 37  lda $379e
$940c  d0 3b     bne _9449
$940e  20 93 83  jsr _8393
$9411  90 43     bcc _9456
_9413: a9 38     lda #$38
$9415  4c db 95  jmp _95db

_9418:
    lda #$e8
    sta $3936
    lda #$03
    sta $3937
    lda #$00
    sta $3938
    ldx #$06
    stx $2d
    ldx #$26
    jsr $3300
    lda #$36
    ldy #$39
    ldx #$06
    stx $2d
    ldx #$22
    jsr $3300
    php
    lda #$36
    ldy #$39
    ldx #$25
    jsr $3300
    plp
    rts

_9449: 20 66 84  jsr _8466
$944c  b0 c5     bcs _9413
$944e  ad ae 37  lda $37ae
$9451  0d af 37  ora $37af
$9454  d0 bd     bne _9413
_9456: 20 7d 81  jsr _817d
$9459  a9 00     lda #$00
$945b  8d b8 39  sta $39b8
_945e: ac 65 39  ldy $3965
$9461  b9 5b 39  lda $395b,y
$9464  09 90     ora #$90
$9466  99 5b 39  sta $395b,y
$9469  20 e0 88  jsr _88e0
$946c  20 ea 81  jsr _81ea
$946f  20 c0 9b  jsr _9bc0
$9472  20 0b 82  jsr _820b
$9475  a9 00     lda #$00
$9477  8d 0e 3b  sta $3b0e
$947a  20 8c 95  jsr _958c
$947d  b0 28     bcs _94a7
$947f  20 b4 95  jsr _95b4
$9482  90 20     bcc _94a4
$9484  20 78 81  jsr _8178
$9487  a2 05     ldx #$05
$9489  20 12 84  jsr _8412
$948c  20 9a 82  jsr _829a
$948f  a9 ff     lda #$ff
$9491  8d 0e 3b  sta $3b0e
_9494: a2 1f     ldx #$1f
$9496  20 00 33  jsr $3300
$9499  20 de 89  jsr _89de
$949c  20 b4 95  jsr _95b4
$949f  b0 f3     bcs _9494
$94a1  20 7d 81  jsr _817d
_94a4: 20 c3 89  jsr _89c3
_94a7: a9 00     lda #$00
_94a9: 48        pha
$94aa  20 69 99  jsr _9969
$94ad  68        pla
$94ae  70 13     bvs _94c3
$94b0  48        pha
$94b1  aa        tax
$94b2  bd 94 39  lda $3994,x
$94b5  29 80     and #$80
$94b7  c9 01     cmp #$01
$94b9  68        pla
$94ba  90 26     bcc _94e2
$94bc  18        clc
$94bd  69 01     adc #$01
$94bf  c9 06     cmp #$06
$94c1  90 e6     bcc _94a9
_94c3: 20 e0 88  jsr _88e0
$94c6  a9 05     lda #$05
$94c8  8d 3f 39  sta $393f
$94cb  a0 17     ldy #$17
$94cd  b1 14     lda ($14),y
$94cf  8d 40 39  sta $3940
$94d2  a2 4d     ldx #$4d
$94d4  20 71 89  jsr _8971
$94d7  ad 49 39  lda $3949
$94da  f0 06     beq _94e2
$94dc  20 7f 88  jsr _887f
$94df  4c e5 94  jmp _94e5
_94e2: 20 91 88  jsr _8891
_94e5: ad 9e 37  lda $379e
$94e8  d0 4d     bne _9537
$94ea  a2 05     ldx #$05
_94ec: bd 94 39  lda $3994,x
$94ef  29 0f     and #$0f
$94f1  48        pha
$94f2  ca        dex
$94f3  10 f7     bpl _94ec
$94f5  ad b8 39  lda $39b8
$94f8  48        pha
$94f9  20 b7 98  jsr _98b7
$94fc  b0 32     bcs _9530
$94fe  a0 17     ldy #$17
$9500  ad 40 39  lda $3940
$9503  91 14     sta ($14),y
$9505  20 6b 92  jsr _926b
$9508  68        pla
$9509  8d b8 39  sta $39b8
$950c  a2 00     ldx #$00
_950e: bd 94 39  lda $3994,x
$9511  29 f0     and #$f0
$9513  9d 94 39  sta $3994,x
$9516  68        pla
$9517  1d 94 39  ora $3994,x
$951a  9d 94 39  sta $3994,x
$951d  e8        inx
$951e  e0 06     cpx #$06
$9520  90 ec     bcc _950e
$9522  ad 0e 3b  lda $3b0e
$9525  d0 03     bne _952a
$9527  4c 3e 93  jmp _933e
_952a: 20 f1 89  jsr _89f1
$952d  4c 11 8c  jmp _8c11
_9530: 68        pla
$9531  68        pla
$9532  68        pla
$9533  68        pla
$9534  68        pla
$9535  68        pla
$9536  68        pla
_9537: 20 96 95  jsr _9596
$953a  90 08     bcc _9544
$953c  ad ea fd  lda $fdea
$953f  d0 03     bne _9544
$9541  20 c8 81  jsr _81c8
_9544: a9 00     lda #$00
$9546  a0 00     ldy #$00
$9548  91 14     sta ($14),y
$954a  ad 19 34  lda $3419
$954d  09 01     ora #$01
$954f  8d 19 34  sta $3419
$9552  20 f1 89  jsr _89f1
$9555  ad 0e 3b  lda $3b0e
$9558  d0 2f     bne _9589
$955a  20 8c 95  jsr _958c
$955d  b0 2a     bcs _9589
$955f  20 9e 95  jsr _959e
$9562  20 28 84  jsr _8428
$9565  aa        tax
$9566  c9 a0     cmp #$a0
$9568  f0 1f     beq _9589
$956a  ad 0b 3b  lda $3b0b
$956d  f0 1a     beq _9589
$956f  e0 50     cpx #$50
$9571  d0 16     bne _9589
$9573  ad 18 34  lda $3418
$9576  29 f7     and #$f7
$9578  09 80     ora #$80
$957a  8d 18 34  sta $3418
$957d  a9 ff     lda #$ff
$957f  8d 0c 3b  sta $3b0c
$9582  20 f9 97  jsr _97f9
$9585  20 9f 80  jsr _809f
$9588  60        rts
_9589: 4c 11 8c  jmp _8c11
_958c: ad 18 34  lda $3418
$958f  29 40     and #$40
$9591  49 40     eor #$40
$9593  c9 01     cmp #$01
$9595  60        rts
_9596: ad 18 34  lda $3418
$9599  29 20     and #$20
$959b  c9 01     cmp #$01
$959d  60        rts
_959e: ad 0b 3b  lda $3b0b
$95a1  4a        lsr
$95a2  4a        lsr
$95a3  29 03     and #$03
$95a5  aa        tax
$95a6  bd b0 95  lda _95b0,x
$95a9  8d 0d 3b  sta $3b0d
$95ac  8d 52 37  sta $3752
$95af  60        rts
_95b0: 00        brk
$95b1  02        ???
$95b2  06 14     asl $14
_95b4: ad e9 3a  lda $3ae9
$95b7  29 10     and #$10
$95b9  8d e9 3a  sta $3ae9
$95bc  ac 65 39  ldy $3965
$95bf  b9 5b 39  lda $395b,y
$95c2  48        pha
$95c3  29 ef     and #$ef
$95c5  4d e9 3a  eor $3ae9
$95c8  99 5b 39  sta $395b,y
$95cb  20 a7 89  jsr _89a7
$95ce  68        pla
$95cf  ac 65 39  ldy $3965
$95d2  99 5b 39  sta $395b,y
$95d5  60        rts
_95d6: 48        pha
$95d7  20 12 84  jsr _8412
$95da  68        pla
_95db: 8d b8 39  sta $39b8
$95de  ad 21 34  lda $3421
$95e1  8d ec 3a  sta $3aec
$95e4  ad 47 37  lda $3747
$95e7  8d ed 3a  sta $3aed
$95ea  ad 4a 37  lda $374a
$95ed  8d ee 3a  sta $3aee
$95f0  20 af 96  jsr _96af
$95f3  ad 9e 37  lda $379e
$95f6  f0 03     beq _95fb
$95f8  20 de 84  jsr _84de
_95fb: 20 8c 95  jsr _958c
$95fe  b0 1c     bcs _961c
$9600  ad 4a 37  lda $374a
$9603  c9 b0     cmp #$b0
$9605  d0 0a     bne _9611
$9607  ad b8 39  lda $39b8
$960a  c9 34     cmp #$34
$960c  f0 03     beq _9611
$960e  20 66 81  jsr _8166
_9611: ad 4a 37  lda $374a
$9614  48        pha
$9615  20 9a 82  jsr _829a
$9618  68        pla
$9619  8d 4a 37  sta $374a
_961c: 20 f1 89  jsr _89f1
$961f  ad b8 39  lda $39b8
$9622  c9 ff     cmp #$ff
$9624  d0 03     bne _9629
$9626  4c 0b 8c  jmp _8c0b
_9629: ad 4a 37  lda $374a
$962c  c9 c0     cmp #$c0
$962e  d0 08     bne _9638
$9630  20 43 81  jsr _8143
$9633  a9 01     lda #$01
$9635  8d b8 39  sta $39b8
_9638: 20 e1 96  jsr _96e1
$963b  20 de 89  jsr _89de
$963e  b0 10     bcs _9650
$9640  20 c0 9b  jsr _9bc0
$9643  20 e0 88  jsr _88e0
$9646  20 a7 89  jsr _89a7
$9649  b0 05     bcs _9650
$964b  20 c3 89  jsr _89c3
$964e  90 03     bcc _9653
_9650: 20 78 81  jsr _8178
_9653: 20 f1 89  jsr _89f1
$9656  a5 14     lda $14
$9658  c9 2f     cmp #$2f
$965a  d0 09     bne _9665
$965c  a5 15     lda $15
$965e  c9 36     cmp #$36
$9660  d0 03     bne _9665
$9662  20 8a 88  jsr _888a
_9665: a0 1a     ldy #$1a
$9667  b1 14     lda ($14),y
$9669  c9 04     cmp #$04
$966b  90 16     bcc _9683
$966d  a0 1b     ldy #$1b
$966f  a9 ff     lda #$ff
$9671  91 14     sta ($14),y
$9673  ac 65 39  ldy $3965
$9676  b9 5b 39  lda $395b,y
$9679  29 9f     and #$9f
$967b  49 00     eor #$00
$967d  99 5b 39  sta $395b,y
$9680  4c 0b 8c  jmp _8c0b
_9683: ad 18 34  lda $3418
$9686  29 20     and #$20
$9688  d0 0a     bne _9694
$968a  b1 14     lda ($14),y
$968c  18        clc
$968d  69 01     adc #$01
$968f  91 14     sta ($14),y
$9691  20 9c 96  jsr _969c
_9694: 4c 0b 8c  jmp _8c0b

_9697: 00        brk
$9698  1e 2a 3c  asl $3c2a,x
$969b  b4

_969c: a0 1a     ldy #$1a
$969e  b1 14     lda ($14),y
$96a0  aa        tax
$96a1  a9 ff     lda #$ff
$96a3  e0 05     cpx #$05
$96a5  b0 03     bcs _96aa
$96a7  bd 97 96  lda _9697,x
_96aa: a0 1b     ldy #$1b
$96ac  91 14     sta ($14),y
$96ae  60        rts
_96af: a2 39     ldx #$39
$96b1  ad ec 3a  lda $3aec
$96b4  20 c4 96  jsr _96c4
$96b7  ad ed 3a  lda $3aed
$96ba  20 c4 96  jsr _96c4
$96bd  ad ee 3a  lda $3aee
$96c0  20 c4 96  jsr _96c4
$96c3  60        rts
_96c4: 20 cb 96  jsr _96cb
$96c7  4a        lsr
$96c8  4a        lsr
$96c9  4a        lsr
$96ca  4a        lsr
_96cb: 48        pha
$96cc  bd 5b 39  lda $395b,x
$96cf  29 f0     and #$f0
$96d1  9d 5b 39  sta $395b,x
$96d4  68        pla
$96d5  48        pha
$96d6  29 0f     and #$0f
$96d8  1d 5b 39  ora $395b,x
$96db  9d 5b 39  sta $395b,x
$96de  e8        inx
$96df  68        pla
$96e0  60        rts
_96e1: ad 4a 37  lda $374a
$96e4  c9 80     cmp #$80
$96e6  d0 1e     bne _9706
$96e8  ad 9e 37  lda $379e
$96eb  f0 05     beq _96f2
$96ed  a2 00     ldx #$00
$96ef  4c ff 96  jmp _96ff
_96f2: ad 29 34  lda $3429
$96f5  aa        tax
$96f6  f0 0e     beq _9706
$96f8  ca        dex
$96f9  e0 08     cpx #$08
$96fb  90 02     bcc _96ff
$96fd  a2 00     ldx #$00
_96ff: bd 07 97  lda _9707,x
$9702  aa        tax
$9703  4c 2d 81  jmp _812d
_9706: 60        rts
_9707: 0c        ???
$9708  07        ???
$9709  0c        ???
$970a  0c        ???
$970b  0c        ???
$970c  0d 0d 0f  ora $0f0d

_970f:       ; RAM entry point 6
    lda $3418
    and #$80
    bne +
    jmp _9841
*
    lda $fdea
    beq _972f
    lda $3418
    ora #$20
    sta $3418
    lda $3419
    ora #$01
    sta $3419
    rts
_972f:
    jmp _9839

_9732:       ; RAM entry point 9
    lda $3418
    and #$80
    bne +
    jmp _9841
*
    lda $3418
    and #$7f
    ora #$08
    sta $3418
    jsr _8096
    ldx #$15
_974b:
    lda $35ee,x
    sta $376a,x
    dex
    bpl _974b
    jsr _8432
    bcc +
    jmp _8c0b
*
    jsr _81cd
    jsr _810f
    jsr _9418
    jsr _8120
    jsr _809f
    jsr _829a
    jmp _8c11

_9771:       ; RAM entry point 4
    lda $3418
    and #$80
    sec
    bne _977c
    jmp _9816
_977c:
    lda $3418
    and #$7f
    ora #$08
    and #$bf
    eor #$40
    sta $3418
    ldx #$15
_978c:
    lda $35ee,x
    sta $3ac8,x
    dex
    bpl _978c
    lda #$3b
    sta $3ade
    jsr _9931
    bcs _97b8
    sta $14
    sty $15
    lda #$00
    ldy #$1a
    sta ($14),y
    ldy #$1b
    sta ($14),y
    ldx #$05
    stx $2d
    lda #$02
    ldx #$27
    jmp $3300
_97b8:
    ldx #$15
_97ba:
    lda $35ee,x
    sta $362f,x
    dex
    bpl _97ba
    lda #$2f
    sta $14
    lda #$36
    sta $15
    jsr _98b7
    bcc _97d8
    lda #$00
    sta $362f
    jmp _9839
_97d8:
    lda $3940
    sta $3646
    jsr _89de
    bcc _97ee
    jsr _888a
    lda #$00
    sta $362f
    jmp _8c0b
_97ee:
    ldx #$05
    stx $2d
    lda #$04
    ldx #$27
    jmp $3300

_97f9:       ; RAM entry point 5
    lda $3418
    and #$80
    clc
    beq _9816
    lda $3418
    and #$7f
    ora #$10
    sta $3418
    ldx #$04
    stx $2d
    lda #$02
    ldx #$27
    jmp $3300
_9816:
    lda $3b07
    beq _9836
    php
    ldx #$0d
    stx $2d
    lda #$01
    ldx #$27
    jsr $3300
    ldx #$07
    stx $2d
    ldx #$21
    jsr $3300
    plp
    bcc _97f9
    jmp _9771
_9836:
    jmp _9841

_9839:
    lda #$01
    sta $35ec
    jmp _8c0b

_9841:
    lda #$02
    sta $35ec
    rts

_9847:
    rts
_9848:
    ldx $3b05
    beq _9847
    ldx #$21
    stx $2d
    ldx #$13
    jmp $3300

_9856:
    ldx $3b05
    beq _9847
    ldx #$22
    stx $2d
    ldx #$13
    jmp $3300

_9864: a9 00     lda #$00
$9866  8d 2a 39  sta $392a
$9869  a2 00     ldx #$00
_986b: ee 2a 39  inc $392a
$986e  ee 2a 39  inc $392a
$9871  ac 2a 39  ldy $392a
$9874  b9 b2 8a  lda _8ab2,y
$9877  85 10     sta $10
$9879  b9 b3 8a  lda _8ab3,y
$987c  85 11     sta $11
$987e  f0 20     beq _98a0
$9880  a0 00     ldy #$00
$9882  b1 10     lda ($10),y
$9884  d0 06     bne _988c
$9886  ae 2a 39  ldx $392a
$9889  4c 6b 98  jmp _986b
_988c: ad 18 34  lda $3418
$988f  29 20     and #$20
$9891  d0 1b     bne _98ae
$9893  a0 1b     ldy #$1b
$9895  b1 10     lda ($10),y
$9897  f0 18     beq _98b1
$9899  c9 ff     cmp #$ff
$989b  f0 14     beq _98b1
$989d  4c 6b 98  jmp _986b
_98a0: bd b2 8a  lda _8ab2,x
$98a3  bc b3 8a  ldy _8ab3,x
$98a6  e0 00     cpx #$00
$98a8  d0 02     bne _98ac
$98aa  a0 00     ldy #$00
_98ac: 18        clc
$98ad  60        rts
_98ae: 20 c3 81  jsr _81c3
_98b1: a5 10     lda $10
$98b3  a4 11     ldy $11
$98b5  38        sec
$98b6  60        rts

_98b7:
    lda #$03
    sta $393f
    ldx #$48
    jsr _8971
    bcs _98d1
_98c3:
    lda $3949
    bne _98ce
    jsr _98db
    bcs _98d3
    rts
_98ce:
    jsr _8891
_98d1:
    sec
    rts
_98d3:
    ldx #$49
    jsr _8971
    jmp _98c3

_98db:
    jsr _88a3
    bcc _98e3
    brk
_98e1:
.byte 8d 00
_98e3:
    ldy #$00
_98e5:
    sty $392b
    lda $3994,y
    and #$80
    bne _9922
    lda $392b
    jsr _992c
    bvs _992a
    inc $3b3a
    bcc _990b
    pha
    ldx #$00
    lda ($14,x)
    cmp #$01
    pla
    bcs _9922
    ldx $392b
    clc
    rts
_990b:
    pha
    ldx #$00
    lda ($14,x)
    cmp #$01
    pla
    bcc _9922
    cmp $14
    bne _9922
    cpy $15
    bne _9922
    ldx $392b
    clc
    rts
_9922:
    ldy $392b
    iny
    cpy #$06
    bcc _98e5
_992a:
    sec
    rts

_992c:
    jsr _9969
    bvs _9965
_9931:
    lda #$fe
    sta $392a
_9936:
    inc $392a
    inc $392a
    ldy $392a
    lda _8ab2,y
    sta $10
    lda _8ab3,y
    sta $11
    beq _9962
    ldx #$00
    lda ($10,x)
    beq _9936
    lda $392a
    lsr
    tax
    jsr _99a1
    bcs _9936
    lda $10
    ldy $11
    clv
    clc
    rts
_9962:
    clv
    sec
    rts
_9965:
    bit $3929
    rts

_9969:
    ldx #$3e
    tay
    beq _997d
_996e:
    inx
    cpx #$5d
    bcs _999d
    lda $395b,x
    cmp #$3b
    bne _996e
    dey
    bne _996e
_997d:
    inx
    stx $395a
    ldy #$00
_9983:
    cpx #$5d
    bcs _9996
    lda $395b,x
    inx
    cmp #$20
    beq _9983
    sta $3ac8,y
    iny
    jmp _9983
_9996:
    lda #$3b
    sta $3ac8,y
    clv
    rts
_999d:
    bit $3929
    rts

_99a1:
    ldy #$16
    lda ($10),y
    pha
    lda #$3b
    sta ($10),y
    stx $2d
    lda #$c8
    ldy #$3a
    ldx #$bb
    jsr $3300
    pla
    ldy #$16
    sta ($10),y
    rts

_99bb: a2 a3     ldx #$a3
$99bd  20 00 33  jsr $3300
$99c0  ad 9e 37  lda $379e
$99c3  f0 04     beq _99c9
$99c5  c9 ff     cmp #$ff
$99c7  d0 15     bne _99de
_99c9: ad 9b 37  lda $379b
$99cc  29 02     and #$02
$99ce  8d 2d 39  sta $392d
$99d1  ad 9b 37  lda $379b
$99d4  29 01     and #$01
$99d6  8d 2c 39  sta $392c
$99d9  20 23 88  jsr _8823
$99dc  18        clc
$99dd  60        rts
_99de: 38        sec
$99df  60        rts
_99e0: ad 4b 37  lda $374b
$99e3  d0 09     bne _99ee
$99e5  ad 4c 37  lda $374c
$99e8  c9 03     cmp #$03
$99ea  b0 02     bcs _99ee
$99ec  38        sec
$99ed  60        rts
_99ee: ce 4c 37  dec $374c
$99f1  ad 4c 37  lda $374c
$99f4  c9 ff     cmp #$ff
$99f6  d0 05     bne _99fd
$99f8  a9 00     lda #$00
$99fa  8d 4b 37  sta $374b
_99fd: ce 4c 37  dec $374c
$9a00  ad 4c 37  lda $374c
$9a03  c9 ff     cmp #$ff
$9a05  d0 05     bne _9a0c
$9a07  a9 00     lda #$00
$9a09  8d 4b 37  sta $374b
_9a0c: 18        clc
$9a0d  60        rts
_9a0e: ad 9e 37  lda $379e
$9a11  c9 01     cmp #$01
$9a13  f0 c9     beq _99de
$9a15  ad 9a 37  lda $379a
$9a18  29 01     and #$01
$9a1a  8d 2c 39  sta $392c
$9a1d  ad 9a 37  lda $379a
$9a20  29 02     and #$02
$9a22  8d 2d 39  sta $392d
$9a25  ad 9b 37  lda $379b
$9a28  29 0c     and #$0c
$9a2a  8d 0b 3b  sta $3b0b
$9a2d  ad 97 37  lda $3797
$9a30  29 02     and #$02
$9a32  f0 07     beq _9a3b
$9a34  4d 2d 39  eor $392d
$9a37  f0 02     beq _9a3b
$9a39  38        sec
$9a3a  60        rts
_9a3b: 18        clc
$9a3c  60        rts
_9a3d: a0 16     ldy #$16
$9a3f  b1 14     lda ($14),y
$9a41  29 80     and #$80
$9a43  2d 59 39  and $3959
$9a46  f0 04     beq _9a4c
$9a48  20 4e 9a  jsr _9a4e
$9a4b  60        rts
_9a4c: 18        clc
$9a4d  60        rts
_9a4e: a9 03     lda #$03
$9a50  8d 01 3b  sta $3b01
$9a53  a2 16     ldx #$16
$9a55  a0 16     ldy #$16
$9a57  20 f2 9a  jsr _9af2
$9a5a  b0 46     bcs _9aa2
$9a5c  20 14 9b  jsr _9b14
$9a5f  b0 48     bcs _9aa9
$9a61  ad ff 3a  lda $3aff
$9a64  cd 00 3b  cmp $3b00
$9a67  d0 40     bne _9aa9
$9a69  ad ff 3a  lda $3aff
$9a6c  f0 3b     beq _9aa9
$9a6e  ce 01 3b  dec $3b01
$9a71  20 f2 9a  jsr _9af2
$9a74  b0 2e     bcs _9aa4
$9a76  20 14 9b  jsr _9b14
$9a79  b0 2e     bcs _9aa9
$9a7b  ad ff 3a  lda $3aff
$9a7e  cd 00 3b  cmp $3b00
$9a81  d0 26     bne _9aa9
$9a83  ad ff 3a  lda $3aff
$9a86  f0 23     beq _9aab
$9a88  ce 01 3b  dec $3b01
$9a8b  20 f2 9a  jsr _9af2
$9a8e  b0 14     bcs _9aa4
$9a90  20 14 9b  jsr _9b14
$9a93  b0 14     bcs _9aa9
$9a95  ad ff 3a  lda $3aff
$9a98  cd 00 3b  cmp $3b00
$9a9b  d0 0c     bne _9aa9
$9a9d  ad ff 3a  lda $3aff
$9aa0  f0 09     beq _9aab
_9aa2: 18        clc
$9aa3  60        rts
_9aa4: 20 14 9b  jsr _9b14
$9aa7  b0 f9     bcs _9aa2
_9aa9: 38        sec
$9aaa  60        rts
_9aab: 8c 02 3b  sty $3b02
$9aae  20 14 9b  jsr _9b14
$9ab1  b0 ef     bcs _9aa2
$9ab3  20 14 9b  jsr _9b14
$9ab6  b0 ea     bcs _9aa2
$9ab8  20 14 9b  jsr _9b14
$9abb  b0 e5     bcs _9aa2
$9abd  ac 02 3b  ldy $3b02
$9ac0  20 f2 9a  jsr _9af2
$9ac3  b0 e4     bcs _9aa9
$9ac5  20 14 9b  jsr _9b14
$9ac8  ad ff 3a  lda $3aff
$9acb  cd 00 3b  cmp $3b00
$9ace  d0 d9     bne _9aa9
$9ad0  ad ff 3a  lda $3aff
$9ad3  f0 d4     beq _9aa9
$9ad5  ce 01 3b  dec $3b01
$9ad8  f0 c8     beq _9aa2
$9ada  20 f2 9a  jsr _9af2
$9add  b0 ca     bcs _9aa9
$9adf  20 14 9b  jsr _9b14
$9ae2  ad ff 3a  lda $3aff
$9ae5  cd 00 3b  cmp $3b00
$9ae8  d0 bf     bne _9aa9
$9aea  ad ff 3a  lda $3aff
$9aed  f0 ba     beq _9aa9
$9aef  4c a2 9a  jmp _9aa2
_9af2: a9 00     lda #$00
$9af4  8d ff 3a  sta $3aff
_9af7: ca        dex
$9af8  10 02     bpl _9afc
$9afa  38        sec
$9afb  60        rts
_9afc: bd 80 37  lda $3780,x
$9aff  c9 58     cmp #$58
$9b01  f0 0f     beq _9b12
$9b03  c9 78     cmp #$78
$9b05  f0 0b     beq _9b12
$9b07  c9 30     cmp #$30
$9b09  90 ec     bcc _9af7
$9b0b  c9 3a     cmp #$3a
$9b0d  b0 e8     bcs _9af7
$9b0f  8d ff 3a  sta $3aff
_9b12: 18        clc
$9b13  60        rts
_9b14: a9 00     lda #$00
$9b16  8d 00 3b  sta $3b00
_9b19: 88        dey
$9b1a  10 02     bpl _9b1e
$9b1c  38        sec
$9b1d  60        rts
_9b1e: b9 6a 37  lda $376a,y
$9b21  c9 58     cmp #$58
$9b23  f0 0f     beq _9b34
$9b25  c9 78     cmp #$78
$9b27  f0 0b     beq _9b34
$9b29  c9 30     cmp #$30
$9b2b  90 ec     bcc _9b19
$9b2d  c9 3a     cmp #$3a
$9b2f  b0 e8     bcs _9b19
$9b31  8d 00 3b  sta $3b00
_9b34: 18        clc
$9b35  60        rts
_9b36: ad a9 37  lda $37a9
$9b39  d0 02     bne _9b3d
$9b3b  18        clc
$9b3c  60        rts
_9b3d: 38        sec
$9b3e  60        rts
_9b3f: ad b0 37  lda $37b0
$9b42  c9 01     cmp #$01
$9b44  f0 04     beq _9b4a
$9b46  c9 02     cmp #$02
$9b48  d0 10     bne _9b5a
_9b4a: ad b1 37  lda $37b1
$9b4d  c9 01     cmp #$01
$9b4f  d0 09     bne _9b5a
$9b51  ad b2 37  lda $37b2
$9b54  c9 01     cmp #$01
$9b56  d0 02     bne _9b5a
$9b58  18        clc
$9b59  60        rts
_9b5a: 38        sec
$9b5b  60        rts

_9b5c:
    lda #$5b
    ldy #$39
_9b60:                      ; RAM entry point 1
    sta $12
    sty $13
    ldx #$00
_9b66:
    ldy _9b8f,x
    cpy #$ff
    beq _9b8b
_9b6d:
    lda ($12),y
    cmp _9b91,x
    bcc _9b88
    cmp _9b92,x
    beq _9b7b
    bcs _9b88
_9b7b:
    iny
    tya
    cmp _9b90,x     ; 
    bne _9b6d
    inx
    inx
    inx
    inx
    bne _9b66
_9b88:
    tya
    sec
    rts
_9b8b:
    lda #$00
    clc
    rts

_9b8f:
.byte 00
_9b90:
.byte 01
_9b91:
.byte 66
_9b92:
.byte 66 05 06 00 1f 06 07 00 0c 08 09 00 17 09
.byte 0a 00 3b 0a 0b 39 3f 0b 0c 3f 5d 0c 0d 00 05 0d
.byte 23 20 7e 23 39 20 7e 3f 5d 20 7e 5e 5f 20 7e ff
; The block of data terminates with $ff

_9bc0: a2 15     ldx #$15
_9bc2: bd 07 fd  lda $fd07,x
$9bc5  9d 7e 39  sta $397e,x
$9bc8  bd 80 37  lda $3780,x
$9bcb  c9 20     cmp #$20
$9bcd  90 04     bcc _9bd3
$9bcf  c9 7f     cmp #$7f
$9bd1  90 02     bcc _9bd5
_9bd3: a9 20     lda #$20
_9bd5: 9d 68 39  sta $3968,x
$9bd8  ca        dex
$9bd9  10 e7     bpl _9bc2
$9bdb  ad 02 fd  lda $fd02
$9bde  8d 63 39  sta $3963
$9be1  ad 01 fd  lda $fd01
$9be4  8d 64 39  sta $3964
$9be7  ad 03 fd  lda $fd03
$9bea  8d 60 39  sta $3960
$9bed  ad 04 fd  lda $fd04
$9bf0  8d 61 39  sta $3961
$9bf3  ad 05 fd  lda $fd05
$9bf6  8d 62 39  sta $3962
$9bf9  a0 1a     ldy #$1a
$9bfb  b1 14     lda ($14),y
$9bfd  8d 67 39  sta $3967
$9c00  ad eb fd  lda $fdeb
$9c03  8d 5e 39  sta $395e
$9c06  ad ec fd  lda $fdec
$9c09  8d 5f 39  sta $395f
$9c0c  20 5c 9b  jsr _9b5c
$9c0f  90 03     bcc _9c14
$9c11  00        brk
$9c12  84 00     sty $00
_9c14: 60        rts

_9c15:       ; RAM entry point 10
    lda $3b23
    bne _9c64
    inc $37b7
    lda $37c3
    sta $37c4
    lda #$00
    sta $37c3
    lda #$01
    sta $3b24
_9c2d:
    lda $39cb
    cmp $3b24
    bne _9c38
_9c35:
    jmp _9d2f
_9c38:
    cmp #$4c
    bcc _9c35
    jsr _9d3b
    lda $39cb
    inx
    stx $3b24
    sec
    sbc $3b24
    sta $3b24
    cpx #$4b
    bne _9c57
    inc $3b24
    jmp _9c58
_9c57:
    inx
_9c58:
    stx $39cb
    stx $3b37
    lda #$10
    sta $3b23
    rts
_9c64:
    cmp #$10
    bne _9cb2
    inc $37b8
    ldy $3b37
    jsr _9c89
    lda $3b24
    cmp #$4f
    bcs _9c7e
    lda #$20
    sta $3b23
    rts
_9c7e:
    sta $39cb
    lda #$01
    sta $3b24
    jmp _9c2d
_9c89:
    lda #$00
    sta $37c0
    ldx #$01
_9c90:
    lda $39cb,y
    cmp #$20
    bne _9c9e
    lda $37c0
    beq _9cac
    lda #$20
_9c9e:
    sta $39cb,x
    sta $37c0
    inx
_9ca5:
    iny
    cpx $3b24
    bcc _9c90
    rts
_9cac:
    dec $3b24
    jmp _9ca5
_9cb2:
    cmp #$20
    bne _9d1d
    inc $37b9
    ldx $3b24
    lda $39cb,x
    cmp #$02
    bcs _9cd7
    lda $3b24
    sta $39cb
    lda #$00
    sta $37c3
    sta $37c4
    lda #$30
    sta $3b23
    rts
_9cd7:
    ldy $37c4
    bne _9cf6
    clc
    adc $3b24
    sta $39cb
    lda #$20
    sta $39cb,x
    ldy $37c3
    sty $37c4
    ldy #$00
    sty $37c3
    jmp _9c2d
_9cf6:
    ldy $37c3
    sty $37c4
    ldy #$00
    sty $37c3
    tay
    dey
    sty $3420
    tya
    clc
    adc $3b24
    sta $39cb
_9d0e:
    lda $39cc,x
    sta $39cb,x
    inx
    dec $3420
    bne _9d0e
    jmp _9c2d
_9d1d:
    cmp #$30
    bne _9d38
    inc $37ba
    lda #$01
    sta $39cb
    sta $3b24
    jmp _9c2d

_9d2f:
    lda #$00
    sta $3b24
    sta $3b23
    rts
_9d38:
    brk
_9d39:
.byte cc 00

_9d3b:
    ldx #$4a
    lda $39cc,x
    cmp #$20
    beq _9d58
    dex
_9d45:
    lda $39cc,x
    ldy #$0d
_9d4a:
    cmp _9d59,y
    beq _9d58
    dey
    bpl _9d4a
    dex
    bne _9d45
    ldx #$49
    rts
_9d58:
    rts
_9d59:
.byte " !)-]}:;?/.,>"
_9d66:
.byte a0 a8 b0 b8
_9d6a:
.byte c0 c8 d0 d8 e0 e8 f0 f8 ff 90 98
_9d75:
.byte a0 b0 b8 c0 c8 e8

_9d7b:       ; RAM entry point 11
    lda $37c1
    beq _9d83
    jmp _a216
_9d83:
    ldx #$00
_9d85:
    lda $3b1d
    sta $3b1e
_9d8b:
    ldy $3b1f
_9d8e:
    lda _9d66,y
    sta $3b1d
    lda $3b2f
    beq _9d9f
    lda $0c02,x
    jmp _9da2
_9d9f:
    lda $0b02,x
_9da2:
    cmp $3b1d
    beq _9e05
    iny
    cpy #$0f
    bne _9d8e
    cmp #$90
    bcc _9dff
    cmp #$a0
    bcc _9dbc
    cmp $3b1e
    bcc _9dff
_9db9:
    sta $3b1d
_9dbc:
    cmp #$d0
    beq _9dc8
    cmp #$d8
    beq _9dc8
    cmp #$e0
    bne _9dcb
_9dc8:
    sta $3b27
_9dcb:
    jsr _a1c7
    sta $3b2c
    jsr _a1c7
    sta $3b2d
    lda $3b2c
    bne _9def
_9ddc:
    lda $3b2d
    beq _9de9
_9de1:
    jsr _a1c7
    dec $3b2d
    bne _9de1
_9de9:
    jsr _a1fb
    jmp _9d85
_9def:
    jsr _a1c7
    dec $3b2d
    bne _9def
    dec $3b2c
    bne _9def
    jmp _9ddc
_9dff:
    lda #$ff
    sta $3b1d
    rts
_9e05:
    lda $3b27
    beq _9e11
    cpy #$0d
    bcs _9e19
    jmp _9dff
_9e11:
    cpy #$0d
    bcs _9dff
    iny
    sty $3b1f
_9e19:
    lda $3b1d
    cmp #$a8
    bne _9e23
    jmp _9eaa
_9e23:
    cmp #$d0
    bne _9e2d
    sta $3b27
    jmp _a028
_9e2d:
    cmp #$90
    bne _9e34
    jmp _9f55
_9e34:
    cmp #$d8
    bne _9e3e
    sta $3b27
    jmp _9f37
_9e3e:
    cmp #$e0
    bne _9e48
    sta $3b27
    jmp _9f37
_9e48:
    cmp #$98
    bne _9e4f
    jmp _a0f4
_9e4f:
    cmp #$f0
    bne _9e56
    jmp _a084
_9e56:
    cmp #$f8
    bne _9e6c
    jsr _a1fb
    jsr _a1fb
    jsr _a1fb
    stx $3b20
    lda #$00
    sta $3430
    rts
_9e6c:
    ldy #$00
_9e6e:
    lda _9d75,y
    cmp $3b1d
    bne _9e79
    jmp _9db9
_9e79:
    iny
    cpy #$06
    bcc _9e6e
    brk
_9e7f:
.byte c4 00

_9e81:
    cmp #$20
    bcc _9ea7
    cmp #$60
    bne _9e8b
    lda #$22
_9e8b:
    cmp #$23
    bne _9e91
    lda #$60
_9e91:
    cmp #$ca
    bne _9e97
    lda #$23
_9e97:
    cmp #$cb
    bne _9e9d
    lda #$63
_9e9d:
    cmp #$7f
    bne _9ea3
    lda #$40
_9ea3:
    cmp #$7f
    bcc _9ea9
_9ea7:
    lda #$20
_9ea9:
    rts

_9eaa:
    jsr _a1c7
    beq _9eb2
    jmp _9dff
_9eb2:
    jsr _a1c7
    cmp #$0e
    beq _9ebf
    sta $3431
    jmp _9f47
_9ebf:
    jsr _a1c7
    sta $37be
    jsr _a1c7
    sta $3420
    lda $37be
    jsr _a18c
    sta $3963
    jsr _a1fb
    jsr _a1c7
    sta $37be
    jsr _a1c7
    sta $3420
    lda $37be
    jsr _a18c
    sta $3964
    jsr _a1fb
    jsr _a1c7
    sta $37be
    jsr _a1c7
    sta $3420
    lda $37be
    jsr _a18c
    sta $3960
    jsr _a1fb
    jsr _a1c7
    sta $37be
    jsr _a1c7
    sta $3420
    lda $37be
    jsr _a18c
    sta $3961
    jsr _a1fb
    jsr _a1c7
    sta $37be
    jsr _a1c7
    sta $3420
    lda $37be
    jsr _a18c
    sta $3962
    jmp _9f4f
_9f37:
    jsr _a1c7
    beq _9f3f
    jmp _9dff
_9f3f:
    jsr _a1c7
    beq _9f4f
    sta $3431
_9f47:
    jsr _a1c7
    dec $3431
    bne _9f47
_9f4f:
    jsr _a1fb
    jmp _9d85

_9f55:
    lda #$d0
    cmp $3b27
    bne _9f69
    lda #$00
    sta $3b27
    sta $3430
    jsr _a1c7
    beq _9f6c
_9f69:
    jmp _9dff
_9f6c:
    jsr _a1c7
    sta $3431
    cmp #$21
    bcc _9f81
_9f76:
    jsr _a1c7
    dec $3431
    bne _9f76
    jmp _9ff1
_9f81:
    ldy $3b22
    iny
    stx $37be
    ldx #$00
_9f8a:
    lda _a01f,x     ; Characters from below
    sta $39cb,y
    iny
    inx
    cpx #$09
    bne _9f8a
    ldx $37be
    lda $3431
    beq _9fad
_9f9e:
    jsr _a1c7
    jsr _9e81
    sta $39cb,y
    iny
    dec $3431
    bne _9f9e
_9fad:
    lda $3b21
    ora #$04
    sta $3b21
    stx $37be
    sec
    ldx $3b22
    tya
    sbc $3b22
    sta $39cb,x
    sty $3b22
    clc
    sbc #$09
    beq _9fee
    sta $3431
    txa
    sec
    adc #$09
    tay
    ldx #$00
_9fd5:
    lda $39cb,y
    cmp #$30
    bcc _9fe8
    cmp #$3a
    bcs _9ff7
_9fe0:
    cpx #$16
    beq _9fe8
    sta $397e,x
    inx
_9fe8:
    iny
    dec $3431
    bne _9fd5
_9fee:
    ldx $37be
_9ff1:
    jsr _a1fb
    jmp _9d8b
_9ff7:
    cmp #$58
    beq _9fff
    cmp #$78
    bne _9fe8
_9fff:
    lda $3430
_a000:
    bmi _a036
    bne _9fe8
    lda $3431
    cmp #$03
    bcc _9fe8
    lda $39cc,y
    cmp #$30
    bcc _9fe8
    cmp #$3a
    bcs _9fe8
    lda $39cb,y
    sta $3430
    jmp _9fe0
_a01f:
.byte "NUMBER:  "

_a028:
    jsr _a1c7
    beq _a030
_a02d:
    jmp _9dff
_a030:
    jsr _a1c7
    sta $3431
_a036:
    lda $3b21
    and #$40
    bne _a02d
    lda $3431
    cmp #$41
    bcc _a047
    jmp _9f47
_a047:
    ldy $3b22
    iny
    stx $37be
    ldx #$00
_a050:
    lda _a07b,x     ; Characters from below
    sta $39cb,y
    iny
    inx
    cpx #$09
    bne _a050
    ldx $37be
    lda $3431
    beq _a073
_a064:
    jsr _a1c7
    jsr _9e81
    sta $39cb,y
    iny
    dec $3431
    bne _a064
_a073:
    lda $3b21
    ora #$50
    jmp _a0ce
_a07b:
.byte "FROM:    "

_a084:
    jsr _a1c7
    beq _a08c
_a089:
    jmp _9dff
_a08c:
    jsr _a1c7
    cmp #$41
    bcs _a089
    sta $3431
    lda $3b21
    and #$80
    bne _a089
    ldy $3b22
    iny
    stx $37be
    ldx #$00
_a0a6:
    lda _a0eb,x
    sta $39cb,y
    iny
    inx
    cpx #$09
    bne _a0a6
    ldx $37be
    lda $3431
    beq _a0c9
_a0ba:
    jsr _a1c7
    jsr _9e81
    sta $39cb,y
    iny
    dec $3431
    bne _a0ba
_a0c9:
    lda $3b21
    ora #$a0
_a0ce:
    sta $3b21
    jsr _a1fb
    stx $3b20
    sec
    ldx $3b22
    tya
    sbc $3b22
    sta $39cb,x
    sty $3b22
    ldx $3b20
    jmp _9d85
_a0eb:
.byte "SUBJECT: "

_a0f4:
    lda $3b27
    cmp #$d8
    beq _a102
    cmp #$e0
    beq _a102
_a0ff:
    jmp _9dff
_a102:
    lda #$00
    sta $3b27
    jsr _a1c7
    bne _a0ff
    jsr _a1c7
    bne _a114
    jmp _a169
_a114:
    sta $3430
    lda $3b28
    beq _a13f
    cmp #$01
    bne _a16c
    inc $3b28
    jsr _a17f
    ldy #$3f
    stx $37be
    ldx #$00
_a12d:
    lda _a177,x
    sta $395b,y
    iny
    inx
    cpx #$08
    bne _a12d
    ldx $37be
    jmp _a16c
_a13f:
    inc $3b28
    ldy #$3f
_a144:
    jsr _a1c7
    jsr _9e81
    cmp #$2e
    beq _a15a
    cmp #$20
    beq _a15a
    cmp #$2d
    beq _a15a
    sta $395b,y
    iny
_a15a:
    dec $3430
    beq _a169
    cpy #$16
    bne _a144
    jsr _a17f
    jmp _a16c
_a169:
    jmp _9ff1
_a16c:
    jsr _a1fb
    dec $3430
    beq _a169
    jmp _a16c
_a177:
.byte "multiple"

_a17f:
    ldy #$3f
    lda #$20
_a183:
    sta $395b,y
    iny
    cpy #$5d
    bne _a183
    rts

_a18c:
    and #$0f
    asl
    asl
    asl
    asl
    pha
    lda $3420
    and #$0f
    sta $3420
    pla
    sed
    clc
    adc $3420
    ldy #$00
    cmp #$16
    bcc _a1af
_a1a7:
    sec
    sbc #$16
    iny
    cmp #$16
    bcs _a1a7
_a1af:
    cmp #$10
    bcc _a1b9
    and #$0f
    clc
    cld
    adc #$0a
_a1b9:
    cld
    sta $3420
    tya
    asl
    asl
    asl
    asl
    clc
    adc $3420
    rts

_a1c7:
    jsr _a235
    bcs _a1e5
    lda $3b2f
    bne _a1e0
    inx
    beq _a1d8
    lda $0b02,x
    rts
_a1d8:
    lda #$ff
    sta $3b2f
    jmp _a1e1
_a1e0:
    inx
_a1e1:
    lda $0c02,x
    rts
_a1e5:
    lda #$ff
_a1e7:
    sta $3b2b
    sty $3b36
    lda #$ff
    sta $37c1
    pla
    sta $3b29
    pla
    sta $3b2a
    rts

_a1fb:
    jsr _a235
    bcs _a211
_a200:
    lda $3b2f
    bne _a20f
    inx
    beq _a209
    rts
_a209:
    lda #$ff
    sta $3b2f
    rts
_a20f:
    inx
    rts
_a211:
    lda #$7f
    jmp _a1e7

_a216:
    lda #$00
    sta $3b2f
    sta $37c1
    tax
    lda $3b2a
    pha
    lda $3b29
    pha
    ldy $3b36
    lda $3b2b
    cmp #$7f
    beq _a234
    lda $0b02,x
_a234:
    rts

_a235:
    dec $374c
    beq _a23c
_a23a:
    clc
    rts
_a23c:
    lda $374b
    beq _a249
    lda #$00
    sta $374b
    jmp _a23a
_a249:
    sec
    rts

_a24b:       ; RAM entry point 12
    lda #$0a
    sta $3431
    ldx #$08
    ldy #$00
    lda #$a8
    sta $0b02,y
    iny
    lda #$00
    sta $0b02,y
    iny
    lda #$0e
    sta $0b02,y
    iny
    lda $395b,x
    jsr _a3da
    inx
    lda #$3a
    sta $0b02,y
    iny
    lda $395b,x
    jsr _a3da
    lda #$20
    sta $0b02,y
    iny
    ldx #$05
    lda $395b,x
    jsr _a3da
    inx
    lda #$2f
    sta $0b02,y
    iny
    lda $395b,x
    jsr _a3da
    inx
    lda #$2f
    sta $0b02,y
    iny
    lda $395b,x
    jsr _a3da
    lda #$d0
    sta $0b02,y
    iny
    lda #$00
    sta $0b02,y
    iny
    tax
    lda #$0a
    sta $0b02,y
    iny
_a2b4:
    lda _a3b9,x         ; Read the text from below
    sta $0b02,y
    iny
    inx
    cpx #$0a
    bcc _a2b4
    lda #$90
    sta $0b02,y
    iny
    lda #$00
    sta $0b02,y
    iny
    sta $3430
    tax
    sty $3b22
    iny
    lda #$16
    sta $3431
_a2d9:
    lda _a3c3,x
    sta $0b02,y
    inc $3430
    iny
    inx
    cpx #$08
    bcc _a2d9
    ldx #$00
_a2ea:
    lda $fd07,x
    cmp #$30
    bne _a2fa
    lda $3430
    cmp #$08        ; backspace
    beq _a319
    lda #$30        ; "0"
_a2fa:
    cmp #$20        ; " "
    beq _a319
    cmp #$58        ; "X"
    beq _a312
    cmp #$78        ; "x"
    beq _a312
    cmp #$3b        ; ";"
    beq _a31f
    cmp #$30        ; "0"
    bcc _a319
    cmp #$3a        ; ":"
    bcs _a319
_a312:
    sta $0b02,y
    iny
    inc $3430
_a319:
    inx
    dec $3431
    bne _a2ea
_a31f:
    ldx $3b22
    lda $3430
    sta $0b02,x
    lda #$d8
    sta $0b02,y
    iny
    lda #$00
    sta $0b02,y
    iny
    sta $0b02,y
    iny
    lda #$98
    sta $0b02,y
    iny
    lda #$00
    sta $0b02,y
    sta $3430
    iny
    tya
    sta $3b22
    iny
    ldx #$0b
    lda $395b,x
    tax
_a352:
    lda $395b,x
    cmp #$3b
    beq _a370
    cmp #$7d
    beq _a370
    sta $0b02,y
    inc $3430
    iny
    inx
    cpx #$5d
    beq _a370
    lda $3430
    cmp #$16
    bne _a352
_a370:
    tya
    tax
    lda $3b22
    tay
    lda $3430
    sta $0b02,y
    txa
    tay
    lda #$f0
    sta $0b02,y
    iny
    lda #$00
    sta $0b02,y
    iny
    tax
    lda #$0f
    sta $0b02,y
    iny
_a391:
    lda _a3cb,x
    sta $0b02,y
    iny
    inx
    cpx #$0f
    bcc _a391
    lda #$f8
    sta $0b02,y
    iny
    lda $37bc
    sta $0b02,y
    iny
    lda $37bd
    sta $0b02,y
    iny
    sty $374c
    iny
    sty $374e
    rts

_a3b9:
.byte "M2105 User"
_a3c3:
.byte "TML:944-"
_a3cb:
.byte "(M2105 Message)"

_a3da:
    pha
    and #$f0
    lsr
    lsr
    lsr
    lsr
    sta $3420
    cmp #$00
    beq _a3fb
    txa
    pha
    ldx $3420
    sed
    lda #$00
_a3f0:
    clc
    adc #$16
_a3f3:
    dex
    bne _a3f0
    sta $3420
    pla
    tax
_a3fb:
    pla
    and #$0f
    cmp #$0a
    bcc _a40a
    cld
    sec
    sbc #$0a
    sed
    clc
    adc #$10
_a40a:
    clc
    adc $3420
    sta $3420
    and #$f0
    lsr
    lsr
    lsr
    lsr
    cld
    clc
    adc #$30
    sta $0b02,y
    iny
    lda $3420
    and #$0f
    clc
    adc #$30
    sta $0b02,y
    iny
    rts

_a42c:       ; RAM entry point 14
    ldx #$01
    ldy $3b20
    sty $3b31
    sty $37bf
    lda $3b2f
    sta $3b2e
    sta $3b30
    jsr _a614
    lda #$00
    jmp _a45c

_a448:       ; RAM entry point 15
    ldx #$01
    stx $37bf
    lda #$00
    tay
    sta $3b2e
    sta $3b2f
    sta $3b30
    sta $3b31
_a45c:
    sta $37b5
    sta $3b35
    sta $37be
_a465:
    lda $3b2f
    beq _a470
    lda $0c02,y
    jmp _a473
_a470:
    lda $0b02,y
_a473:
    cmp #$ff
    bne _a47a
    jmp _a4fc
_a47a:
    cmp #$0d
    beq _a482
    cmp #$0a
    bne _a485
_a482:
    jmp _a539
_a485:
    jsr _9e81
    cpx #$01
    beq _a4a5
    pha
    lda $3b2f
    bne _a4df
    lda $37be
    sty $3420
    ldy $37bf
    sta $0b02,y
_a49e:
    jsr _a614
    ldy $3420
    pla
_a4a5:
    sta $37be
    inx
    cpx #$ff
    bne _a4b1
    stx $37c2
    rts
_a4b1:
    jsr _a61f
    bcc _a465
    cpx #$01
    bne _a4bb
    rts
_a4bb:
    inc $37b6
    inc $3b35
    lda $3b35
    sta $37b4
    ldy $3b31
    dex
    stx $37c2
    lda $3b30
    beq _a4d9
    lda #$ff
    sta $0c02,y
    rts
_a4d9:
    lda #$ff
    sta $0b02,y
    rts
_a4df:
    sty $3420
    ldy $37bf
    lda $3b2e
    beq _a4f3
    lda $37be
    sta $0c02,y
    jmp _a49e
_a4f3:
    lda $37be
    sta $0b02,y
    jmp _a49e

_a4fc:
    cpx #$01
    beq _a52d
    ldy $37bf
    lda $3b2e
    bne _a511
    lda $37be
    sta $0b02,y
    jmp _a517
_a511:
    lda $37be
    sta $0c02,y
_a517:
    ldy $3b31
    lda $3b30
    bne _a526
    txa
    sta $0b02,y
    jmp _a52a
_a526:
    txa
    sta $0c02,y
_a52a:
    inc $3b35
_a52d:
    lda #$ff
    sta $3b25
    lda $3b35
    sta $37b4
    rts

_a539:
    cpx #$01
    bne _a540
    jmp _a5f2
_a540:
    lda $37be
    cmp #$20
    bne _a5a6
    cpx #$02
    beq _a54e
    jmp _a577
_a54e:
    inc $37b5
    tya
    pha
    ldy $3b31
    dex
    lda $3b30
    beq _a563
    txa
    sta $0c02,y
    jmp _a567
_a563:
    txa
    sta $0b02,y
_a567:
    jsr _a62d
    jsr _a614
    pla
    tay
_a56f:
    inc $3b35
    ldx #$01
    jmp _a4b1
_a577:
    lda #$00
    sta $37be
    dex
    tya
    pha
    ldy $3b31
    lda $3b30
    bne _a59f
    txa
    sta $0b02,y
_a58b:
    ldy $37bf
    sty $3b31
    ldy $3b2e
    sty $3b30
    jsr _a614
    pla
    tay
    jmp _a56f
_a59f:
    txa
    sta $0c02,y
    jmp _a58b
_a5a6:
    tya
    pha
    ldy $3b31
    lda $3b30
    bne _a5d9
    txa
    sta $0b02,y
    ldy $37bf
    lda $3b2e
    bne _a5e9
    lda $37be
    sta $0b02,y
_a5c2:
    jsr _a614
    lda $3b2e
    sta $3b30
    ldy $37bf
    sty $3b31
    jsr _a614
    pla
    tay
    jmp _a56f
_a5d9:
    txa
    sta $0c02,y
    ldy $37bf
    lda $37be
    sta $0c02,y
    jmp _a5c2
_a5e9:
    lda $37be
    sta $0c02,y
    jmp _a5c2
_a5f2:
    sty $3420
    ldy $3b31
    lda $3b30
    bne _a60d
    txa
    sta $0b02,y
_a601:
    jsr _a62d
    jsr _a614
    ldy $3420
    jmp _a56f
_a60d:
    txa
    sta $0c02,y
    jmp _a601

_a614:
    inc $37bf
    bne _a637
    lda #$ff
    sta $3b2e
    rts

_a61f:
    jsr _a235
    bcs _a637
    iny
    bne _a637
    lda #$ff
    sta $3b2f
    rts
_a62d:
    inc $3b31
    bne _a637
    lda #$ff
    sta $3b30
_a637:
    rts

_a638:       ; RAM entry point 13
    lda $3b21
    and #$10
    beq _a64f
    lda $39cb
    sta $3430
    lda #$01
    sta $39cb
    lda #$ef
    jmp _a6b4
_a64f:
    lda $3b21
    and #$40
    beq _a661
    lda $3430
    sta $39cb
    lda #$bf
    jmp _a6b4
_a661:
    lda $3b21
    and #$04
    beq _a676
    jsr _a6cc
    lda $39cb
    sta $3431
    lda #$fb
    jmp _a6b4
_a676:
    lda $3b21
    and #$20
    beq _a691
    clc
    lda $3430
    adc $3431
    sta $3430
    lda #$01
    sta $39cb
    lda #$df
    jmp _a6b4
_a691:
    lda $3b21
    and #$80
    beq _a6a0
    jsr _a6cc
    lda #$7f
    jmp _a6b4
_a6a0:
    lda $3b21
    and #$08
    beq _a6bb
    ldy #$00
    tya
    jsr _a7d2
    lda #$01
    sta $39cb
    lda #$f7
_a6b4:
    and $3b21
    sta $3b21
    rts
_a6bb:
    lda #$00
    sta $3b21
    ldx #$a1
    jsr $3300
    ldx $3b20
    stx $3ae7
    rts

_a6cc:
    ldy #$00
    ldx $3430
    lda $39cb,x
    sta $3431
_a6d7:
    lda $39cb,x
    sta $39cb,y
    iny
    inx
    dec $3431
    bne _a6d7
    rts

_a6e5:       ; RAM entry point 16
    lda $37d2
    cmp #$0d
    bcs _a723
    ldx #$00
    jsr _a729
    bcc _a71a
    ldx #$ff
    jsr _a729
    bcs _a723
    lda $342d
    cmp #$06
    beq _a71a
    stx $379e
    stx $37d1
    lda #$54
    sta $379d
    lda #$13
    sta $379c
    lda #$02
    sta $379b
    sta $379a
    rts
_a71a:
    ldx #$00
    stx $379e
    stx $37d1
    rts
_a723:
    lda #$01
    sta $379e
    rts
_a729:
    lda #$00
    tay
_a72c:
    cpx #$00
    bne _a736
    lda _a754,y
    jmp _a739
_a736:
    lda _a759,y
_a739:
    cmp $37c5,y
    bne _a752
    iny
    cpy $37d2
    bcc _a72c
    cpx #$00
    bne _a74e
    cpy #$05
    bne _a752
_a74c:
    clc
    rts
_a74e:
    cpy #$0c
    beq _a74c
_a752:
    sec
    rts
_a754: .byte "M2105"
_a759: "~CTXFR      "

_a765:       ; RAM entry point 17
    lda #$00
    tax
_a768:
    sta $395b,x
    inx
    cpx #$66
    bne _a768
    stx $395b
    lda #$39
    sta $3965
    lda #$3f
    sta $3966
    sta $3430
    lda #$54
_a782:          ; a783,4 are referred to below
    sta $39b9
    ldx #$0d
    lda #$20
    sta $395c
_a78c:
    sta $395b,x
    inx
    cpx #$39
    bne _a78c
    ldx #$3f
_a796:
    sta $395b,x
    inx
    cpx #$5d
    bne _a796
    ldx #$39
    lda #$40
_a7a2:
    sta $395b,x
    inx
    cpx #$3f
    bne _a7a2
    lda #$00
    sta $3ae7
    tay
_a7b0:
    sta $37b3,y
    iny
    cpy #$0f
    beq _a7b0
    bcc _a7b0
    tay
_a7bb:
    sta $3b1d,y
    iny
    cpy #$19
    beq _a7bb
    bcc _a7bb
    lda #$09
    sta $3b21
    lda #$6e
    sta $37bd
    lda #$00
    tay
_a7d2:
    sta $39cb,y
    iny
    cpy #$fd
    bcc _a7d2
    rts

_a7db:       ; RAM entry point 18
    lda $35ed
    bne _a7e5
    ldx #$9c
    jmp $3300
_a7e5:
    lda $35ee
    and #$df
    cmp #$41        ; "A"
    bcc _a804
    cmp #$5a        ; "Z"
    bcs _a804
    asl
    tax
    lda #$a8
    pha
    lda #$03
    pha
    lda [_a782 + 2],x
    pha
    lda [_a782 + 1],x
    pha
    php
    rti
_a804:
    rts

$a805  04        ???
$a806  a8        tay
$a807  04        ???
$a808  a8        tay
$a809  04        ???
$a80a  a8        tay
$a80b  04        ???
$a80c  a8        tay
$a80d  04        ???
$a80e  a8        tay
$a80f  04        ???
$a810  a8        tay
$a811  04        ???
$a812  a8        tay
$a813  04        ???
$a814  a8        tay
$a815  04        ???
$a816  a8        tay
$a817  04        ???
$a818  a8        tay
$a819  04        ???
$a81a  a8        tay
$a81b  91 a8     sta ($a8),y
$a81d  04        ???
$a81e  a8        tay
$a81f  04        ???
$a820  a8        tay
$a821  04        ???
$a822  a8        tay
$a823  04        ???
$a824  a8        tay
$a825  04        ???
$a826  a8        tay
$a827  04        ???
$a828  a8        tay
$a829  04        ???
$a82a  a8        tay
$a82b  04        ???
$a82c  a8        tay
$a82d  04        ???
$a82e  a8        tay
$a82f  04        ???
$a830  a8        tay
$a831  04        ???
$a832  a8        tay
$a833  04        ???
$a834  a8        tay
$a835  16 a9     asl $a9,x

_a837:
    pha
    lsr
    lsr
    lsr
    lsr
    jsr _a840
    pla
_a840:              ; Write a hexadecimal digit
    and #$0f
    cmp #$0a        ; Set carry if >= 10
    sed
    adc #$30
    cld
    jmp OSWRCH

_a84b:
    cmp #$20
    bcc _a853
    cmp #$7f
    bcc _a855
_a853:
    lda #$2e       ; "."
_a855:
    jmp OSWRCH

_a858:
    cmp #$30        ; "0"
    bcc _a871
    cmp #$3a        ; "9"
    bcc _a86d
    and #$df
    cmp #$41        ; "A"
    bcc _a871
    cmp #$47        ; "F"
    bcs _a871
    sec
    sbc #$07
_a86d:
    and #$0f
    clc
    rts
_a871:
    sec
    rts

_a873: 0a        asl
$a874  0a        asl
$a875  0a        asl
$a876  0a        asl
$a877  0a        asl
$a878  26 16     rol $16
$a87a  26 17     rol $17
$a87c  0a        asl
$a87d  26 16     rol $16
$a87f  26 17     rol $17
$a881  0a        asl
$a882  26 16     rol $16
$a884  26 17     rol $17
$a886  0a        asl
$a887  26 16     rol $16
$a889  26 17     rol $17
$a88b  60        rts
_a88c: e8        inx
$a88d  bd ee 35  lda $35ee,x
$a890  60        rts

$a891  a2 00     ldx #$00
$a893  86 16     stx $16
$a895  86 17     stx $17
_a897: 20 8c a8  jsr _a88c
$a89a  20 58 a8  jsr _a858
$a89d  b0 06     bcs _a8a5
$a89f  20 73 a8  jsr _a873
$a8a2  4c 97 a8  jmp _a897
_a8a5: a9 0c     lda #$0c       ; Clear text window
$a8a7  20 ee ff  jsr OSWRCH
$a8aa  a2 00     ldx #$00
_a8ac: 8e 20 34  stx $3420
$a8af  20 bb a8  jsr _a8bb
$a8b2  ae 20 34  ldx $3420
$a8b5  e8        inx
$a8b6  e0 11     cpx #$11
$a8b8  90 f2     bcc _a8ac
$a8ba  60        rts
_a8bb: a2 00     ldx #$00
$a8bd  a5 17     lda $17
$a8bf  20 37 a8  jsr _a837
$a8c2  a5 16     lda $16
$a8c4  20 37 a8  jsr _a837
$a8c7  20 1f a9  jsr _a91f
$a8ca  20 2b a9  jsr _a92b
$a8cd  20 2b a9  jsr _a92b
$a8d0  20 f2 a8  jsr _a8f2
$a8d3  20 f2 a8  jsr _a8f2
$a8d6  20 f2 a8  jsr _a8f2
$a8d9  20 f2 a8  jsr _a8f2
$a8dc  20 2b a9  jsr _a92b
$a8df  20 2b a9  jsr _a92b
$a8e2  a2 00     ldx #$00
_a8e4: bd ef 3a  lda $3aef,x
$a8e7  20 4b a8  jsr _a84b
$a8ea  e8        inx
$a8eb  e0 10     cpx #$10
$a8ed  90 f5     bcc _a8e4
$a8ef  4c e7 ff  jmp OSNEWL
_a8f2: 20 04 a9  jsr _a904
$a8f5  20 04 a9  jsr _a904
$a8f8  20 04 a9  jsr _a904
$a8fb  20 04 a9  jsr _a904
$a8fe  20 2b a9  jsr _a92b
$a901  4c 2b a9  jmp _a92b
_a904: a0 00     ldy #$00
$a906  b1 16     lda ($16),y
$a908  9d ef 3a  sta $3aef,x
$a90b  e8        inx
$a90c  20 37 a8  jsr _a837
$a90f  e6 16     inc $16
$a911  d0 02     bne _a915
$a913  e6 17     inc $17
_a915: 60        rts
$a916  a9 ff     lda #$ff
$a918  8d 05 3b  sta $3b05
$a91b  60        rts
_a91c: 20 4b a8  jsr _a84b
_a91f: a9 3a     lda #$3a       ; ":"
$a921  4c ee ff  jmp OSWRCH
$a924  20 1c a9  jsr _a91c
$a927  8a        txa
$a928  20 37 a8  jsr _a837
_a92b: a9 20     lda #$20       ; " "
$a92d  4c ee ff  jmp OSWRCH

_a930:       ; RAM entry point 19
    jsr _ba7a
    lda #$10
    ora $3419
    sta $3419
    lda $35ed
    beq _a95a
    ldx #$01
    stx $3444
    jsr _bb01
    jsr _b7d5
    jsr _ba0c
    jsr _ae1a
    jsr _b7dc
    jsr _b79c
    jmp _a965
_a95a:
    ldx #$00
    stx $3444
    jsr _aaef
    jsr _bd58
_a965:
    lda #$16       ; MODE
    jsr OSWRCH
    lda #$03       ; 3
    jsr OSWRCH
    lda #$00
    sta $3414
    ldx #$17
    ldy $37da
    dey
    bne _a97d
    inx
_a97d:
    stx $0798
    jsr _baa1
_a983:
    ldy #$00
    sty $0797
    jsr _a991
    jsr _a9d3
    jmp _a983
_a991:
    jsr read_key
    bcs _a9c4
    txa
    jsr _a9c5
    cmp #$90
    bcc _a9a1
    jmp _aa41
_a9a1:
    ldy $37da
    dey
    beq _a9bf
    cmp #$88
    bcc _a9bf
    cmp #$8c
    bcs _a9bf
    eor #$8f
    adc #$3d
    pha
    lda #$1b
    jsr _b2eb
    lda #$5b
    jsr _b2eb
    pla
_a9bf:
    and #$7f
    jsr _b2eb
_a9c4:
    rts
_a9c5:
    ldx $0799
    beq _a9d2
    jsr _b238
    ldx #$00
    stx $0799
_a9d2:
    rts

_a9d3:
    lda $35ed
    beq _a9e0
    jsr _b85e
    bcs _a9e0
    jmp _bb18
_a9e0:
    jsr _bd11
    bcc _aa40
    jsr _a9c5
    bit $079a
    bvc _a9f0
    jmp _ac30
_a9f0:
    ldx $07f4
    beq _a9f8
    jmp _ab49
_a9f8:
    cmp #$1b
    bne _aa02
    ldx #$ff
    stx $07f4
    rts
_aa02:
    cmp #$7f
    beq _aa40
    ldy $37da
    dey
    beq +
    jsr _aa97
*   jsr _aa82
    tay
    bmi _aa40
    bit $079a
    bpl _aa25
    cmp #$0e
    bcc _aa22
    cmp #$20
    bcc _aa25
_aa22:
    jsr _aebe
_aa25:
    bit $0777
    bpl _aa2d
    jsr _af52
_aa2d:
    cmp #$0d
    bne _aa40
    ldy #$00
    sty $07f3
    ldy $37de
    beq _aa40
    lda #$0a
    jmp _aa02
_aa40:
    rts

_aa41:
    cmp #$9a
    bcs _aa51
    sec
    sbc #$90
    tax
    lda _aa52,x        ; Look up the high address byte (HH).
    pha
    lda _aa5c,x        ; Look up the low address byte (LL).
    pha
_aa51:
    rts                ; Return via the routine at $HHLL+1.

_aa52: .byte >[_bb18 - 1],>[_aa51 - 1],>[_aa51 - 1],>[_afd0 - 1],>[_bd5f - 1],>[_af13 - 1],>[_ae39 - 1],>[_aa51 - 1],>[_bc2d - 1],>[_aa66 - 1]
_aa5c: .byte <[_bb18 - 1],<[_aa51 - 1],<[_aa51 - 1],<[_afd0 - 1],>[_bd5f - 1],<[_af13 - 1],<[_ae39 - 1],<[_aa51 - 1],<[_bc2d - 1],<[_aa66 - 1]

; Via table at aa52:
_aa66:
    lda #$34
    clc
    adc $3444
    pha
    ldx #$60
    jsr $3354

_aa72: a9 79     lda #$79       ; Keyboard scan
$aa74  a2 a6     ldx #$a6
$aa76  20 f4 ff  jsr OSBYTE
$aa79  8a        txa
$aa7a  30 f6     bmi _aa72      ; Until key pressed
$aa7c  68        pla
$aa7d  a2 70     ldx #$70
$aa7f  4c 54 33  jmp $3354

_aa82:
    ldy $0797
    bne _aa96
    cmp #$07       ; Bell?
    bcc _aa96
    cmp #$0e       ; Paged mode on?
    bcc _aa93
    cmp #$1e       ; Home?
_aa91:
    bcc _aa96
_aa93:
    jsr OSWRCH
_aa96:
    rts

_aa97:
    pha
    pha
    jsr get_cursor_pos
    pla
    cpy #$00       ; Top row?
    beq _aac6
    cpy #$17       ; Row 23
    beq _aaa7
_aaa5:
    pla
    rts
_aaa7:
    cmp #$0a       ;
    beq _aab7
    cpx #$4f       ; Column 79?
    bne _aaa5      ; then return
_aaaf:
    cmp #$0d
    beq _aaa5
    cmp #$08
    beq _aaa5
_aab7:
    jsr write_record_char      ; Write character
    lda #$0a                   ; Move cursor down
    jsr OSWRCH
    lda #$0b                   ; Move cursor up
    jsr OSWRCH
    pla
    rts
_aac6:
    cmp #$0b
    beq _aad5
    cpx #$00       ; Column 0?
    bne _aaa5      ; Exit if not
    cmp #$08       ; Cursor left?
    beq _aad5
    jmp _aaa5      ; Exit if not
_aad5:
    jsr write_record_char
    jsr record_cursor_pos
    ldx #$00
    ldy #$18                    ; A full row at y=24
    jsr define_text_window_row
    jsr set_cursor_pos
    pla
    rts

write_record_char:          ; aae7
    ldy #$ff
    sty $0797
    jmp OSWRCH

_aaef:
    lda #$34
    ldy #$33
    php
    sei
    sta $0204
    sty $0205
    plp
    jsr _ab30
    lda #$00
    jsr $3354
    lda #$02
    jsr $3354
    lda #$0c
    ldx #$02
    jsr $3354
    lda #$0e
    ldx $37e9
    jsr $3354
    ldx $37e7
    lda #$07
    jsr OSBYTE
    ldx $37e8
    lda #$08
    jsr OSBYTE
    lda #$08
    ldx #$05
    jsr $3354
    rts
_ab30:
    lda #$04
    jsr $3354
    lda #$05
    jsr $3354
    lda #$08
    ldx #$85
    jmp $3354
_ab41:
    pha
    lda #$07
    jsr OSWRCH
    pla
    rts
_ab49:
    cpx #$ff
    bcc _ab62
    cmp #$5b
    beq _ab59
    ldx #$00
    stx $07f4
    jmp _aa82
_ab59:
    dec $07f4
    ldy #$00
    sty $0764
    rts
_ab62:
    cmp #$30
    bcc _ab7b
    ldy $0764
    sta $076c,y
    sta $076d,y
    cmp #$40
    bcs _ab81
    iny
    sty $0764
    cpy #$08
    bcc _ab80
_ab7b:
    ldx #$00
    stx $07f4
_ab80:
    rts
_ab81:
    ldx #$00
    stx $07f4
    dex
_ab87:
    inx
    cmp _ab99,x
    bcc _ab87
    beq _ab90
    rts
_ab90:
    lda _aba4,x         ; Load high address byte (HH)
    pha
    lda _abae,x         ; Load low address byte (LL)
    pha
    rts                 ; Return to $HHLL+1

_ab99:
.byte "mifKJHDCBA", $00
_aba4:
.byte >[_abb8 - 1],>[_abf0 - 1],>[_ac85 - 1],>[_adbe - 1],>[_ad66 - 1]
.byte >[_ac85 - 1],>[_acb9 - 1],>[_acb9 - 1],>[_acb9 - 1],>[_acb9 - 1]
_abae:
.byte <[_abb8 - 1],<[_abf0 - 1],<[_ac85 - 1],<[_adbe - 1],<[_ad66 - 1]
.byte <[_ac85 - 1],<[_acb9 - 1],<[_acb9 - 1],<[_acb9 - 1],<[_acb9 - 1]

_abb8:
     dey
    bmi _abc2
    lda $076c,y
    cmp #$30
    bne _abcc
_abc2:
    ldx #$00
    stx $076b
_abc7:
    lda #$14       ; Restore default colours
    jmp OSWRCH

_abcc:
    ldx #$ff
    stx $076b
inverted_colours:
    lda #$11       ; Colour
    jsr OSWRCH
    lda #$00       ; 0
    jsr OSWRCH
    lda #$11       ; Colour
    jsr OSWRCH
    lda #$81       ; 129
    jmp OSWRCH
_abe5:
    lda $076b
    beq _abed
    jmp _abc2
_abed:
    jmp _abcc
_abf0:
    dey
    bmi _ac03
    jsr _ad2d
    dey
    beq _ac16
    lda $0764
    beq _ac03
    cmp #$05
    beq _ac06
    rts
_ac03:
    jmp _afd0
_ac06:
    lda $079a
    bmi _ac10
    jsr _ae39
    lda #$00
_ac10:
    ora #$40
    sta $079a
    rts
_ac16:
    lda $076c
    cmp #$3f
    bne _ac2f
    iny
    jsr _ad2f
    cmp #$04
    bne _ac28
    jmp _ae7b
_ac28:
    cmp #$05
    bne _ac2f
    jmp _ae33
_ac2f:
    rts

_ac30:
    cmp #$1b
    bne _ac37
    jsr _aeea
_ac37:
    inc $07a1
    ldx $07a1
    sta $07a1,x
    cmp #$69
    bne _ac6a
    cpx #$04
    bne _ac6a
    ldx #$01
    lda $07a1,x
    cmp #$1b
    bne _ac6a
    inx
    lda $07a1,x
    cmp #$5b
    bne _ac6a
    inx
    lda $07a1,x
    cmp #$34
    beq _ac72
    cmp #$35
    bne _ac6a
    ldx #$00
    stx $07a1
_ac6a:
    cpx #$50
    bcc _ac71
    jsr _aeea
_ac71:
    rts
_ac72:
    ldx #$00
    stx $07a1
    rol $079a
    bcs _ac7f
    jmp _ae7b
_ac7f:
    lda #$80
    sta $079a
    rts
_ac85:
    jsr _ad2d
    tax
    dex
    dex
    bmi _ac96
    cpx $0798
    bcc _ac96
    ldx $0798
    dex
_ac96:
    inx
    stx $0768
    jsr _ad2f
    tax
    cpx #$51
    bcc _aca4
    ldx #$50
_aca4:
    dex
    stx $0767
; aca8
set_cursor_pos:                 ; Move text cursor to x=($0767), y=($0768)
    lda #$1f
    jsr OSWRCH
    lda $0767
    jsr OSWRCH
    lda $0768
    jmp OSWRCH

_acb9:
    inx
    inx
    stx $0766
    jsr _ad2d
_acc1:
    pha
    jsr get_cursor_pos
    lda $0766
    cmp #$0a
    bcc _acdd
    bne _acd4
    clc
    adc $37da
    and #$fe
_acd4:
    tax
    tya
    cmp [_ace7 + 2],x
    bne _ace4
_acdb:
    pla
    rts
_acdd:
    tay
    txa
    cmp [_ace7 + 2],y
    beq _acdb
_ace4:
    lda $0766
_ace7:
    jsr OSWRCH
    pla
    tay
    dey
    tya
    bne _acc1
    rts

$acf1  00        brk
$acf2  4f        ???
$acf3  18        clc
$acf4  00        brk
$acf5  17        ???

record_cursor_pos:
    jsr get_cursor_pos
    stx $0767
    sty $0768
    rts

_ad00:
    jsr get_cursor_pos
    cpy $0798
    bcc clear_to_line_end
define_text_window_row: ; ad08
    tya                    ; Text window bottom=top
    jsr define_text_window
    lda #$0a               ; Newline
    jsr OSWRCH
    lda #$1a               ; Reset text window
    jmp OSWRCH

clear_to_line_end:
    cpx #$50
    beq _ad23
    lda #$20
    jsr OSWRCH
    inx
    jmp clear_to_line_end
_ad23:
    rts

_ad24:
    ldx $076b
    beq +
    jsr inverted_colours
*   rts

_ad2d:
    ldy #$00
_ad2f:
    lda #$00
    sta $0764
_ad34:
    ldx $076c,y
    cpx #$3a
    bcs _ad5e
    lda $0764
    bmi _ad58
    sta $0765
    asl
    bmi _ad58
    asl
    bmi _ad58
    clc
    adc $0765
    bmi _ad58
    asl
    bmi _ad58
    adc $076c,y
    sec
    sbc #$30
_ad58:
    sta $0764
    iny
    bne _ad34
_ad5e:
    iny
    cmp #$00
    bne _ad65
    lda #$01
_ad65:
    rts

_ad66:
    jsr _adf0
    cpy #$ff
    beq _ad82
    lda $076c,y
    cmp #$30
    beq _ad82
    cmp #$31
    beq _ad96
    cmp #$32
    beq _adb6
_ad7c:
    jsr _ad24
    jmp set_cursor_pos

_ad82:
    jsr get_cursor_pos
    cpy $0798
    beq _ad90
    jsr clear_to_line_end
    jmp _ad82
_ad90:
    jsr _ad00
    jmp _ad7c
_ad96:
    lda #$1e       ; Home
    jsr OSWRCH
_ad9b:
    jsr get_cursor_pos
    cpy $0768
    bcs _ada9
    jsr clear_to_line_end
    jmp _ad9b
_ada9:
    lda #$4f
    sec
    sbc $0767
    tax
    jsr clear_to_line_end
    jmp _ad7c
_adb6:
    lda #$0c       ; Clear text window
    jsr OSWRCH
    jmp _ad7c

_adbe:
    jsr _adf0
    cpy #$ff
    beq _add7
    lda $076c,y
    cmp #$30
    beq _add7
    cmp #$31
    beq _addd
    cmp #$32
    beq _ade5
    jmp _ad7c
_add7:
    jsr _ad00
    jmp _ad7c
_addd:
    lda #$0d       ; Carriage return
    jsr OSWRCH
    jmp _ada9
_ade5:
    lda #$0d       ; Carriage return
    jsr OSWRCH
    jsr _ad00
    jmp _ad7c

_adf0:
    lda #$00
    ldy #$18
    tax
    jsr define_text_window
    jsr _abc7
    jsr record_cursor_pos
    ldy $0764
    dey
    rts

define_text_window:             ; X=left, Y=bottom, A=top
    pha
    lda #$1c       ; Define text window
    jsr OSWRCH
    txa
    jsr OSWRCH
    tya
    jsr OSWRCH
    lda #$4f       ; Full screen width
    jsr OSWRCH
    pla
    jmp OSWRCH

_ae1a:
    ldy $35ed
    ldx $37de,y
    lda $37e2,y
    pha
    lda #$1f
    jsr $3354
    pla
    tax
    lda #$20
    jsr $3354
    jmp _b7b4

_ae33:
    bit $079a
    bpl _ae39
    rts
; Via table at aa52:
_ae39:
    bit $079a
    bmi _ae7b
    lda #$80
    sta $079b
    lda #$01
    sta $079c
    lda #$9b
    ldy #$07
    ldx #$40
    jsr $3300
    bne _aeb1
    lda #$08
    bit $3419
    bne _ae5c
    lda #$07
_ae5c:
    sta $079c
    lda #$9b
    ldy #$07
    ldx #$41
    jsr $3300
    bne _aeb1
    jsr _ab41
    lda $035f
    ora #$20
    sta $035f
    lda #$80
    sta $079a
    rts
_ae7b:
    lda $079a
    bpl _aea5
    lda #$00
    jsr _aebe
    lda #$80
    sta $079b
    lda #$9b
    ldy #$07
    ldx #$43
    jsr $3300
    bne _aeb1
    lda #$9b
    ldy #$07
    ldx #$44
    jsr $3300
    bne _aeb1
    jsr _ab41
    lda #$01
_aea5:
    sta $079a
    lda $035f
    and #$df
    sta $035f
    rts
_aeb1:
    lda #$9b
    ldy #$07
    ldx #$44
    jsr $3300
    lda #$00
    beq _aea5
_aebe:
    pha
    txa
    pha
    tya
    pha
    bit $079a
    bpl _aee4
    tsx
    lda $0103,x
    cmp #$0d
    beq _aee4
    inc $07a1
    ldx $07a1
    sta $07a1,x
    cmp #$0e
    bcc _aee1
    cpx #$50
    bcc _aee4
_aee1:
    jsr _aeea
_aee4:
    pla
    tay
    pla
    tax
    pla
    rts
_aeea:
    pha
    jsr record_cursor_pos
    inc $07a1
    lda #$a1
    sta $079d
    lda #$07
    sta $079e
    lda #$9b
    ldy #$07
    ldx #$42
    jsr $3300
    beq _af0c
    jsr _af94
    jsr _aeb1
_af0c:
    ldx #$00
    stx $07a1
    pla
    rts

; Via table at aa52:
_af13:
    bit $0777
    bmi _af38
    lda $0776
    bne _af20
    jsr _be21
_af20:
    ldx #$00
    stx $3366
    dex
    stx $0776
    stx $0777
    jsr _ab41
    lda $035f
    ora #$40
    sta $035f
    rts
_af38:
    lda $3366
    beq _af42
    lda #$0d
    jsr _af52
_af42:
    lda #$01
    sta $0777
    lda $035f
    and #$bf
    sta $035f
    jmp _ab41

_af52:
    pha
    cmp #$0d
    beq _af71
    cmp #$08
    bne _af60
    dec $3366
    bmi _af8d
_af60:
    cmp #$20
    bcc _af92
    inc $3366
    ldx $3366
    sta $3366,x
    cpx #$4a
    bcc _af92
_af71:
    jsr _beb4
    bcc _af85
    jsr record_cursor_pos
    jsr _be19
    jsr _af94
    jsr _af42
    jmp _af8d
_af85:
    inc $3366
    ldx #$89
    jsr $3300
_af8d:
    ldx #$00
    stx $3366
_af92:
    pla
    rts
_af94:
    ldx #$25
_af96:
    lda _afaa,x         ; Write a character from the string below
    jsr OSWRCH
    dex
    bpl _af96
_af9f:
    lda #$7a
    jsr OSBYTE
    inx
    beq _af9f
    jmp _be12
_afaa:
.byte 07 " yek a sserP" 0d 0a 07 " *** DETROBA ***"
.byte 0a 0a 17 00 1f 07         ; VDU 7, 31,0,23, 10,10

_afd0:
    jsr get_cursor_pos
    stx $0769
    sty $076a
    bit $079a
    bmi _b02a
    jsr _ae39
    bit $079a
    bpl _b02a
    jsr _b44c
    lda #$05
    sta $0778      ; y=5
_afee:
    lda #$0a
    jsr _aebe
    dec $0778      ; y--
    bne _afee
    lda #$08
    bit $3419
    bne _b03c
    lda #$1e
    pha
    lda $0798
    sta $0778
_b008:
    pla
    jsr OSWRCH
    jsr _ba58
    txa
    jsr _aebe
    pha
    lda $07a1
    bne _b008
    lda #$0a
    jsr _aebe
    dec $0778      ; y--
    bpl _b008
    pla
_b024:
    jsr _ae7b
    jsr _be12
_b02a:
    ldx $0769
    stx $0767
    ldx $076a
    stx $0768
    jsr set_cursor_pos
    jmp _b447
_b03c:
    lda #$58
    sta $34
    lda #$00
    sta $33
    lda #$19
    sta $0778      ; y=25

_b049:
       a9 28     lda #$28
$b04b  8d 7c 07  sta $077c
$b04e  a2 08     ldx #$08
_b050: bd a3 b0  lda _b0a3,x
$b053  20 be ae  jsr _aebe
$b056  ca        dex
$b057  10 f7     bpl _b050
_b059: a0 07     ldy #$07
_b05b: b1 33     lda ($33),y
$b05d  99 7d 07  sta $077d,y
$b060  88        dey
$b061  10 f8     bpl _b05b
$b063  a0 07     ldy #$07
_b065: a2 07     ldx #$07
$b067  a9 00     lda #$00
$b069  18        clc
_b06a: 3e 7d 07  rol $077d,x
$b06d  6a        ror a
$b06e  ca        dex
$b06f  10 f9     bpl _b06a
$b071  20 be ae  jsr _aebe
$b074  88        dey
$b075  10 ee     bpl _b065
$b077  a9 08     lda #$08
$b079  18        clc
$b07a  65 33     adc $33
$b07c  85 33     sta $33
$b07e  90 02     bcc _b082
$b080  e6 34     inc $34
_b082: ce 7c 07  dec $077c
$b085  d0 d2     bne _b059
$b087  20 9c b2  jsr read_key
$b08a  b0 04     bcs _b090
$b08c  e0 90     cpx #$90
$b08e  f0 05     beq _b095
_b090: ce 78 07  dec $0778      ; y--
$b093  d0 b4     bne _b049
_b095: a2 05     ldx #$05
_b097: bd ab b0  lda _b0ab,x
$b09a  20 be ae  jsr _aebe
$b09d  ca        dex
$b09e  10 f7     bpl _b097
$b0a0  4c 24 b0  jmp _b024
_b0a3:
.byte 01 40 4b 1b 0a 18 33 1b
_b0ab:
.byte 0d 0d 0a 32 1b

_b0b0:       ; RAM entry point 21
    sta $1e
    sty $1f
    jsr _b1b1
    ldx #$02
    stx $2d
    ldx #$01
    jsr $3300
    ldy #$00
_b0c2:
    jsr _b194
    beq _b0cd
    sta $0c80,y
    iny
    bne _b0c2
_b0cd:
    lda #$84
    sta $0c80,y
    lda #$1f
    sta $3623
    ldx #$16
    jsr $3300
    ldy #$00
    ldx #$06
    lda #$27
    sta $0801
_b0e5:
    jsr _b194
    beq _b11a
    and #$5f
    cmp #$58
    bne _b0f4
    cpy #$03
    bcs _b11a
_b0f4:
    lda ($1e),y
    iny
    sec
    sbc #$30
    cmp #$0a
    bcs _b0e5
    sta $07fc,x
    inx
    cpx #$07
    bne _b117
    lda $37d6
    beq _b117
    adc #$02
    asl
    asl
    adc $37d6
    asl
    sta $07fc,x
    inx
_b117:
    jmp _b0e5
_b11a:
    stx $07fc
    lda #$29
    jsr _b1a1
    lda #$7d
    ldy #$b1
    ldx #$04
    stx $2d
    ldx #$1d
    jsr $3300
    lda #$70
    sta $07f5
    lda #$17
    sta $07f6
    lda #$00
    sta $07f7
    lda #$f5
    ldy #$07
    ldx $3412
    stx $2d
    stx $07fb
    ldx #$23
    jsr $3300
    pha
    ldx #$04
    stx $2d
    ldx #$1e
    jsr $3300
    ldx #$12
    stx $2d
    ldx #$04
    jsr $3300
    pla
    tay
    and #$80
    clc
    bne _b17d
    ldx #$03
    tya
    bpl _b170
    ldx #$04
_b170:
    stx $2d
    ldx #$01
    jsr $3300
    lda #$2e
    jsr _b1a1
    sec
_b17d:
    rts

$b17e  a9 2d     lda #$2d
$b180  20 a1 b1  jsr _b1a1
$b183  29 02     and #$02
$b185  d0 0c     bne _b193
$b187  a9 80     lda #$80
$b189  ae fb 07  ldx $07fb
$b18c  86 2d     stx $2d
$b18e  a2 27     ldx #$27
$b190  4c 00 33  jmp $3300
_b193: 60        rts
_b194: c0 16     cpy #$16
$b196  f0 08     beq _b1a0
$b198  b1 1e     lda ($1e),y
$b19a  c9 3b     cmp #$3b
$b19c  f0 02     beq _b1a0
$b19e  c9 7d     cmp #$7d
_b1a0: 60        rts

_b1a1:
    sta $07fe
    lda #$81
    ldx #$fc
    ldy #$07
    jsr OSWORD
    lda $07ff
    rts

_b1b1:
    lda #$27
    jmp $3354

_b1b6:       ; RAM entry point 20
    jsr _ba7a
    lda #$08
    ora $3419
    sta $3419
    ldx #$02
    stx $3444
    jsr _b7d5
    jsr _b9ef
    jsr _b7b9
    jsr _b7dc
    jsr _bb01
    jsr _b79c
    jsr _b74c
    lda #$16        ; MODE
    jsr OSWRCH
    lda #$04        ; 4
    jsr OSWRCH
    lda #$00
    sta $3414
    jsr _b8bf
    lda #$17
    sta $0798
_b1f2:
    jsr _b85e
    bcc _b208
    jsr _bd11
    bcc _b20b
    jsr _b71f
    sta $078b
    jsr _b401
    jmp _b1f2
_b208:
    jmp _bb18
_b20b:
    jsr read_key
    bcs _b1f2
    txa
    pha
    lda $460d
    beq _b21a
    dec $460d
_b21a:
    lda $077a
    beq _b227
    dec $077a
    bne _b227
    jsr _b238
_b227:
    pla
    jsr _b241
    jsr _b774
    cmp #$88
    bcs _b260
    jsr _b2eb
    jmp _b1f2
_b238:
    ldx #$01
    stx $2d
    ldx #$04
    jmp $3300
_b241:
    pha
    jsr _bcf6
    beq _b249
    pla
    rts
_b249:
    pla
    cmp #$5f
    beq _b257
    cmp #$23
    beq _b25a
    cmp #$60
    beq _b25d
    rts
_b257:
    lda #$60
    rts
_b25a:
    lda #$5f
    rts
_b25d:
    lda #$23
    rts
_b260:
    cmp #$9a
    bcs _b1f2
    sec
    sbc #$80
    tax
    jsr _b26e
    jmp _b1f2

_b26e:
    lda [_b26e + 2],x
    pha
    lda _b282,x
    pha
    txa
_b277:
    rts

.byte >[_b2eb - 1],>[_b2eb - 1],>[_b2eb - 1],>[_b2eb - 1]
.byte >[_b277 - 1],>[_b277 - 1],>[_b277 - 1],>[_b277 - 1]
.byte >[_b2c8 - 1],>[_b2be - 1]
_b282:
.byte                           >[_b2c3 - 1],>[_afd0 - 1]
.byte >[_bd5f - 1],>[_b277 - 1],>[_b2e4 - 1],>[_b277 - 1]
.byte >[_bc2d - 1],>[_b780 - 1]
.byte <[_b2eb - 1],<[_b2eb - 1],<[_b2eb - 1],<[_b2eb - 1]
.byte <[_b277 - 1],<[_b277 - 1],<[_b277 - 1],<[_b277 - 1]
.byte <[_b2c8 - 1],<[_b2be - 1],<[_b2c3 - 1],<[_afd0 - 1]
.byte <[_bd5f - 1],<[_b277 - 1],<[_b2e4 - 1],<[_b277 - 1]
.byte <[_bc2d - 1],<[_b780 - 1]

read_key:
    lda #$81       ; Read key
    ldx #$00
    ldy #$00
    jmp OSBYTE

_b2a5:
.byte 2a 30 b0 2a df 2a 39 30 df 2a 2a
.byte 2a aa

_b2b2:
    lda _b2a5,y
    pha
    jsr _b2eb
    iny
    pla
    bpl _b2b2
    rts

_b2be:
    ldy #$00
    jmp _b2b2

_b2c3:
    ldy #$03
    jmp _b2b2

_b2c8:
    lda $460d
    bne _b2e1
_b2cd:
    lda #$79
    ldx #$a7
    jsr OSBYTE
    txa
    bmi _b2cd
    lda #$02
    sta $460d
    ldy #$05
    jmp _b2b2
_b2e1:
    jmp _bb18
_b2e4:
    rts
_b2e5:
.byte 90 ae c3
_b2e8:
.byte b3 b3 b3

_b2eb:
    pha
    sta $0796
    txa
    pha
    tya
    pha
    ldx $3444
    beq _b303
    cpx #$01
    beq _b30a
    jsr _b3c4
    bcs _b331
    bcc _b30f
_b303:
    jsr _b391
    bcs _b331
    bcc _b30f
_b30a:
    jsr _b3af
    bcs _b331
_b30f:
    ldx $3444
    lda _b2e5,x
    ldy _b2e8,x
    jsr _b855
    lda #$b8
    ldy #$0b
    jsr _b830
    bmi _b32b
    cmp #$04
    beq _b331
    clc
    bcc _b331
_b32b:
    lda #$00
    sta $3443
    sec
_b331:
    pla
    tay
    pla
    tax
    pla
    rts
_b337:
    lda $0796
    beq _b355
    jmp _b7cf
_b33f: a9 0b     lda #$0b
$b341  ae 96 07  ldx $0796
$b344  f0 0f     beq _b355
$b346  4c 54 33  jmp $3354
_b349: ac db 37  ldy $37db
$b34c  88        dey
$b34d  f0 06     beq _b355
$b34f  ad 96 07  lda $0796
$b352  4c 02 aa  jmp _aa02
_b355: 60        rts
_b356: a9 07     lda #$07
$b358  20 54 33  jsr $3354
$b35b  ad 0e 34  lda $340e
$b35e  29 01     and #$01
$b360  18        clc
$b361  d0 01     bne _b364
$b363  38        sec
_b364: 60        rts
_b365: 18        clc
$b366  ae 43 34  ldx $3443
$b369  d0 01     bne _b36c
$b36b  38        sec
_b36c: 60        rts

_b36d: a9 0a     lda #$0a
$b36f  20 54 33  jsr $3354
$b372  ad 0e 34  lda $340e
$b375  18        clc
$b376  29 04     and #$04
$b378  f0 01     beq _b37b
$b37a  38        sec
_b37b: 60        rts
_b37c: ad dd 37  lda $37dd
$b37f  f0 0e     beq _b38f
$b381  ad 96 07  lda $0796
$b384  c9 0d     cmp #$0d
$b386  d0 07     bne _b38f
$b388  a9 0a     lda #$0a
$b38a  8d 96 07  sta $0796
$b38d  18        clc
$b38e  60        rts
_b38f: 38        sec
$b390  60        rts

_b391:
    jsr _b36d
    bcc _b3ae
    jsr _b356
    bcc _b3ae
    jsr _b365
    bcc _b3ae
    jsr _b33f
_b3a3:
    jsr _b349
    jsr _b37c
    bcc _b3ae
    jmp _b3d9
_b3ae:
    rts

_b3af:
    jsr _b8b0
    bcc _b3d5
    jsr _b3eb
    bcc _b3ae
    jsr _b365
    bcc _b3ae
    jsr _b337
    jmp _b3a3

_b3c4:
    jsr _b8b0
    bcc _b3d5
    jsr _b3eb
    bcc _b3d4
    jsr _b337
    jmp _b3d9
_b3d4:
    rts
_b3d5:
    lda #$04
    bne _b3db
_b3d9:
    lda #$04
_b3db:
    ldx #$09
    stx $2d
    ldx #$27
    jsr $3300
    lda #$00
    sta $0796
    sec
    rts
_b3eb:
    lda #$19
    jsr $3354
    lda $340e
    clc
    and #$04
    beq _b3f9
    sec
_b3f9:
    rts

_b3fa:
    ldx #$00
    lda ($31,x)
    jmp _b757

_b401:
    lda $078b
    cmp #$7f
    bne _b40a
    lda #$ff
_b40a:
    ldx $0795
    beq _b412
    jmp _b673
_b412:
    bit $07f4
    bpl _b423
    inc $07f4
    clc
    adc #$40
    sta $078b
    jmp _b45c
_b423:
    cmp #$05
    beq _b43e
    cmp #$0c
    beq _b441
    cmp #$11
    beq _b447
    cmp #$14
    beq _b44c
    cmp #$18
    bcc _b457
    cmp #$1b
    beq _b451
    jmp _b473
_b43e:
    jmp _b99c
_b441:
    jsr _b49c
    jmp _b5a2
_b447:
    ldx #$06
    jmp $3300
_b44c:
    ldx #$05
    jmp $3300
_b451:
    lda #$ff
    sta $07f4
    rts
_b457:
    cmp #$0e
    bcc _b473
    rts
_b45c:
    cmp #$a0
    bcc _b465
    lda #$20
    jmp _b485
_b465:
    cmp #$88
    bcs _b46c
    jmp _b48b
_b46c:
    sec
    sbc #$88
    tax
    jsr _b4ce
_b473:
    cmp #$21
    bcc _b485
    jsr _b547
    jsr _b585
_b47d:
    jsr get_cursor_pos
    cpx #$00
    beq _b49c
_b484:
    rts
_b485:
    jsr _b5a2
    jmp _b47d
_b48b:
    ldx #$00
    stx $4600
    stx $4601
    lda $4607
    sta $078b
    jmp _b473
_b49c:
    ldx #$00
    stx $4600
    stx $4601
    stx $4602
    stx $4603
    stx $4604
    ldx #$20
    stx $4607
    ldx $4605
    beq _b484
    jsr get_cursor_pos
    dey
    cpy $4608
    bne _b484
    ldx #$ff
    stx $0795
    ldy $4608
    iny
    iny
    sty $460c
    rts
_b4ce:
    lda _b4dd,x         ; Load high address byte (HH)
    pha
    lda _b4f5,x         ; Load low address byte (LL)
    pha
_b4d6:
    lda $4607
    sta $078b
    rts                 ; Return to $HHLL+1

_b4dd:
.byte >[_b4d6 - 1],>[_b4d6 - 1],>[_b4d6 - 1],>[_b4d6 - 1]
.byte >[_b518 - 1],>[_b51e - 1],>[_b4d6 - 1],>[_b4d6 - 1]
.byte >[_b4d6 - 1],>[_b50d - 1],>[_b50d - 1],>[_b50d - 1]
.byte >[_b50d - 1],>[_b50d - 1],>[_b50d - 1],>[_b50d - 1]
.byte >[_b52d - 1],>[_b533 - 1],>[_b537 - 1],>[_b4d6 - 1]
.byte >[_b4d6 - 1],>[_b4d6 - 1],>[_b541 - 1],>[_b53d - 1]
_b4f5:
.byte <[_b4d6 - 1],<[_b4d6 - 1],<[_b4d6 - 1],<[_b4d6 - 1]
.byte <[_b518 - 1],<[_b51e - 1],<[_b4d6 - 1],<[_b4d6 - 1]
.byte <[_b4d6 - 1],<[_b50d - 1],<[_b50d - 1],<[_b50d - 1]
.byte <[_b50d - 1],<[_b50d - 1],<[_b50d - 1],<[_b50d - 1]
.byte >[_b52d - 1],<[_b533 - 1],<[_b537 - 1],<[_b4d6 - 1]
.byte <[_b4d6 - 1],<[_b4d6 - 1],<[_b541 - 1],<[_b53d - 1]

_b50d:
    ldx #$ff
    stx $4600
    ldx #$00
    stx $4601
    rts

_b518:
    ldx #$00
    stx $4602
    rts

_b51e:
    ldx #$ff
    stx $4602
    stx $4605
    jsr get_cursor_pos
    sty $4608
    rts

_b52d:
    ldx #$ff
    stx $4601
    rts

_b533:
    ldx #$00
    beq _b539
    ldx #$ff
_b539:
    stx $4603
    rts

_b53d:
    ldx #$00
    beq _b543
_b541:
    ldx #$ff
_b543:
    stx $4604
    rts

_b547:
    cmp #$5f
    bcs _b54f
    cmp #$5b
    bcs _b55e
_b54f:
    ldx $4600
    cpx #$00
    beq _b561
    cmp #$40
    bcc _b55e
    cmp #$5b
    bcc _b584
_b55e:
    ora #$80
    rts
_b561:
    cmp #$23
    beq _b570
    cmp #$60
    beq _b574
    cmp #$5f
    beq _b578
    jmp _b57a
_b570:
    lda #$60
    bne _b57a
_b574:
    lda #$5f
    bne _b57a
_b578:
    lda #$23
_b57a:
    cmp #$7b
    bcc _b584
    cmp #$7f
    bcs _b584
    adc #$20
_b584:
    rts

_b585:
    ldx $4601
    cpx #$ff
    bne _b58e
    lda #$20
_b58e:
    ldx $4603
    cpx #$ff
    bne _b598
    jsr _b636
_b598:
    ldx $4602
    cpx #$ff
    bne _b5a2
    jmp _b5cc
_b5a2:
    ldx #$00
    stx $460b
    jsr _b6ad
    ldx $460b
    cpx #$ff
    beq _b5b4
    jsr OSWRCH
_b5b4:
    ldx $4604
    cpx #$ff
    beq _b5c1
_b5bb:
    ldx #$20
    stx $4607
    rts
_b5c1:
    ldx $4600
    cpx #$ff
    bne _b5bb
    sta $4607
    rts
_b5cc:
    sta $078b
    cmp #$21
    bcs _b5d8
    lda #$20
    jmp _b623
_b5d8:
    jsr _b627
    lda #$17        ; VDU 23
    jsr OSWRCH
    lda #$8c        ; 140
    jsr OSWRCH
    ldx #$01
*
    lda $077c,x
    jsr OSWRCH
    jsr OSWRCH
    inx
    cpx #$05
    bcc -
    lda #$17        ; VDU 23
    jsr OSWRCH
    lda #$8d        ; 141
    jsr OSWRCH
*
    lda $077c,x
    jsr OSWRCH
    jsr OSWRCH
    inx
    cpx #$09
    bcc -
    lda #$8c        ; 140
    jsr OSWRCH
    lda #$0a        ; newline
    jsr OSWRCH
    lda #$08        ; backspace
    jsr OSWRCH
    lda #$8d        ; 141
    jsr OSWRCH
    lda #$0b        ; up
_b623:
    jsr OSWRCH
    rts

_b627:
    sta $078b
    ldx #$7c
    ldy #$07
    sta $077c
    lda #$0a        ; Read character definition into $077c
    jmp OSWORD
_b636:
    sta $078b
    cmp #$a0
    bcc _b672
    cmp #$c0
    bcs _b66e
_b641:
    jsr _b627
    ldx #$01
    ldy #$00
    lda #$17        ; VDU 23
    jsr OSWRCH
    lda #$8e        ; 142
    jsr OSWRCH
_b652:
    cpx #$03
    beq _b66a
    cpx #$06
    beq _b66a
    lda $077c,x
    and #$77
_b65f:
    jsr OSWRCH
    inx
    cpx #$09
    bcc _b652
    lda #$8e
    rts
_b66a:
    lda #$00
    beq _b65f
_b66e:
    cmp #$e0
    bcs _b641
_b672:
    rts

_b673:
    cmp #$0c       ; Clear text area?
    beq _b689
    cmp #$0d       ; Carriage return?
    beq _b689
    cmp #$1e       ; Home?
    beq _b689
    cmp #$0a       ; Newline?
    beq _b689
    cmp #$1b       ; Reserved?
    beq _b6a4
    lda #$09       ; Forward (tab)?
_b689:
    jsr OSWRCH
    jsr get_cursor_pos
    cpy #$00       ; Top row?
    beq +
    cpy $460c
    bcc _b6a4
    ldx #$00       ; Left column?
*   cpx #$00
    bne _b6a4
    stx $4605
    stx $0795
_b6a4:
    rts

get_cursor_pos:
    pha
    lda #$86       ; Read cursor position (POS and VPOS)
    jsr OSBYTE
    pla
    rts
_b6ad:
    pha
    cmp #$0c
    beq _b6c1
    cmp #$1e
    beq _b6c1
    jsr get_cursor_pos
    cpy #$00
    beq _b6eb
    cpy #$17
    beq _b6c3
_b6c1:
    pla
    rts
_b6c3:
    cmp #$0a
    beq _b6d5
    cpx #$27
    bne _b6c1
    cmp #$0d
    beq _b6c1
    cmp #$08
    beq _b6c1
    ldx #$00
_b6d5:
    jsr _b712
    pha
    lda #$1f
    jsr OSWRCH
    txa
    jsr OSWRCH
    lda #$00
    jsr OSWRCH
    pla
    jmp _b6c1
_b6eb:
    cmp #$0b
    beq _b6fc
    cpx #$00
    bne _b6c1
    ldx #$27
    cmp #$08
    beq _b6fc
    jmp _b6c1
_b6fc:
    jsr _b712
    pha
    lda #$1f       ; VDU 31 (TAB)
    jsr OSWRCH
    txa            ; X
    jsr OSWRCH
    lda #$17       ; 23
    jsr OSWRCH
    pla
    jmp _b6c1
_b712:
    cmp #$0e
    bmi _b719
    jsr OSWRCH
_b719:
    ldy #$ff
    sty $460b
    rts

_b71f:
    pha
    cmp #$0c
    beq _b73a
    cmp #$58
    beq _b740
    cmp #$09
    bne _b72e
    lda #$20
_b72e:
    ldx #$00
    sta ($31,x)
    sta $4606
    jsr _b757
    pla
    rts
_b73a:
    jsr _b74c
    jmp _b72e
_b740:
    ldx $4606
    cpx #$1b
    bne _b749
    lda #$41
_b749:
    jmp _b72e

_b74c:
    pha
    lda #$48
    sta $32
    lda #$00
    sta $31
    pla
    rts

_b757:
    pha
    inc $31
    bne _b767
    inc $32
    lda $32
    cmp #$4c
    bne _b767
    jsr _b74c
_b767:
    pla
    rts

_b769: 48        pha
$b76a  a5 31     lda $31
$b76c  d0 02     bne _b770
$b76e  c6 32     dec $32
_b770: c6 31     dec $31
$b772  68        pla
$b773  60        rts
_b774:
    pha
    lda #$ff
    ldx #$00
    sta ($31,x)
    jsr _b757
    pla
    rts

_b780:
    jsr _b74c
    lda #$1e       ; VDU 30 (Home)
    jsr OSWRCH
    jsr _b757
_b78b:
    jsr _b3fa
    sta $078b
    cmp #$ff
    bne _b796
    rts
_b796:
    jsr _b401
    jmp _b78b

_b79c:
    lda #$10
    jsr $3354
    lda #$17
    ldx #$02
    jmp $3354

_b7a8: a9 17     lda #$17
$b7aa  a2 82     ldx #$82
_b7ac: 20 54 33  jsr $3354
$b7af  a9 11     lda #$11
$b7b1  4c 54 33  jmp $3354

_b7b4:
    lda #$12
    jmp $3354

_b7b9:
    lda #$1f
    ldx #$02
    jsr $3354
    lda #$20
    ldx #$98
    jsr $3354
    jmp _b7b4
    lda #$27
    jmp $3354

_b7cf: aa        tax
$b7d0  a9 1a     lda #$1a
$b7d2  4c 54 33  jmp $3354

_b7d5:
    ldx #$ff
_b7d7:
    lda #$2a
    jmp $3354

_b7dc:
    lda #$70
    sta $07f5
    lda #$17
    sta $07f6
    lda #$00
    sta $07f7
    ldx #$09
    stx $2d
    lda #$f5
    ldy #$07
    ldx #$24
    jsr $3300
    ldy #$00
_b7fa:
    lda $07f5,y
    sta $0787,y
    iny
    cpy #$03
    bne _b7fa
    jsr _b810
_b808:
    ldx #$00
    stx $3620
    jmp _b7d7
_b810:
    lda #$9e
    ldy #$b8
    jsr _b855
_b817:
    lda #$64
    ldy #$00
    jsr _b830
    bmi _b82f
    and #$08
    bne _b829
    jsr _b885
    bpl _b817
_b829:
    jsr _b808
    jmp _bb18
_b82f:
    rts
_b830:
    sta $07f5
    sty $07f6
    lda #$00
    sta $07f7
    lda #$a7
    sta $3620
    ldx #$09
    stx $2d
    lda #$f5
    ldy #$07
    ldx #$23
    jsr $3300
    pha
    lda #$00
    sta $3620
    pla
    rts

_b855:
    ldx #$03
    stx $2d
    ldx #$1d
    jmp $3300

_b85e:
    jsr _b8b0
    bcs _b884
    lda #$97
    ldy #$b8
    jsr _b855
_b86a:
    lda #$32
    ldy #$00
    jsr _b830
    clc
    bmi _b884
    tax
    and #$08
    bne _b884
    dec $07f3
    bmi _b884
    sec
    txa
    and #$04
    beq _b86a
_b884:
    rts

_b885:
    ldy #$00
    sec
    php
_b889:
    plp
    lda $0787,y
    sbc $07f5,y
    php
    iny
    cpy #$03
    bne _b889
    plp
    rts
    jsr _b8b0
    bcc _b8af
    bcs _b8a4
    jsr _b8b0
    bcs _b8af
_b8a4:
    ldx #$09
    stx $2d
    lda #$04
    ldx #$27
    jmp $3300
_b8af:
    rts

_b8b0:
    pha
    lda #$40
    jsr OSBYTE
    txa
    and #$08
    clc
    bne _b8bd
    sec
_b8bd:
    pla
    rts

_b8bf:
    jsr _b8e5
    ldx #$a0
_b8c4:
    stx $0794
    jsr _b91d
    ldx $0794
    inx
    cpx #$c0
    bne _b8c4
    ldx #$e0
_b8d4:
    stx $0794
    jsr _b91d
    ldx $0794
    inx
    cpx #$00
    bne _b8d4
    jmp _bbc1

_b8e5:
    ldx #$03       ; &E0-&FF (OSHWM+&200 to OSHWM+&2FF)
    lda #$14       ; Explode soft character RAM allocation
    jsr OSBYTE
    lda #$ae       ; Read VDU variables origin
    ldx #$00
    ldy #$ff
    jsr OSBYTE
    stx $2f
    sty $30
    ldy #$6b
_b8fb:
    lda [_b8a4 - 3],y   ; $b8a1,y
    sta ($2f),y
    clc
    adc #$01
    iny
    cpy #$6f
    bne _b8fb
    rts

_b909:
.byte 43 44 45
_b90c:              ; Accessed by $b8a1,y with Y=$6b
.byte 0c 40 41 42

_b910:
    ldx #$00
    lda #$00
_b914:
    sta $078c,x
    inx
    cpx #$08
    bne _b914
    rts

_b91d:
    jsr _b910
    lda $0794
    cmp #$e0
    bcs _b92a
    sec
    sbc #$a0
_b92a:
    and #$3f
    sta $460a
    ldy #$00
_b931:
    sty $4609
    ldx #$01
    jsr _b95c
    iny
    cpy #$03
    bne _b931
_b93e:
    sty $4609
    ldx #$04
    jsr _b95c
    iny
    cpy #$05
    bne _b93e
_b94b:
    sty $4609
    ldx #$10
    jsr _b95c
    iny
    cpy #$08
    bne _b94b
    jsr _b983
    rts
_b95c:
    txa
    pha
    bit $460a
    beq _b96f
    ldx $4609
    lda $078c,x
    clc
    adc #$f0
    sta $078c,x
_b96f:
    pla
    asl
    bit $460a
    beq _b982
    ldx $4609
    lda $078c,x
    clc
    adc #$0f
    sta $078c,x
_b982:
    rts
_b983:
    lda #$17        ; VDU 23
    jsr OSWRCH
    lda $0794
    jsr OSWRCH
    ldx #$00
_b990:
    lda $078c,x
    jsr OSWRCH
    inx
    cpx #$08
    bne _b990
    rts

_b99c:
    ldx $35ed
    beq _b9c2
    lda #$00
    sta $077a
    php
    sei
    jsr _b9ce
    ldx #$79
    jsr _b9d5
    ldy #$00
_b9b2:
    tya
    pha
    lda $fd53,y
    jsr _b9c3
    pla
    tay
    iny
    cpy #$0a
    bcc _b9b2
    plp
_b9c2:
    rts

_b9c3:
    inc $077a
    tay
    lda #$99            ; Insert character into keyboard buffer (X=0)
    ldx #$00
    jmp OSBYTE
_b9ce:
    lda #$15            ; Flush keyboard buffer (X=0)
    ldx #$00
    jmp OSBYTE
_b9d5:
    inc $077a
    stx $2d
    ldx #$01
    jsr $3300
    jsr _bcf6
    beq _b9ec
    jsr _b447
    ldx #$ff
    stx $0799
_b9ec:
    jmp set_cursor_pos
_b9ef:
    ldx $35ed
    ldy _ba06,x
    lda _ba09,x
_b9f8:
    ldx #$a7
    stx $3620
    jsr _b0b0
    bcc _ba05
    jmp _bb18
_ba05:
    rts

_ba06: .byte 35 fd fd
_ba09: .byte ee 64 7a

_ba0c:
    lda #$91
    ldy #$fd
    ldx $35ed
_ba13:
    dex
    beq _ba1e
    clc
    adc #$16
    bcc _ba13
    iny
    bne _ba13
_ba1e:
    jmp _b9f8

_ba21:
.byte $60

_ba22:
    lda #$1f       ; VDU 31 (TAB)
    jsr OSWRCH
    lda $078a      ; x
    jsr OSWRCH
    lda $0778      ; y
    jsr OSWRCH
    ldx $078a      ; x
    inx
    txa
    pha
_ba39:
    jsr _ba58
    pla
    tay
    txa
    sta $3366,y
    dey
    beq _ba4f
    tya
    pha
    lda #$08        ; backspace
    jsr OSWRCH
    jmp _ba39
_ba4f:
    ldx $078a      ; x
    inx
    inx
    stx $3366
    rts

_ba58:
    jsr get_char_at_cursor
    bne _ba69
    jsr _abe5
    jsr get_char_at_cursor
    pha
    jsr _abe5
    pla
    tax
_ba69:
    bmi _ba70
    cpx #$20
    bcc _ba70
    rts
_ba70:
    ldx #$20
    rts

get_char_at_cursor:
    lda #$87       ; Read character at cursor position
    jsr OSBYTE     ; X=character value or 0, Y=graphics mode
    txa            ; Transfer character to A
    rts

_ba7a:
    lda $0204
    sta $3440
    lda $0205
    sta $3441
    lda $37dc
    sta $3446
    lda #$80
    bit $3418
    beq _bb0b
    lda #$e5        ; Write 1 to ESCAPE status
    ldx #$01
    ldy #$00
    jsr OSBYTE
    lda #$80
    sta $0779
_baa1:
    ldx #$00
    stx $3447
    stx $3448
    lda #$c0
    sta $3442
    stx $0776
    stx $0777
    stx $077b
    stx $3443
    stx $3445
    stx $0796
    stx $077a
    stx $079a
    stx $07a1
    stx $07f4
    ldx #$49
    stx $078a      ; x=73
    ldx #$02
    stx $07f3
    lda #$85
    sta $0794
    ldx #$00
_badd:
    lda _baeb,x
    sta $078c,x
    inx
    cpx #$08
    bcc _badd
    jmp _b983

_baeb:
.byte ff 9f b1 95 b1 95 f5 ff

_baf3: a2 30     ldx #$30
$baf5  20 00 33  jsr $3300
$baf8  a9 03     lda #$03
$bafa  85 2d     sta $2d
$bafc  a2 1b     ldx #$1b
$bafe  4c 00 33  jmp $3300
_bb01: 20 f3 ba  jsr _baf3
$bb04  a2 02     ldx #$02
$bb06  a9 1b     lda #$1b
$bb08  4c 54 33  jmp $3354
_bb0b: a9 02     lda #$02
$bb0d  8d ec 35  sta $35ec
$bb10  a9 ff     lda #$ff
$bb12  8d 22 36  sta $3622
$bb15  4c 9d bb  jmp _bb9d

; Via the table at aa52:
_bb18:
    lda $3444
    beq _bb3d
    ldx #$c0
    jsr $3300
    ldx #$9a
    jsr $3300
    jsr _b7a8
    ldx #$02
    lda #$1c
    jsr $3354
    ldx #$03
    stx $2d
    ldx #$1c
    jsr $3300
    jmp _bb40
_bb3d:
    jsr _ab30
_bb40:
    ldx #$00
    stx $3444
    stx $3620
    jsr _b7d7
    ldx #$03
    stx $2d
    ldx #$1e
    jsr $3300
    lda #$f5
    ldy #$07
    ldx #$25
    jsr $3300
    lda $079a
    bvs _bb69
    bmi _bb69
    beq _bb77
    jsr _ae39
_bb69:
    ldx #$06
_bb6b:
    lda _bbba,x
    jsr _aebe
    dex
    bpl _bb6b
    jsr _ae7b
_bb77:
    bit $0777
    bpl _bb7f
    jsr _af38
_bb7f:
    lda #$ff
    sta $3414
    lda $0779
    pha
    ldx #$00
    jsr $3300
    pla
    tax
    lda $3419
    and #$04
    beq _bb9a
    cpx #$81
    bne _bb9d
_bb9a:
    jsr $3300
_bb9d:
    lda #$e5        ; Write 0 to ESCAPE status
    ldx #$00
    ldy #$00
    jsr OSBYTE
    lda $3440
    ldy $3441
    php
    sei
    sta $0204
    sty $0205
    plp
    ldx $3413
    txs
    rts

_bbba:
.byte 40 1b 0a 0a 0a 0a 0d

_bbc1:
    ldx #$00
_bbc3:
    lda _bbd2,x
    cmp #$ff
    beq _bbd1
    jsr OSWRCH
    inx
    jmp _bbc3
_bbd1:
    rts

_bbd2:
.byte 17 db 10 30 60 fe 60 30 10 00 ; VDU 23,219,...
.byte 17 dc 20 20 2c 22 24 08 0f 00
.byte 17 dd 08 0c 06 7f 06 0c 08 00
.byte 17 de 18 3c 7e 5b 18 18 18 00
.byte 17 df 14 14 7f 14 7f 14 14 00
.byte 17 9b 40 40 41 43 05 07 01 00
.byte 17 9c 28 28 28 28 28 28 28 00
.byte 17 9d 70 08 71 0b 75 07 01 00
.byte 17 9e 00 10 00 7e 00 00 10 00
.byte ff
; The $ff byte terminates the block of data

; Via table at aa52:
_bc2d:
    lda $0776
    cmp #$ff
    beq _bc71
    lda $077b
    bne _bc41
    lda #$ff
    sta $077b
    jsr _bcfc
_bc41:
    jsr record_cursor_pos
    lda $3573
    beq _bc79
    ldx #$8c
    jsr $3300
    lda $3366
    cmp #$02
    bne _bc5c
    lda $3367
    cmp #$23
    beq _bc69
_bc5c:
    jsr _bc90
    bcc _bc69
    ldx #$8d
    jsr $3300
    jmp _bc41
_bc69:
    ldx #$8d
    jsr $3300
    jmp _bc79

_bc71:
    ldx #$7b
    jsr _b9d5
    jmp _be12

_bc79:
    jsr _bcf6
    bne _bc83
    lda #$5f
    jsr _b2eb
_bc83:
    lda $3573
    bne _bc8b
    jsr _bcfc
_bc8b:
    lda #$07            ; Bell
    jmp OSWRCH

_bc90:
    ldx $3366
    dex
    beq _bcb9
    inx
    stx $0785
    ldx #$01
_bc9c:
    lda $3366,x
    jsr _b241
    jsr _b2eb
    bcc _bcd8
    txa
    pha
    ldx #$00
    stx $0797
    jsr _bcd9
    pla
    tax
    inx
    cpx $0785
    bcc _bc9c
_bcb9:
    jsr _bcf6
    beq _bcc3
    lda #$0d
    jmp _b2eb
_bcc3:
    cpx #$29
    bcs _bcd8
    lda #$20
    jsr _b2eb
    bcc _bcd8
    txa
    pha
    jsr _bcd9
    pla
    tax
    inx
    bne _bcc3
_bcd8:
    rts
_bcd9:
    jsr _bd11
    bcc _bcf5
    sta $078b
    jsr _bcf6
    beq _bcef
    lda $078b
    jsr _aa82
    jmp _bcd9
_bcef:
    jsr _b401
    jmp _bcd9
_bcf5:
    rts
_bcf6:
    lda $3419
    and #$10
    rts

_bcfc:
    ldx #$88
    lda #$01
    sta $3573
    lda #$02
    sta $3574
    jsr $3300
    lda #$81
    sta $0779
    rts

_bd11:
    lda $3442
    cmp #$b0
    bcc _bd1b
    jsr _bd37
_bd1b:
    ldx $3448
    cpx $3447
    beq _bd35
    lda $3449,x
    inc $3442
    inx
    cpx #$c0
    bne _bd30
    ldx #$00
_bd30:
    sec
    stx $3448
    rts
_bd35:
    clc
    rts
_bd37:
    lda $3444
    bne _bd43
    lda #$08
    ldx #$01
    jsr $3354
_bd43:
    jsr _bcf6
    beq _bd57
    lda $3445
    beq _bd57
    lda #$11
    jsr _b2eb
    lda #$00
    sta $3445
_bd57:
    rts

_bd58:
    lda #$0f
    ldx #$00
    jmp $3354

; Via table at aa52:
_bd5f:
    jsr _b74c
    jsr record_cursor_pos
    ldx #$ff
    stx $0778      ; y=255
    bit $0777
    bpl _bd74
    lda #$0d
    jsr _af52
_bd74:
    lda $0776
    bne _bd81
    lda #$ff
    sta $0776
    jsr _be21
_bd81:
    inc $0778      ; y++
    ldx $0778
    cpx #$19
    bcs _be03
    jsr _bcf6
    bne _bdac
    dec $0778      ; y--
    jsr _be40
    cmp #$ff
    bne _bd9f
    lda #$19
    sta $0778      ; y=25
_bd9f:
    jsr _beb4
    bcs _be19
_bda4:
    ldx #$89
    jsr $3300
    jmp _bd81
_bdac:
    jsr _ba22
    jsr _beb4
    bcs _be19
    ldx #$89
    jsr $3300
    jsr _bdc6
    bcs _bd81
    jsr _beb4
    bcs _be19
    jmp _bda4
_bdc6:
    lda #$1f       ; VDU 31 (TAB)
    jsr OSWRCH
    lda #$4f       ; x=79 (rightmost column)
    jsr OSWRCH
    lda $0778      ; y
    jsr OSWRCH
    lda #$00
    sta $078b
    ldy #$07
    sty $3366
_bde0:
    dey
    beq _bdfd
    tya
    pha
    jsr _ba58
    pla
    tay
    txa
    sta $3366,y
    cmp #$21
    bcc _bdf5
    dec $078b
_bdf5:
    lda #$08       ; Backspace
    jsr OSWRCH
    jmp _bde0
_bdfd:
    lda #$00
    cmp $078b
    rts

_be03:
    lda #$00
    sta $3366
    lda #$07       ; Bell
    jsr OSWRCH
    ldx #$78
    jsr _b9d5
_be12:
    lda #$15       ; Flush buffer
    ldx #$00       ; Keyboard
    jmp OSBYTE

_be19:
    ldx #$7a
    jsr _b9d5
    jmp _be12

_be21:
    lda #$81
    sta $0779
    lda #$71
    ldy #$35
    ldx #$4c
    jsr $3300
    ldx #$bd
    jsr $3300
    jsr _bcfc
    lda $3419
    and #$fb
    sta $3419
    rts

_be40:
    ldx #$00
    stx $4600
    inx
    stx $0786
_be49:
    ldx $0786
    cpx #$29
    bcs _be83
    jsr _b3fa
    cmp #$0d
    beq _be72
    cmp #$0a
    beq _be72
    cmp #$ff
    beq _be83
    jsr _be8a
    cmp #$20
    bcc _be49
    ldx $0786
    sta $3366,x
    inc $0786
_be6f:
    jmp _be49
_be72:
    sta $078b
    jsr _b3fa
    clc
    adc $078b
    cmp #$17
    beq _be83
    jsr _b769
_be83:
    ldx $0786
    stx $3366
    rts
_be8a:
    jsr _b561
    cmp #$1b
    beq _be9d
    cmp #$7f
    bcs _beb1
    ldx $4600
    cpx #$ff
    beq _beb1
    rts
_be9d:
    jsr _b3fa
    cmp #$51
    bcc _beac
    ldx #$ff
    stx $4600
    jmp _beb1
_beac:
    ldx #$00
    stx $4600
_beb1:
    lda #$20
    rts

_beb4:
    clc
    lda $3579
    ora $357a
    bne _bec2
    lda #$4d
    cmp $3578
_bec2:
    rts

_bec3:
.byte $d0,$05,$a9,$4d,$cd,$78,$35,$60,$05,$a9,$4d,$cd,$78
.byte $35,$60,$60,$78,$35,$60,$46,$a9,$20,$60,$18,$ad,$79,$35,$0d,$7a
.byte $35,$d0,$05,$a9,$4d,$cd,$78,$35,$60,$d0,$05,$a9,$4d,$cd,$78,$35
.byte $60,$60,$60,$20,$6f,$be,$a5,$12,$85,$45,$a5,$13,$85,$46,$a9,$23

_bf00: ; Bytes at bf01 and bf80 provide an entry point for the ROM from RAM.
.byte $03,$80,$9b,$80,$80,$97,$97,$97,$80,$82,$97,$9c,$9d,$a2,$a6,$a4
.byte $a4,$a6,$a7,$a7,$a9,$b1,$b0,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $01,$5f,$bd,$e0,$70,$f8,$0e,$7c,$21,$31,$14,$7a,$4a,$37,$2b,$47
.byte $e4,$64,$da,$2f,$b5,$af,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$48
